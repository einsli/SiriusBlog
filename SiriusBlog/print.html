<!DOCTYPE HTML>
<html lang="zh" class="navy" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Siriusè¿ç»´å¼€å‘ç¬”è®°</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="Siriusè¿ç»´å¼€å‘ç¬”è®°">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('navy')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> ç®€ä»‹</a></li><li class="chapter-item expanded "><a href="operations.html"><strong aria-hidden="true">2.</strong> åŸºç¡€è¿ç»´</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="operations/linux.html"><strong aria-hidden="true">2.1.</strong> linux</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="operations/linux/linux_base_config.html"><strong aria-hidden="true">2.1.1.</strong> linux åŸºç¡€é…ç½®</a></li><li class="chapter-item expanded "><a href="operations/linux/linux_kernel_upgrade_online.html"><strong aria-hidden="true">2.1.2.</strong> linux å†…æ ¸å‡çº§(çº¿ä¸Š)</a></li><li class="chapter-item expanded "><a href="operations/linux/linux_kernel_upgrade_offline.html"><strong aria-hidden="true">2.1.3.</strong> linux å†…æ ¸å‡çº§(ç¦»çº¿)</a></li><li class="chapter-item expanded "><a href="operations/linux/linux_supervisor_install.html"><strong aria-hidden="true">2.1.4.</strong> supervisord å®‰è£…é…ç½®</a></li><li class="chapter-item expanded "><a href="operations/linux/linux_jdk_install.html"><strong aria-hidden="true">2.1.5.</strong> linux Jdk1.8 å®‰è£…ä¸é…ç½®</a></li><li class="chapter-item expanded "><a href="operations/linux/linux_ops_issues.html"><strong aria-hidden="true">2.1.6.</strong> linux è¿ç»´é—®é¢˜æ’æŸ¥</a></li></ol></li><li class="chapter-item expanded "><a href="operations/docker.html"><strong aria-hidden="true">2.2.</strong> docker</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="operations/docker/linux_docker_installed.html"><strong aria-hidden="true">2.2.1.</strong> docker å®‰è£…ä¸é…ç½®</a></li><li class="chapter-item expanded "><a href="operations/docker/linux_docker_compose_installed.html"><strong aria-hidden="true">2.2.2.</strong> docker-compose å®‰è£…</a></li><li class="chapter-item expanded "><a href="operations/docker/linux_docker_issues.html"><strong aria-hidden="true">2.2.3.</strong> docker ç›¸å…³é—®é¢˜</a></li></ol></li><li class="chapter-item expanded "><a href="operations/mysql.html"><strong aria-hidden="true">2.3.</strong> mysql</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="operations/mysql/mysql_binary_installed.html"><strong aria-hidden="true">2.3.1.</strong> mysql äºŒè¿›åˆ¶å®‰è£…(mysql8 ç‰ˆæœ¬)</a></li></ol></li><li class="chapter-item expanded "><a href="operations/redis.html"><strong aria-hidden="true">2.4.</strong> redis</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="operations/redis/redis_binary_installed.html"><strong aria-hidden="true">2.4.1.</strong> redis äºŒè¿›åˆ¶å®‰è£…ä¸é…ç½®</a></li><li class="chapter-item expanded "><a href="operations/redis/redis_docker_installed.html"><strong aria-hidden="true">2.4.2.</strong> redis docker-compose å®‰è£…ä¸é…ç½®</a></li></ol></li><li class="chapter-item expanded "><a href="operations/mongodb.html"><strong aria-hidden="true">2.5.</strong> mongodb</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="operations/mongodb/mongodb_docker_installed.html"><strong aria-hidden="true">2.5.1.</strong> mongodb docker-compose å®‰è£…ä¸é…ç½®</a></li></ol></li><li class="chapter-item expanded "><a href="operations/etcd.html"><strong aria-hidden="true">2.6.</strong> etcd</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="operations/etcd/etcd_single_node_nossl.html"><strong aria-hidden="true">2.6.1.</strong> etcd docker å®‰è£…(å•èŠ‚ç‚¹æ—  ssl)</a></li></ol></li><li class="chapter-item expanded "><a href="operations/elasticsearch.html"><strong aria-hidden="true">2.7.</strong> elasticsearch</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="operations/elasticsearch/es_docker_installed.html"><strong aria-hidden="true">2.7.1.</strong> elasticsearch docker-compose å®‰è£…ä¸é…ç½®(7.10.0 ç‰ˆæœ¬)</a></li><li class="chapter-item expanded "><a href="operations/elasticsearch/es_ik_installed.html"><strong aria-hidden="true">2.7.2.</strong> elasticsearch ik åˆ†è¯å™¨å®‰è£…(7.10.0 ç‰ˆæœ¬)</a></li></ol></li><li class="chapter-item expanded "><a href="operations/git.html"><strong aria-hidden="true">2.8.</strong> git</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="operations/git/git_operation.html"><strong aria-hidden="true">2.8.1.</strong> git ç‰ˆæœ¬æ§åˆ¶</a></li><li class="chapter-item expanded "><a href="operations/git/git_clone_without_pass.html"><strong aria-hidden="true">2.8.2.</strong> git http æ–¹å¼å…å¯†å…‹éš†ä»£ç </a></li><li class="chapter-item expanded "><a href="operations/git/git_dev_specification.html"><strong aria-hidden="true">2.8.3.</strong> git å¼€å‘ç®¡ç†è§„èŒƒ</a></li></ol></li><li class="chapter-item expanded "><a href="operations/harbor.html"><strong aria-hidden="true">2.9.</strong> harbor</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="operations/harbor/harbor_install.html"><strong aria-hidden="true">2.9.1.</strong> harbor å®‰è£…ä¸é…ç½®</a></li></ol></li><li class="chapter-item expanded "><a href="operations/dns.html"><strong aria-hidden="true">2.10.</strong> dns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="operations/dns/dns_resolution.html"><strong aria-hidden="true">2.10.1.</strong> dns çš„è§£ææµç¨‹</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="cloud_operations.html"><strong aria-hidden="true">3.</strong> äº‘åŸç”Ÿ</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cloud_operations/monitor.html"><strong aria-hidden="true">3.1.</strong> ç›‘æ§</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cloud_operations/monitor/n9e_install.html"><strong aria-hidden="true">3.1.1.</strong> å¤œèºç›‘æ§å®‰è£…é…ç½®</a></li><li class="chapter-item expanded "><a href="cloud_operations/monitor/n9e_ldap_config.html"><strong aria-hidden="true">3.1.2.</strong> å¤œèºé…ç½® ldap å•ç‚¹ç™»å½•</a></li><li class="chapter-item expanded "><a href="cloud_operations/monitor/alert_prom_sql.html"><strong aria-hidden="true">3.1.3.</strong> prometheus ç›‘æ§å‘Šè­¦ sql</a></li><li class="chapter-item expanded "><a href="cloud_operations/monitor/prometheus_domain_monitor.html"><strong aria-hidden="true">3.1.4.</strong> prometheus ç›‘æ§åŸŸå</a></li></ol></li><li class="chapter-item expanded "><a href="cloud_operations/kubernetes.html"><strong aria-hidden="true">3.2.</strong> kubernetes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cloud_operations/kubernetes/kubernetes_sa.html"><strong aria-hidden="true">3.2.1.</strong> kubernetes service account</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cloud_operations/kubernetes/kubernetes_sa/k8s_sa_kubeconfig.html"><strong aria-hidden="true">3.2.1.1.</strong> kubernetees åŸºäº sa åˆ›å»º kubeconfig è®¿é—®(é›†ç¾¤ç‰ˆ)</a></li></ol></li><li class="chapter-item expanded "><a href="cloud_operations/kubernetes/kubernetes_issues.html"><strong aria-hidden="true">3.2.2.</strong> k8s ç›¸å…³é—®é¢˜</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cloud_operations/kubernetes/kubernetes_issues/k8s_secret_issues.html"><strong aria-hidden="true">3.2.2.1.</strong> kubernetes secret ç›¸å…³é—®é¢˜</a></li></ol></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Siriusè¿ç»´å¼€å‘ç¬”è®°</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/einsli/SiriusBlog" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="sirius-è¿ç»´ç¬”è®°"><a class="header" href="#sirius-è¿ç»´ç¬”è®°">Sirius è¿ç»´ç¬”è®°</a></h1>
<blockquote>
<p>è¿ç»´å¼€å‘æ”»åŸç‹®ä¸€æšï¼Œç›®å‰åœ¨æ­å·ï¼Œä¸»è¦åš CICD, K8S è¿ç»´ç›¸å…³,æŠ€æœ¯å®…ï¼</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="åŸºç¡€è¿ç»´"><a class="header" href="#åŸºç¡€è¿ç»´">åŸºç¡€è¿ç»´</a></h1>
<p>è¿™é‡Œä¸»è¦æ˜¯åŸºç¡€è¿ç»´ï¼Œæ¶‰åŠåˆ°åŸºç¡€ç¯å¢ƒæ­å»ºä»¥åŠé…ç½®.</p>
<ul>
<li>
<p><a href="operations/linux.html">linux</a></p>
</li>
<li>
<p><a href="operations/docker.html">docker</a></p>
</li>
<li>
<p><a href="operations/redis.html">redis</a></p>
</li>
<li>
<p><a href="operations/etcd.html">etcd</a></p>
</li>
<li>
<p><a href="operations/git.html">git</a></p>
</li>
<li>
<p><a href="operations/harbor.html">harbor</a></p>
</li>
<li>
<p><a href="operations/mongodb.html">mongodb</a></p>
</li>
<li>
<p><a href="operations/elasticsearch.html">elasticsearch</a></p>
</li>
<li>
<p><a href="operations/dns.html">dns</a></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linux-åŸºç¡€è¿ç»´"><a class="header" href="#linux-åŸºç¡€è¿ç»´">linux åŸºç¡€è¿ç»´</a></h1>
<p>è¿™é‡Œä¸»è¦æ˜¯ linux åŸºç¡€è¿ç»´ï¼Œæ¶‰åŠåˆ° linux åŸºç¡€ç¯å¢ƒæ­å»ºä»¥åŠé…ç½®å’Œç›¸å…³é—®é¢˜çš„å¤„ç†.</p>
<ul>
<li>
<p><a href="operations/linux/linux_base_config.html">linux åŸºç¡€é…ç½®</a></p>
</li>
<li>
<p><a href="operations/linux/linux_kernel_upgrade_online.html">linux å†…æ ¸å‡çº§(çº¿ä¸Š)</a></p>
</li>
<li>
<p><a href="operations/linux/linux_kernel_upgrade_offline.html">linux å†…æ ¸å‡çº§(ç¦»çº¿)</a></p>
</li>
<li>
<p><a href="operations/linux/linux_supervisor_install.html">supervisord å®‰è£…é…ç½®</a></p>
</li>
<li>
<p><a href="operations/linux/linux_jdk_install.html">linux Jdk1.8 å®‰è£…ä¸é…ç½®</a></p>
</li>
<li>
<p><a href="operations/linux/linux_ops_issues.html">linux è¿ç»´é—®é¢˜æ’æŸ¥</a></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linux-åŸºç¡€é…ç½®"><a class="header" href="#linux-åŸºç¡€é…ç½®">linux åŸºç¡€é…ç½®</a></h1>
<h2 id="ä¸€åŠ¡å™¨ç³»ç»Ÿé…ç½®åˆå§‹åŒ–è„šæœ¬"><a class="header" href="#ä¸€åŠ¡å™¨ç³»ç»Ÿé…ç½®åˆå§‹åŒ–è„šæœ¬">ä¸€ã€åŠ¡å™¨ç³»ç»Ÿé…ç½®åˆå§‹åŒ–è„šæœ¬</a></h2>
<p>å½“æ‹¿åˆ°ä¸€å° linux æœåŠ¡å™¨ï¼Œéœ€è¦å¯¹ linux åšä¸€äº›æ“ä½œï¼Œæ¥ä¿è¯åç»­éƒ¨ç½²çš„æœåŠ¡èƒ½å¤Ÿé«˜æ•ˆç¨³å®šçš„è¿è¡Œã€‚</p>
<h3 id="11-å…³é—­-swap-åˆ†åŒº"><a class="header" href="#11-å…³é—­-swap-åˆ†åŒº">1.1 å…³é—­ swap åˆ†åŒº</a></h3>
<p><strong>ä¸´æ—¶å…³é—­</strong></p>
<pre><code class="language-shell">swapoff -a
</code></pre>
<p><strong>æ°¸ä¹…å…³é—­</strong></p>
<p>æ‰“å¼€æ–‡ä»¶<code>/etc/fstab</code></p>
<pre><code class="language-shell">vim /etc/fstab
</code></pre>
<p>æ‰¾åˆ°<code>swap</code>åˆ†åŒºå°†å…¶æ³¨é‡Šæ‰å³å¯</p>
<pre><code class="language-PlainText">#/dev/mapper/cl-swap     swap                    swap    defaults        0 0
</code></pre>
<p><strong>é‡å¯æœºå™¨</strong></p>
<pre><code class="language-shell">reboot
</code></pre>
<h3 id="12-å…³é—­-selinux"><a class="header" href="#12-å…³é—­-selinux">1.2 å…³é—­ selinux</a></h3>
<p><strong>æŸ¥çœ‹ selinux çŠ¶æ€</strong></p>
<pre><code class="language-shell">getenforce
</code></pre>
<p><img src="operations/linux/../../images/operations/linux/enable_selinux.png" alt="avar" /></p>
<p><strong>ä¸´æ—¶å…³é—­</strong></p>
<pre><code class="language-shell">setenforce 0
</code></pre>
<p>é‡å¯ç³»ç»Ÿåè¿˜ä¼šå¼€å¯</p>
<p><strong>æ°¸ä¹…å…³é—­</strong></p>
<pre><code class="language-shell">sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config
sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux
</code></pre>
<p><strong>é‡å¯æœºå™¨</strong></p>
<pre><code class="language-shell">reboot
</code></pre>
<p><strong>å…³é—­åæŸ¥çœ‹ selinux çŠ¶æ€</strong></p>
<pre><code class="language-shell">getenforce
</code></pre>
<p><img src="operations/linux/../../images/operations/linux/disable_selinux.png" alt="avar" /></p>
<h3 id="13-å…³é—­é˜²ç«å¢™"><a class="header" href="#13-å…³é—­é˜²ç«å¢™">1.3 å…³é—­é˜²ç«å¢™</a></h3>
<p>å…³é—­é˜²ç«å¢™å‘½ä»¤å¦‚ä¸‹</p>
<pre><code class="language-shell">systemctl stop firewalld &amp;&amp; systemctl disable firewalld
</code></pre>
<h3 id="14-ä¸»æœºåé…ç½®"><a class="header" href="#14-ä¸»æœºåé…ç½®">1.4 ä¸»æœºåé…ç½®</a></h3>
<p>æ‹¿åˆ°ä¸»æœºåï¼Œéœ€è¦ç»™æœåŠ¡å™¨é…ç½®ä¸€ä¸ªä¸»æœºåï¼Œå°±åƒæ¯ä¸ªäººæœ‰è‡ªå·±çš„åå­—ä¸€æ ·</p>
<p>é…ç½®ä¸»æœºåå‘½ä»¤å¦‚ä¸‹</p>
<pre><code class="language-shell">hostnamectl --static set-hostname sirius
</code></pre>
<h3 id="15-ssh-é…ç½®"><a class="header" href="#15-ssh-é…ç½®">1.5 ssh é…ç½®</a></h3>
<p><strong>å…³é—­ DNS åæŸ¥</strong>
ä½¿ç”¨äº† dns åæŸ¥ï¼Œè¿™ç§æƒ…å†µä¸‹å½“ ssh ç™»å½•æŸä¸ª IP æ—¶ï¼Œç³»ç»Ÿä¼šè¯•å›¾é€šè¿‡ DNS åæŸ¥ç›¸å¯¹åº”çš„åŸŸåï¼Œå¦‚æœ DNS ä¸­æ²¡æœ‰è¿™ä¸ª IP çš„åŸŸåè§£æï¼Œåˆ™ä¼šç­‰åˆ° DNS æŸ¥è¯¢è¶…æ—¶æ‰ä¼šè¿›è¡Œä¸‹ä¸€æ­¥ï¼Œæ¶ˆè€—å¾ˆé•¿æ—¶é—´ã€‚</p>
<p>å…³é—­ dns åæŸ¥å‘½ä»¤å¦‚ä¸‹</p>
<pre><code class="language-shell">sed -ie "/UseDNS/s/yes/no/g;/UseDNS/s/#//g" /etc/ssh/sshd_config
</code></pre>
<p><strong>ä¿®æ”¹ ssh è¶…æ—¶æ—¶é—´</strong></p>
<pre><code class="language-shell">vim /etc/ssh/sshd_config
</code></pre>
<p>ä¿®æ”¹ä¸‹é¢ä¸¤é¡¹</p>
<pre><code class="language-PlainText">ClientAliveInterval 60
ClientAliveCountMax 30
</code></pre>
<p><strong>ç¦ç”¨ ssh å¯†ç ç™»å½•</strong></p>
<p>å¦‚æœæƒ³ç¦ç”¨å¯†ç ç™»å½•ï¼Œå¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p>
<pre><code class="language-shell">sudo sed -i 's/PasswordAuthentication yes/PasswordAuthentication no/g' /etc/ssh/sshd_config
</code></pre>
<p><strong>é‡å¯ ssh æœåŠ¡</strong></p>
<pre><code class="language-shell">systemctl restart sshd
</code></pre>
<h3 id="16-ä¿®æ”¹ç³»ç»Ÿæ—¶åŒº"><a class="header" href="#16-ä¿®æ”¹ç³»ç»Ÿæ—¶åŒº">1.6 ä¿®æ”¹ç³»ç»Ÿæ—¶åŒº</a></h3>
<p>æŸ¥çœ‹ç³»ç»Ÿæ—¶åŒºæ˜¯å¦æ­£å¸¸</p>
<p><img src="operations/linux/../../images/operations/linux/shanghai_timezone.png" alt="avar" /></p>
<p>ä¸Šè¿°å›¾ç‰‡æ˜¯å·²ç»ä¿®æ”¹æ­£å¸¸çŠ¶æ€</p>
<p>ä¿®æ”¹ç³»ç»Ÿæ—¶é—´å‘½ä»¤å¦‚ä¸‹</p>
<pre><code class="language-shell">mv /etc/localtime /etc/localtime.bak
-s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</code></pre>
<p>ç„¶åè¾“å…¥ä¸Šå›¾å‘½ä»¤å³å¯éªŒè¯æ—¶é—´å³å¯</p>
<h4 id="å‚è€ƒæ–‡æ¡£"><a class="header" href="#å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</a></h4>
<ul>
<li><a href="http://bluebiu.com/blog/linux-ssh-session-alive.html">Linux ä½¿ç”¨ ssh è¶…æ—¶æ–­å¼€è¿æ¥çš„çœŸæ­£åŸå› </a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linux-å†…æ ¸å‡çº§"><a class="header" href="#linux-å†…æ ¸å‡çº§">linux å†…æ ¸å‡çº§</a></h1>
<h2 id="ä¸€åœ¨çº¿å‡çº§"><a class="header" href="#ä¸€åœ¨çº¿å‡çº§">ä¸€ã€åœ¨çº¿å‡çº§</a></h2>
<p>æœ¬å‡çº§æ–¹æ³•é€‚ç”¨äºæ‰€æœ‰ Centos7.x ç³»åˆ—çš„ OS</p>
<h3 id="11-æŸ¥çœ‹å½“å‰å†…æ ¸ç‰ˆæœ¬"><a class="header" href="#11-æŸ¥çœ‹å½“å‰å†…æ ¸ç‰ˆæœ¬">1.1 æŸ¥çœ‹å½“å‰å†…æ ¸ç‰ˆæœ¬</a></h3>
<pre><code class="language-shell">$ uname -r
3.10.0-514.el7.x86_64

$ uname -a
Linux hecs-133409 4.18.0-240.10.1.el8_3.x86_64 #1 SMP Mon Jan 18 17:05:51 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux

$ cat /etc/redhat-release
CentOS Linux release 7.3.1611 (Core)
</code></pre>
<h3 id="22-å‡çº§å†…æ ¸"><a class="header" href="#22-å‡çº§å†…æ ¸">2.2 å‡çº§å†…æ ¸</a></h3>
<h4 id="221-æ›´æ–°-yum-ä»“åº“"><a class="header" href="#221-æ›´æ–°-yum-ä»“åº“">2.2.1 æ›´æ–° yum ä»“åº“</a></h4>
<pre><code class="language-shell">yum update
</code></pre>
<h4 id="222-å¯ç”¨-elrepo-ä»“åº“"><a class="header" href="#222-å¯ç”¨-elrepo-ä»“åº“">2.2.2 å¯ç”¨ ELRepo ä»“åº“</a></h4>
<p>ELRepo ä»“åº“æ˜¯åŸºäºç¤¾åŒºçš„ç”¨äºä¼ä¸šçº§ Linux ä»“åº“ï¼Œæä¾›å¯¹ RedHat Enterprise (RHEL) å’Œ å…¶ä»–åŸºäº RHEL çš„ Linux å‘è¡Œç‰ˆï¼ˆCentOSã€Scientificã€Fedora ç­‰ï¼‰çš„æ”¯æŒã€‚
ELRepo èšç„¦äºå’Œç¡¬ä»¶ç›¸å…³çš„è½¯ä»¶åŒ…ï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ã€æ˜¾å¡é©±åŠ¨ã€ç½‘ç»œé©±åŠ¨ã€å£°å¡é©±åŠ¨å’Œæ‘„åƒå¤´é©±åŠ¨ç­‰ã€‚</p>
<h4 id="1-å¯¼å…¥-elrepo-ä»“åº“çš„å…¬å…±å¯†é’¥"><a class="header" href="#1-å¯¼å…¥-elrepo-ä»“åº“çš„å…¬å…±å¯†é’¥">(1) å¯¼å…¥ ELRepo ä»“åº“çš„å…¬å…±å¯†é’¥</a></h4>
<pre><code class="language-shell">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
</code></pre>
<h4 id="2-å®‰è£…-elrepo-ä»“åº“çš„-yum-æº"><a class="header" href="#2-å®‰è£…-elrepo-ä»“åº“çš„-yum-æº">(2) å®‰è£… ELRepo ä»“åº“çš„ yum æº</a></h4>
<pre><code class="language-shell">rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm
</code></pre>
<h4 id="3-æŸ¥çœ‹å¯ç”¨çš„ç³»ç»Ÿå†…æ ¸åŒ…"><a class="header" href="#3-æŸ¥çœ‹å¯ç”¨çš„ç³»ç»Ÿå†…æ ¸åŒ…">(3) æŸ¥çœ‹å¯ç”¨çš„ç³»ç»Ÿå†…æ ¸åŒ…</a></h4>
<pre><code class="language-shell">yum --disablerepo="*" --enablerepo="elrepo-kernel" list available
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹</p>
<pre><code class="language-PlainText">Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
* elrepo-kernel: mirrors.tuna.tsinghua.edu.cn
  elrepo-kernel                                                                         | 2.9 kB  00:00:00
  elrepo-kernel/primary_db                                                              | 1.8 MB  00:00:03
  Available Packages
  kernel-lt.x86_64                                   4.4.155-1.el7.elrepo                    elrepo-kernel
  kernel-lt-devel.x86_64                             4.4.155-1.el7.elrepo                    elrepo-kernel
  kernel-lt-doc.noarch                               4.4.155-1.el7.elrepo                    elrepo-kernel
  kernel-lt-headers.x86_64                           4.4.155-1.el7.elrepo                    elrepo-kernel
  kernel-lt-tools.x86_64                             4.4.155-1.el7.elrepo                    elrepo-kernel
  kernel-lt-tools-libs.x86_64                        4.4.155-1.el7.elrepo                    elrepo-kernel
  kernel-lt-tools-libs-devel.x86_64                  4.4.155-1.el7.elrepo                    elrepo-kernel
  kernel-ml.x86_64                                   4.18.7-1.el7.elrepo                     elrepo-kernel
  kernel-ml-devel.x86_64                             4.18.7-1.el7.elrepo                     elrepo-kernel
  kernel-ml-doc.noarch                               4.18.7-1.el7.elrepo                     elrepo-kernel
  kernel-ml-headers.x86_64                           4.18.7-1.el7.elrepo                     elrepo-kernel
  kernel-ml-tools.x86_64                             4.18.7-1.el7.elrepo                     elrepo-kernel
  kernel-ml-tools-libs.x86_64                        4.18.7-1.el7.elrepo                     elrepo-kernel
  kernel-ml-tools-libs-devel.x86_64                  4.18.7-1.el7.elrepo                     elrepo-kernel
  perf.x86_64                                        4.18.7-1.el7.elrepo                     elrepo-kernel
  python-perf.x86_64                                  4.18.7-1.el7.elrepo                    elrepo-kernel
</code></pre>
<h4 id="4-å®‰è£…æœ€æ–°ç‰ˆæœ¬å†…æ ¸"><a class="header" href="#4-å®‰è£…æœ€æ–°ç‰ˆæœ¬å†…æ ¸">(4) å®‰è£…æœ€æ–°ç‰ˆæœ¬å†…æ ¸</a></h4>
<pre><code class="language-shell">yum --enablerepo=elrepo-kernel install kernel-ml
</code></pre>
<p><font color='red'><strong>--enablerepo</strong></font> é€‰é¡¹å¼€å¯ CentOS ç³»ç»Ÿä¸Šçš„æŒ‡å®šä»“åº“ã€‚é»˜è®¤å¼€å¯çš„æ˜¯<font color='red'><strong>elrepo</strong></font>ï¼Œè¿™é‡Œç”¨ <font color='red'><strong>-kernel</strong></font> æ›¿æ¢</p>
<h4 id="5-è®¾ç½®-grub2"><a class="header" href="#5-è®¾ç½®-grub2">(5) è®¾ç½® grub2</a></h4>
<p>å†…æ ¸å®‰è£…å¥½åï¼Œéœ€è¦è®¾ç½®ä¸ºé»˜è®¤å¯åŠ¨é€‰é¡¹å¹¶é‡å¯åæ‰ä¼šç”Ÿæ•ˆ</p>
<p>1ã€ æŸ¥çœ‹ç³»ç»Ÿä¸Šçš„æ‰€æœ‰å¯ç”¨å†…æ ¸</p>
<pre><code class="language-shell">awk -F\' '$1=="menuentry " {print i++ " : " $2}' /etc/grub2.cfg
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹</p>
<pre><code class="language-PlainText">0 : CentOS Linux (4.18.7-1.el7.elrepo.x86_64) 7 (Core)
1 : CentOS Linux (3.10.0-862.11.6.el7.x86_64) 7 (Core)
2 : CentOS Linux (3.10.0-514.el7.x86_64) 7 (Core)
3 : CentOS Linux (0-rescue-063ec330caa04d4baae54c6902c62e54) 7 (Core)
</code></pre>
<p>2ã€è®¾ç½®æ–°çš„å†…æ ¸ä¸º grub2 çš„é»˜è®¤ç‰ˆæœ¬</p>
<p>æœåŠ¡å™¨ä¸Šå­˜åœ¨ 4 ä¸ªå†…æ ¸ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ 4.18 è¿™ä¸ªç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡ grub2-set-default 0 å‘½ä»¤æˆ–ç¼–è¾‘ /etc/default/grub æ–‡ä»¶æ¥è®¾ç½®</p>
<p>æ–¹æ³•ä¸€ã€é€šè¿‡ <font color='red'><strong>grub2-set-default 0</strong></font> å‘½ä»¤è®¾ç½®</p>
<p>å…¶ä¸­ 0 æ˜¯ä¸Šé¢æŸ¥è¯¢å‡ºæ¥çš„å¯ç”¨å†…æ ¸</p>
<pre><code class="language-shell">grub2-set-default 0
</code></pre>
<p>æ–¹æ³•äºŒã€ç¼–è¾‘ <font color='red'><strong>/etc/default/grub</strong></font> æ–‡ä»¶
è®¾ç½® GRUB_DEFAULT=0ï¼Œé€šè¿‡ä¸Šé¢æŸ¥è¯¢æ˜¾ç¤ºçš„ç¼–å·ä¸º 0 çš„å†…æ ¸ä½œä¸ºé»˜è®¤å†…æ ¸</p>
<pre><code class="language-shell">vim /etc/default/grub
</code></pre>
<pre><code class="language-PlainText">GRUB_TIMEOUT=5
GRUB_DISTRIBUTOR="$(sed 's, release .*$,,g' /etc/system-release)"
GRUB_DEFAULT=0
GRUB_DISABLE_SUBMENU=true
GRUB_TERMINAL_OUTPUT="console"
GRUB_CMDLINE_LINUX="crashkernel=auto rd.lvm.lv=cl/root rhgb quiet"
GRUB_DISABLE_RECOVERY="true"
</code></pre>
<p>3ã€ç”Ÿæˆ grub é…ç½®æ–‡ä»¶å¹¶é‡å¯</p>
<pre><code class="language-shell">grub2-mkconfig -o /boot/grub2/grub.cfg
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹</p>
<pre><code class="language-PlainText">Generating grub configuration file ...
Found linux image: /boot/vmlinuz-4.18.7-1.el7.elrepo.x86_64
Found initrd image: /boot/initramfs-4.18.7-1.el7.elrepo.x86_64.img
Found linux image: /boot/vmlinuz-3.10.0-862.11.6.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-862.11.6.el7.x86_64.img
Found linux image: /boot/vmlinuz-3.10.0-514.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-514.el7.x86_64.img
Found linux image: /boot/vmlinuz-0-rescue-063ec330caa04d4baae54c6902c62e54
Found initrd image: /boot/initramfs-0-rescue-063ec330caa04d4baae54c6902c62e54.img
done
</code></pre>
<p>é‡å¯</p>
<pre><code class="language-shell">reboot
</code></pre>
<p>4ã€éªŒè¯</p>
<pre><code class="language-shell">uname -r
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹</p>
<pre><code class="language-PlainText">4.18.7-1.el7.elrepo.x86_64
</code></pre>
<h3 id="23-åˆ é™¤æ—§çš„å†…æ ¸å¯é€‰"><a class="header" href="#23-åˆ é™¤æ—§çš„å†…æ ¸å¯é€‰">2.3 åˆ é™¤æ—§çš„å†…æ ¸ï¼ˆå¯é€‰ï¼‰</a></h3>
<h4 id="231-æŸ¥çœ‹ç³»ç»Ÿä¸­å…¨éƒ¨çš„å†…æ ¸"><a class="header" href="#231-æŸ¥çœ‹ç³»ç»Ÿä¸­å…¨éƒ¨çš„å†…æ ¸">2.3.1 æŸ¥çœ‹ç³»ç»Ÿä¸­å…¨éƒ¨çš„å†…æ ¸</a></h4>
<pre><code class="language-shell">rpm -qa | grep kernel
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹</p>
<pre><code class="language-PlainText">kernel-3.10.0-514.el7.x86_64
kernel-ml-4.18.7-1.el7.elrepo.x86_64
kernel-tools-libs-3.10.0-862.11.6.el7.x86_64
kernel-tools-3.10.0-862.11.6.el7.x86_64
kernel-3.10.0-862.11.6.el7.x86_64
</code></pre>
<h4 id="232-åˆ é™¤å†…æ ¸"><a class="header" href="#232-åˆ é™¤å†…æ ¸">2.3.2 åˆ é™¤å†…æ ¸</a></h4>
<p>æ–¹æ³•ä¸€ é€šè¿‡ <font color='red'><strong>yum remove</strong></font>åˆ é™¤</p>
<pre><code class="language-shell">yum remove kernel-3.10.0-514.el7.x86_64 \
kernel-ml-4.18.7-1.el7.elrepo.x86_64 \
kernel-tools-libs-3.10.0-862.11.6.el7.x86_64 \
kernel-tools-3.10.0-862.11.6.el7.x86_64 \
kernel-3.10.0-862.11.6.el7.x86_64
</code></pre>
<p>æ–¹æ³•äºŒï¼šä½¿ç”¨ <font color='red'><strong>yum-utils</strong></font>å·¥å…·åˆ é™¤</p>
<p>å¦‚æœå®‰è£…çš„å†…æ ¸ä¸å¤šäº 3 ä¸ªï¼Œ<font color='red'><strong>yum-utils</strong></font> å·¥å…·ä¸ä¼šåˆ é™¤ä»»ä½•ä¸€ä¸ªã€‚åªæœ‰åœ¨å®‰è£…çš„å†…æ ¸å¤§äº 3 ä¸ªæ—¶ï¼Œæ‰ä¼šè‡ªåŠ¨åˆ é™¤æ—§å†…æ ¸ã€‚</p>
<p>å®‰è£… yum-utils</p>
<pre><code class="language-shell">yum install yum-utils
</code></pre>
<p>åˆ é™¤æ—§ç‰ˆæœ¬</p>
<pre><code class="language-shell">package-cleanup --oldkernels
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ç¦»çº¿å‡çº§"><a class="header" href="#ç¦»çº¿å‡çº§">ç¦»çº¿å‡çº§</a></h1>
<h2 id="ä¸€è·å–ç¦»çº¿å‡çº§åŒ…"><a class="header" href="#ä¸€è·å–ç¦»çº¿å‡çº§åŒ…">ä¸€ã€è·å–ç¦»çº¿å‡çº§åŒ…</a></h2>
<p>åˆ°<a href="https://elrepo.org/linux/kernel/el7/x86_64/RPMS/">elrepo</a>çš„ç½‘ç«™ä¸‹è½½æƒ³è¦çš„ç‰ˆæœ¬</p>
<pre><code class="language-shell">wget https://elrepo.org/linux/kernel/el7/x86_64/RPMS/kernel-ml-5.16.10-1.el7.elrepo.x86_64.rpm
wget https://elrepo.org/linux/kernel/el7/x86_64/RPMS/kernel-ml-devel-5.16.10-1.el7.elrepo.x86_64.rpm
</code></pre>
<p>::: warning æ³¨æ„
å¦‚æœåœ¨ç›®æ ‡æœåŠ¡å™¨æ— æ³•ä¸Šç½‘æƒ…å†µä¸‹ä¹Ÿå¯åœ¨è‡ªå·±ç”µè„‘ä¸‹è½½ rpm åŒ…ï¼Œç„¶åä¸Šä¼ åˆ°æœåŠ¡å™¨
:::</p>
<h2 id="äºŒå‡çº§å†…æ ¸"><a class="header" href="#äºŒå‡çº§å†…æ ¸">äºŒã€å‡çº§å†…æ ¸</a></h2>
<h3 id="21-å®‰è£…-rpm-åŒ…"><a class="header" href="#21-å®‰è£…-rpm-åŒ…">2.1 å®‰è£… rpm åŒ…</a></h3>
<pre><code class="language-shell">yum localinstall -y kernel-lt-4.4.206-1.el7.elrepo.x86_64.rpm \
kernel-lt-devel-4.4.206-1.el7.elrepo.x86_64.rpm
</code></pre>
<h3 id="22-æŸ¥çœ‹ç³»ç»Ÿä¸Šçš„æ‰€æœ‰å¯ç”¨å†…æ ¸"><a class="header" href="#22-æŸ¥çœ‹ç³»ç»Ÿä¸Šçš„æ‰€æœ‰å¯ç”¨å†…æ ¸">2.2 æŸ¥çœ‹ç³»ç»Ÿä¸Šçš„æ‰€æœ‰å¯ç”¨å†…æ ¸</a></h3>
<pre><code class="language-shell">awk -F\' '$1=="menuentry " {print i++ " : " $2}' /etc/grub2.cfg
</code></pre>
<pre><code class="language-text">0 : CentOS Linux (5.16.10-1.el7.elrepo.x86_64) 7 (Core)
1 : CentOS Linux (3.10.0-862.11.6.el7.x86_64) 7 (Core)
2 : CentOS Linux (3.10.0-514.el7.x86_64) 7 (Core)
3 : CentOS Linux (0-rescue-063ec330caa04d4baae54c6902c62e54) 7 (Core)
</code></pre>
<p>è®¾ç½®æ–°çš„å†…æ ¸ä¸º grub2 çš„é»˜è®¤ç‰ˆæœ¬
æœåŠ¡å™¨ä¸Šå­˜åœ¨ 4 ä¸ªå†…æ ¸ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ 5.16 è¿™ä¸ªç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡ grub2-set-default 0 å‘½ä»¤æˆ–ç¼–è¾‘ /etc/default/grub æ–‡ä»¶æ¥è®¾ç½®</p>
<h4 id="221-é€šè¿‡-grub2-set-default-0-å‘½ä»¤è®¾ç½®"><a class="header" href="#221-é€šè¿‡-grub2-set-default-0-å‘½ä»¤è®¾ç½®">2.2.1 é€šè¿‡ <font color='red'><strong>grub2-set-default 0</strong></font> å‘½ä»¤è®¾ç½®</a></h4>
<p>å…¶ä¸­ 0 æ˜¯ä¸Šé¢æŸ¥è¯¢å‡ºæ¥çš„å¯ç”¨å†…æ ¸</p>
<pre><code class="language-shell">grub2-set-default 0
</code></pre>
<h4 id="222-æ–¹æ³•-2ç¼–è¾‘-etcdefaultgrub-æ–‡ä»¶"><a class="header" href="#222-æ–¹æ³•-2ç¼–è¾‘-etcdefaultgrub-æ–‡ä»¶">2.2.2 æ–¹æ³• 2ã€ç¼–è¾‘ <font color='red'><strong>/etc/default/grub</strong></font> æ–‡ä»¶</a></h4>
<p>è®¾ç½® GRUB_DEFAULT=0ï¼Œé€šè¿‡ä¸Šé¢æŸ¥è¯¢æ˜¾ç¤ºçš„ç¼–å·ä¸º 0 çš„å†…æ ¸ä½œä¸ºé»˜è®¤å†…æ ¸ï¼š</p>
<pre><code class="language-shell">vim /etc/default/grub
</code></pre>
<pre><code class="language-text">GRUB_TIMEOUT=5
GRUB_DISTRIBUTOR="$(sed 's, release .*$,,g' /etc/system-release)"
GRUB_DEFAULT=0
GRUB_DISABLE_SUBMENU=true
GRUB_TERMINAL_OUTPUT="console"
GRUB_CMDLINE_LINUX="crashkernel=auto rd.lvm.lv=cl/root rhgb quiet"
GRUB_DISABLE_RECOVERY="true"
</code></pre>
<h3 id="23-ç”Ÿæˆ-grub-é…ç½®æ–‡ä»¶å¹¶é‡å¯"><a class="header" href="#23-ç”Ÿæˆ-grub-é…ç½®æ–‡ä»¶å¹¶é‡å¯">2.3 ç”Ÿæˆ grub é…ç½®æ–‡ä»¶å¹¶é‡å¯</a></h3>
<pre><code class="language-shell">grub2-mkconfig -o /boot/grub2/grub.cfg
</code></pre>
<pre><code class="language-text">Generating grub configuration file ...
Found linux image: /boot/vmlinuz-5.16.10-1.el7.elrepo.x86_64
Found initrd image: /boot/initramfs-5.16.10-1.el7.elrepo.x86_64.img
Found linux image: /boot/vmlinuz-3.10.0-862.11.6.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-862.11.6.el7.x86_64.img
Found linux image: /boot/vmlinuz-3.10.0-514.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-514.el7.x86_64.img
Found linux image: /boot/vmlinuz-0-rescue-063ec330caa04d4baae54c6902c62e54
Found initrd image: /boot/initramfs-0-rescue-063ec330caa04d4baae54c6902c62e54.img
done
</code></pre>
<pre><code class="language-shell">reboot
</code></pre>
<h2 id="24-éªŒè¯"><a class="header" href="#24-éªŒè¯">2.4 éªŒè¯</a></h2>
<pre><code class="language-shell">uname -r
</code></pre>
<pre><code class="language-text">5.16.10-1.el7.elrepo.x86_64
</code></pre>
<h2 id="25-åˆ é™¤æ—§çš„å†…æ ¸å¯é€‰"><a class="header" href="#25-åˆ é™¤æ—§çš„å†…æ ¸å¯é€‰">2.5 åˆ é™¤æ—§çš„å†…æ ¸ï¼ˆå¯é€‰ï¼‰</a></h2>
<h3 id="251-æŸ¥çœ‹ç³»ç»Ÿä¸­å…¨éƒ¨çš„å†…æ ¸"><a class="header" href="#251-æŸ¥çœ‹ç³»ç»Ÿä¸­å…¨éƒ¨çš„å†…æ ¸">2.5.1 æŸ¥çœ‹ç³»ç»Ÿä¸­å…¨éƒ¨çš„å†…æ ¸</a></h3>
<pre><code class="language-shell">rpm -qa | grep kernel
</code></pre>
<pre><code class="language-text">kernel-3.10.0-514.el7.x86_64
kernel-ml-5.16.10-1.el7.elrepo.x86_64
kernel-tools-libs-3.10.0-862.11.6.el7.x86_64
kernel-tools-3.10.0-862.11.6.el7.x86_64
kernel-3.10.0-862.11.6.el7.x86_64
</code></pre>
<h4 id="æ–¹æ³•ä¸€é€šè¿‡-yum-removeåˆ é™¤"><a class="header" href="#æ–¹æ³•ä¸€é€šè¿‡-yum-removeåˆ é™¤">æ–¹æ³•ä¸€ï¼šé€šè¿‡ <font color='red'><strong>yum remove</strong></font>åˆ é™¤</a></h4>
<pre><code class="language-shell">yum remove kernel-3.10.0-514.el7.x86_64 \
kernel-tools-libs-3.10.0-862.11.6.el7.x86_64 \
kernel-tools-3.10.0-862.11.6.el7.x86_64 \
kernel-3.10.0-862.11.6.el7.x86_64
</code></pre>
<h4 id="æ–¹æ³•äºŒä½¿ç”¨-yum-utilså·¥å…·åˆ é™¤"><a class="header" href="#æ–¹æ³•äºŒä½¿ç”¨-yum-utilså·¥å…·åˆ é™¤">æ–¹æ³•äºŒï¼šä½¿ç”¨ <font color='red'><strong>yum-utils</strong></font>å·¥å…·åˆ é™¤</a></h4>
<p>å¦‚æœå®‰è£…çš„å†…æ ¸ä¸å¤šäº 3 ä¸ªï¼Œ<font color='red'><strong>yum-utils</strong></font> å·¥å…·ä¸ä¼šåˆ é™¤ä»»ä½•ä¸€ä¸ªã€‚åªæœ‰åœ¨å®‰è£…çš„å†…æ ¸å¤§äº 3 ä¸ªæ—¶ï¼Œæ‰ä¼šè‡ªåŠ¨åˆ é™¤æ—§å†…æ ¸ã€‚</p>
<p>å®‰è£…<font color='red'><strong>yum-utils</strong></font></p>
<pre><code class="language-shell">yum install yum-utils
</code></pre>
<p>åˆ é™¤æ—§ç‰ˆæœ¬</p>
<pre><code class="language-shell">package-cleanup --oldkernels
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="supervisor-å®‰è£…ä¸é…ç½®"><a class="header" href="#supervisor-å®‰è£…ä¸é…ç½®">supervisor å®‰è£…ä¸é…ç½®</a></h1>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… supervisord</p>
<pre><code class="language-shell">yum install supervisor
</code></pre>
<p>æŸ¥çœ‹ç‰ˆæœ¬</p>
<pre><code class="language-shell">supervisord --version
</code></pre>
<p>å¦‚æœéœ€è¦é…ç½®ç•Œé¢è®¿é—®éœ€è¦ä¿®æ”¹<code>supervisord.conf</code></p>
<p>è·¯å¾„å¦‚ä¸‹</p>
<pre><code class="language-PlainText">/etc/supervisord.conf
</code></pre>
<p>ä¿®æ”¹ä»¥ä¸‹å‡ è¡Œ</p>
<pre><code class="language-PlainText">#å¯ç”¨è®¿é—®webæ§åˆ¶ç•Œé¢ï¼Œinet_http_server ä¿®æ”¹å¦‚ä¸‹
[inet_http_server]
port=*:9001

#è®¾ç½®è´¦æˆ·å’Œå¯†ç 
username=user
password=passw0rd

#include part
[include]
files = supervisord.d/*.ini
</code></pre>
<p>å­è¿›ç¨‹é…ç½®æ–‡ä»¶è·¯å¾„ï¼š<code>/etc/supervisord.d/</code></p>
<p>è¿™æ˜¯å®˜ç½‘çš„é…ç½®æ–‡ä»¶ ğŸ‘‰ğŸ»<a href="http://www.supervisord.org/configuration.html">supervisord é…ç½®æ–‡ä»¶å‚è€ƒ</a></p>
<p>åœ¨<code>/etc/supervisord.d/</code> åˆ›å»º<code>test-server.ini</code>,ç”¨äºå¯åŠ¨ä¸€ä¸ª<code>java</code>æœåŠ¡</p>
<pre><code class="language-ini">[program:javaserver]
command=/usr/bin/java -jar app.jar ; è¾“å…¥æ‰§è¡Œå‘½ä»¤ï¼Œè¿™é‡Œè¡¨ç¤º dotnet  demo.dll
directory=/opt/test-server ; åº”ç”¨ç¨‹åºæ ¹ç›®å½•
autostart=true ; æ˜¯å¦è‡ªåŠ¨å¯åŠ¨ï¼Œå½“ supervisor åŠ è½½è¯¥é…ç½®æ–‡ä»¶çš„æ—¶å€™ç«‹å³å¯åŠ¨å®ƒ
autorestart=true ; æ˜¯å¦è‡ªåŠ¨é‡å¯ï¼Œå½“æ‰§è¡Œ dotnet  Deploy.Linux.dll å¯åŠ¨å¤±è´¥æ—¶ï¼Œä¼šé‡å¤çš„è‡ªåŠ¨é‡å¯
logfile_maxbytes=50MB ; è¯¥é…ç½®æ–‡ä»¶è¾“å‡ºå•ä¸ªæ—¥å¿—æ–‡ä»¶çš„å¤§å°
logfile_backups=10 ; æ—¥å¿—å¤‡ä»½ä¸ªæ•°
loglevel=info ; è®°å½•æ—¥å¿—çº§åˆ«
stderr_logfile=/data/logs/java-server.err.log ; æŒ‡å®šæ ‡å‡†é”™è¯¯è¾“å‡ºæ—¥å¿—æ–‡ä»¶
stdout_logfile=/data/logs/java-server.access.log ; æŒ‡å®šæ ‡å‡†è¾“å‡ºæ—¥å¿—æ–‡ä»¶
environment=ASPNETCORE_ENVIRONMENT=Production ; å¯é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¯¥ç¯å¢ƒå˜é‡å°†é€šè¿‡æ‰§è¡Œ dotnet  Deploy.Linux.dll å‘½ä»¤çš„æ—¶å€™ä¼ å…¥åˆ° .NET Core åº”ç”¨ç¨‹åºä¸­
user=root ;å¯åŠ¨æœåŠ¡çš„ç”¨æˆ·
stopsignal=INT
redirect_stderr=true
</code></pre>
<p>åˆ›å»ºæ—¥å¿—è·¯å¾„</p>
<pre><code class="language-shell">mkdir -p /data/logs/
</code></pre>
<p>é‡æ–°åŠ è½½é…ç½®</p>
<pre><code class="language-shell">systemctl daemon-reload
</code></pre>
<p>å¯åŠ¨<code>supervisord</code>å¹¶è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨</p>
<pre><code class="language-shell"># å¯åŠ¨supervisord
systemctl start supervisord

# è®¾ç½®å¼€æœºå¯åŠ¨
systemctl enable supervisord

# æŸ¥çœ‹supervisord çŠ¶æ€
systemctl status supervisord
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linux-jdk18-å®‰è£…ä¸é…ç½®"><a class="header" href="#linux-jdk18-å®‰è£…ä¸é…ç½®">linux Jdk1.8 å®‰è£…ä¸é…ç½®</a></h1>
<h2 id="ä¸€è·å–jdkå®‰è£…åŒ…"><a class="header" href="#ä¸€è·å–jdkå®‰è£…åŒ…">ä¸€ã€è·å–<code>Jdk</code>å®‰è£…åŒ…</a></h2>
<blockquote>
<p>é“¾æ¥: <a href="https://pan.baidu.com/s/1LP1te21pe50DYo2-kKwtuA">ç½‘ç›˜é“¾æ¥</a></p>
<p>æå–ç : ki9k</p>
</blockquote>
<h2 id="äºŒå®‰è£…ä¸é…ç½®"><a class="header" href="#äºŒå®‰è£…ä¸é…ç½®">äºŒã€å®‰è£…ä¸é…ç½®</a></h2>
<h3 id="21-å®‰è£…"><a class="header" href="#21-å®‰è£…">2.1 å®‰è£…</a></h3>
<p>å¯¹ä¸‹è½½çš„æ–‡ä»¶è§£å‹åˆ°æŒ‡å®šç›®å½•</p>
<pre><code class="language-shell">tar -zxvf jdk-8u161-linux-x64.tar.gz -C /usr/local
</code></pre>
<p>å¯¹è§£å‹åçš„æ–‡ä»¶åšä¸‹è½¯é“¾æ¥</p>
<pre><code class="language-shell">ln -s /usr/local/jdk1.8.0_161 /usr/local/java
</code></pre>
<h3 id="22-é…ç½®ç”¨æˆ·ç¯å¢ƒå˜é‡"><a class="header" href="#22-é…ç½®ç”¨æˆ·ç¯å¢ƒå˜é‡">2.2 é…ç½®ç”¨æˆ·ç¯å¢ƒå˜é‡</a></h3>
<pre><code class="language-shell">vim ~/.bashrc
</code></pre>
<p>åœ¨æ–‡ä»¶å°¾éƒ¨æ·»åŠ å¦‚ä¸‹å†…å®¹</p>
<pre><code class="language-shell">export JAVA_HOME=/usr/local/java
export JRE_HOME=$JAVA_HOME/jre
export CLASSPATH=.:$JAVA_HOME/lib:$JRE_HOME/lib:$CLASSPATH
export PATH=$JAVA_HOME/bin:$JRE_HOME/bin:$PATH
</code></pre>
<p>æ·»åŠ å®Œåä¿å­˜</p>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ</p>
<pre><code class="language-shell">source ~/.bashrc
</code></pre>
<h3 id="23-éªŒè¯"><a class="header" href="#23-éªŒè¯">2.3 éªŒè¯</a></h3>
<p>è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯ä¸‹ç‰ˆæœ¬</p>
<pre><code class="language-shell">java -version
</code></pre>
<p>å¾—åˆ°æœ‰å¦‚ä¸‹è¾“å‡º</p>
<pre><code class="language-PlainText">java version "1.8.0_161"

Java(TM) SE Runtime Environment (build 1.8.0_161-b12)

Java HotSpot(TM) 64-Bit Server VM (build 25.161-b12, mixed mode)
</code></pre>
<p>è‡³æ­¤ï¼ŒJdk1.8 é…ç½®å®Œæˆï¼</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linux-è¿ç»´é—®é¢˜æ’æŸ¥"><a class="header" href="#linux-è¿ç»´é—®é¢˜æ’æŸ¥">linux è¿ç»´é—®é¢˜æ’æŸ¥</a></h1>
<h2 id="11-å†…å­˜å ç”¨é«˜çš„é—®é¢˜"><a class="header" href="#11-å†…å­˜å ç”¨é«˜çš„é—®é¢˜">1.1 å†…å­˜å ç”¨é«˜çš„é—®é¢˜</a></h2>
<p><strong>top</strong>
æ’æŸ¥å†…å­˜å ç”¨é«˜çš„è¿›ç¨‹ï¼Œç”¨<code>top</code> å‘½ä»¤ï¼Œç„¶å<code>shift + m</code> æ˜¾ç¤ºå ç”¨å†…å­˜æœ€å¤šçš„è¿›ç¨‹åœ¨æœ€ä¸Šæ–¹</p>
<p><strong>ps</strong></p>
<p>è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå³å¯å¯¹å†…å­˜å ç”¨æ¯”è¾ƒé«˜çš„è¿›è¡Œé€†åºæ’åº</p>
<pre><code class="language-shell">ps aux --sort -rss | head -n 10
</code></pre>
<p>è¯´æ˜:
ps aux ç”¨äºåˆ—å‡ºæ‰€æœ‰è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ï¼Œ<code>--sort -rss`` è¡¨ç¤ºæŒ‰ç…§å†…å­˜å ç”¨é€†åºæ’åºï¼Œ</code>head -n 10` è¡¨ç¤ºåªæ˜¾ç¤ºå‰ 10 è¡Œç»“æœ</p>
<p><strong>htop</strong></p>
<p><code>htop`` æ˜¯ä¸€ä¸ªäº¤äº’å¼çš„è¿›ç¨‹æŸ¥çœ‹å™¨ï¼Œå¯ä»¥ç›´è§‚åœ°æ˜¾ç¤ºç³»ç»Ÿçš„å„é¡¹æŒ‡æ ‡ã€‚åœ¨ç»ˆç«¯ä¸­è¾“å…¥</code>htop`` å‘½ä»¤åï¼ŒæŒ‰ä¸‹<code>F6</code>é”®å¯ä»¥é€‰æ‹©æŒ‰ç…§å†…å­˜å ç”¨æ’åºï¼Œç„¶åå¯ä»¥çœ‹åˆ°å†…å­˜å ç”¨æœ€é«˜çš„è¿›ç¨‹åœ¨æœ€ä¸Šæ–¹ã€‚</p>
<h2 id="12-æ’æŸ¥é—®é¢˜æ˜¯è¿‡æ»¤ç‚¹é…ç½®æ–‡ä»¶ä¸­çš„æ³¨é‡Šå’Œæ¢è¡Œ"><a class="header" href="#12-æ’æŸ¥é—®é¢˜æ˜¯è¿‡æ»¤ç‚¹é…ç½®æ–‡ä»¶ä¸­çš„æ³¨é‡Šå’Œæ¢è¡Œ">1.2 æ’æŸ¥é—®é¢˜æ˜¯ï¼Œè¿‡æ»¤ç‚¹é…ç½®æ–‡ä»¶ä¸­çš„æ³¨é‡Šå’Œæ¢è¡Œ</a></h2>
<p>å¯ä»¥ä½¿ç”¨<code>grep -vE '^\s*(#|$)'</code> æ¥æ“ä½œ</p>
<pre><code class="language-shell">grep -vE '^\s*(#|$)' your_file
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="docker-åŸºç¡€è¿ç»´"><a class="header" href="#docker-åŸºç¡€è¿ç»´">docker åŸºç¡€è¿ç»´</a></h1>
<p>è¿™é‡Œä¸»è¦æ˜¯ docker åŸºç¡€è¿ç»´ï¼Œæ¶‰åŠåˆ° docker åŸºç¡€ç¯å¢ƒæ­å»ºä»¥åŠé…ç½®å’Œç›¸å…³é—®é¢˜çš„å¤„ç†.</p>
<ul>
<li>
<p><a href="operations/docker/linux_docker_installed.html">docker å®‰è£…ä¸é…ç½®</a></p>
</li>
<li>
<p><a href="operations/docker/linux_docker_compose_installed.html">linux docker-compose å®‰è£…</a></p>
</li>
<li>
<p><a href="operations/docker/linux_docker_issues.html">docker ç›¸å…³é—®é¢˜</a></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linux-docker-å®‰è£…ä¸é…ç½®"><a class="header" href="#linux-docker-å®‰è£…ä¸é…ç½®">linux docker å®‰è£…ä¸é…ç½®</a></h1>
<h2 id="ä¸€docker-ç¦»çº¿å®‰è£…"><a class="header" href="#ä¸€docker-ç¦»çº¿å®‰è£…">ä¸€ã€docker ç¦»çº¿å®‰è£…</a></h2>
<h3 id="11ä¸‹è½½ç¦»çº¿å®‰è£…åŒ…"><a class="header" href="#11ä¸‹è½½ç¦»çº¿å®‰è£…åŒ…">1.1ã€ä¸‹è½½ç¦»çº¿å®‰è£…åŒ…</a></h3>
<blockquote>
<p>è®¿é—®åœ°å€: <a href="https://download.docker.com/linux/static/stable/x86_64/">docker ç¦»çº¿ä¸‹è½½åœ°å€</a></p>
<p>é€‰æ‹©å¯¹åº”ç‰ˆæœ¬,æ­¤å¤„é€‰æ‹©<code>docker-20-10.8.tgz</code></p>
</blockquote>
<p><img src="operations/docker/../../images/operations/docker/docker_version_selected.png" alt="avatar" /></p>
<p>å¯ä»¥ä¸‹è½½åˆ°æœ¬åœ°åä¸Šä¼ è‡³æœåŠ¡å™¨ï¼Œæˆ–è€…åœ¨æœåŠ¡å™¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç›´æ¥ä¸‹è½½</p>
<pre><code class="language-shell">yum -y install wget &amp;&amp; wget https://download.docker.com/linux/static/stable/x86_64/docker-20.10.8.tgz
</code></pre>
<h3 id="12è§£å‹å®‰è£…"><a class="header" href="#12è§£å‹å®‰è£…">1.2ã€è§£å‹å®‰è£…</a></h3>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¯¹ç¬¬ä¸€æ­¥ä¸‹è½½çš„<code>docker-20.10.8.tgz</code>è¿›è¡Œè§£å‹</p>
<pre><code class="language-shell">tar -zxvf docker-20.10.8.tgz
</code></pre>
<p>è§£å‹åä¼šå¾—åˆ°ä¸€ä¸ª<code>docker</code>æ–‡ä»¶å¤¹</p>
<p><img src="operations/docker/../../images/operations/docker/docker_extract.png" alt="avatar" /></p>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°† docker å‘½ä»¤æ·»åŠ åˆ°<code>/usr/bin/</code>ç›®å½•ä¸‹</p>
<pre><code class="language-shell">cp docker/* /usr/bin/
</code></pre>
<p>éªŒè¯</p>
<p>è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼ŒéªŒè¯æ˜¯å¦ç”Ÿæ•ˆ</p>
<pre><code class="language-shell">docker version
</code></pre>
<p><img src="operations/docker/../../images/operations/docker/docker_test.png" alt="avatar" /></p>
<p>å‡ºç°ä¸Šè¿°åˆ™è¯´æ˜å®‰è£…æˆåŠŸï¼Œæœ€ä¸‹é¢çš„æŠ¥é”™å¯ä»¥å¿½ç•¥ï¼Œå› ä¸ºç›®å‰<code>docker</code>è¿˜æ²¡å¯åŠ¨</p>
<h3 id="13å¯åŠ¨-docker"><a class="header" href="#13å¯åŠ¨-docker">1.3ã€å¯åŠ¨ docker</a></h3>
<p>éœ€è¦é…ç½® docker.service</p>
<p>docker.service å†…å®¹å¦‚ä¸‹</p>
<pre><code class="language-shell">cat &gt; docker.service &lt;&lt; EOF
[Unit]
Description=Docker Application Container Engine
Documentation=https://docs.docker.com
After=network-online.target firewalld.service containerd.service
Wants=network-online.target

[Service]
Type=notify
ExecStart=/usr/bin/dockerd
ExecReload=/bin/kill -s HUP $MAINPID
TimeoutSec=0
RestartSec=2
Restart=always
StartLimitBurst=3
StartLimitInterval=60s
LimitNOFILE=infinity
LimitNPROC=infinity
LimitCORE=infinity
TasksMax=infinity
Delegate=yes
KillMode=process

[Install]
WantedBy=multi-user.target
EOF
</code></pre>
<p>ç§»åŠ¨ docker.service åˆ°å¦‚ä¸‹ç›®å½•</p>
<pre><code class="language-shell">mv docker.service /usr/lib/systemd/system/
</code></pre>
<p>é‡æ–°åŠ è½½é…ç½®</p>
<pre><code class="language-shell">systemctl daemon-reload
</code></pre>
<p>å¯åŠ¨ docker</p>
<pre><code class="language-shell">systemctl start docker
</code></pre>
<p>è®¾ç½®å¼€æœºè‡ªå¯</p>
<pre><code class="language-shell">systemctl enable docker
</code></pre>
<p>éªŒè¯</p>
<p>è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå³å¯æŸ¥çœ‹ docker æ˜¯å¦å¯åŠ¨</p>
<pre><code class="language-shell">systemctl status docker
</code></pre>
<p><img src="operations/docker/../../images/operations/docker/docker_status.png" alt="avatar" /></p>
<p>å¯åŠ¨æˆåŠŸï¼Œåˆ°æ­¤ docker å®‰è£…ç»“æŸ!</p>
<h2 id="äºŒdocker-åœ¨çº¿å®‰è£…"><a class="header" href="#äºŒdocker-åœ¨çº¿å®‰è£…">äºŒã€docker åœ¨çº¿å®‰è£…</a></h2>
<h3 id="21å¸è½½å·²æœ‰-docker-æœåŠ¡"><a class="header" href="#21å¸è½½å·²æœ‰-docker-æœåŠ¡">2.1ã€å¸è½½å·²æœ‰ docker æœåŠ¡</a></h3>
<pre><code class="language-shell">yum remove docker \
     docker-client \
     docker-client-latest \
     docker-common \
     docker-latest \
     docker-latest-logrotate \
     docker-logrotate \
     docker-engine
</code></pre>
<h3 id="22å®‰è£…-epel-æ›´æ–°æº"><a class="header" href="#22å®‰è£…-epel-æ›´æ–°æº">2.2ã€å®‰è£… epel æ›´æ–°æº</a></h3>
<pre><code class="language-shell">yum install -y epel-release
</code></pre>
<h3 id="23å®‰è£…-docker-ä»“åº“"><a class="header" href="#23å®‰è£…-docker-ä»“åº“">2.3ã€å®‰è£… docker ä»“åº“</a></h3>
<pre><code>yum install -y yum-utils device-mapper-persistent-data lvm2
</code></pre>
<p>è®¾ç½®ç¨³å®šä»“åº“ï¼Œå°†æŒ‡å®šæ–‡ä»¶æˆ– url æ·»åŠ ä¸º yum æºå¹¶å¯ç”¨</p>
<pre><code class="language-shell"># å®˜æ–¹æº
yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo

# å®˜æ–¹æºé€Ÿåº¦è¾ƒæ…¢ï¼Œå¯ä»¥ä¿®æ”¹ä¸ºæ·»åŠ å›½å†…åŸ
yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre>
<p><strong>å¦‚æœæç¤º<code>yum-config-manager not found</code>ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…</strong></p>
<pre><code class="language-shell">yum install yum-utils
</code></pre>
<h3 id="24å®‰è£…-docker"><a class="header" href="#24å®‰è£…-docker">2.4ã€å®‰è£… docker</a></h3>
<p>æŒ‰ç‰ˆæœ¬å·æ’åºåˆ—å‡ºå­˜å‚¨åº“ä¸­å¯ç”¨çš„ç‰ˆæœ¬å·</p>
<pre><code class="language-PlainText">(base) [root@moushi-ops-navigation-100 ~]# yum list docker-ce --showduplicates | sort -r
docker-ce.x86_64            3:24.0.6-1.el7                      docker-ce-stable
docker-ce.x86_64            3:24.0.5-1.el7                      docker-ce-stable
docker-ce.x86_64            3:24.0.4-1.el7                      docker-ce-stable
docker-ce.x86_64            3:24.0.3-1.el7                      docker-ce-stable
docker-ce.x86_64            3:24.0.2-1.el7                      docker-ce-stable
docker-ce.x86_64            3:24.0.1-1.el7                      docker-ce-stable
docker-ce.x86_64            3:24.0.0-1.el7                      docker-ce-stable
docker-ce.x86_64            3:23.0.6-1.el7                      docker-ce-stable
docker-ce.x86_64            3:23.0.5-1.el7                      docker-ce-stable
docker-ce.x86_64            3:23.0.4-1.el7                      docker-ce-stable
docker-ce.x86_64            3:23.0.3-1.el7                      docker-ce-stable
docker-ce.x86_64            3:23.0.2-1.el7                      docker-ce-stable
docker-ce.x86_64            3:23.0.1-1.el7                      docker-ce-stable
docker-ce.x86_64            3:23.0.0-1.el7                      docker-ce-stable
......
</code></pre>
<p>æ ¹æ®éœ€è¦è‡ªè¡Œé€‰æ‹©éœ€è¦å®‰è£…çš„ç‰ˆæœ¬</p>
<pre><code class="language-shell"># é»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬docker
yum install -y docker-ce docker-ce-cli containerd.io

# æ­¤å¤„å®‰è£…æŒ‡å®šç‰ˆæœ¬docker
yum install -y docker-ce-23.0.0-1.el7 docker-ce-cli-23.0.0-1.el7 containerd.io

# å®‰è£…dockerå‘½ä»¤è¡¥å…¨å·¥å…·
yum install -y bash-completion
</code></pre>
<h3 id="25å¯åŠ¨-docker"><a class="header" href="#25å¯åŠ¨-docker">2.5ã€å¯åŠ¨ docker</a></h3>
<p>å¯åŠ¨ docker</p>
<pre><code class="language-shell">systemctl start docker
</code></pre>
<p>è®¾ç½®å¼€æœºè‡ªå¯</p>
<pre><code class="language-shell">systemctl enable docker
</code></pre>
<h2 id="ä¸‰docker-é…ç½®"><a class="header" href="#ä¸‰docker-é…ç½®">ä¸‰ã€docker é…ç½®</a></h2>
<h3 id="31-é…ç½®-docker-é•œåƒä¸‹è½½åŠ é€Ÿå™¨"><a class="header" href="#31-é…ç½®-docker-é•œåƒä¸‹è½½åŠ é€Ÿå™¨">3.1 é…ç½® docker é•œåƒä¸‹è½½åŠ é€Ÿå™¨</a></h3>
<pre><code class="language-shell">tee /etc/docker/daemon.json &lt;&lt; eof
{
    "registry-mirrors": [
        "https://1nj0zren.mirror.aliyuncs.com",
        "https://docker.mirrors.ustc.edu.cn",
        "http://f1361db2.m.daocloud.io",
        "https://registry.docker-cn.com"
    ]
}
eof
</code></pre>
<h3 id="32-ä¿®æ”¹-docker-çš„é»˜è®¤é•œåƒå®¹å™¨æ•°æ®å­˜å‚¨ä½ç½®"><a class="header" href="#32-ä¿®æ”¹-docker-çš„é»˜è®¤é•œåƒå®¹å™¨æ•°æ®å­˜å‚¨ä½ç½®">3.2 ä¿®æ”¹ docker çš„é»˜è®¤é•œåƒã€å®¹å™¨æ•°æ®å­˜å‚¨ä½ç½®</a></h3>
<p>docker çš„é»˜è®¤å­˜å‚¨ä½ç½®æ˜¯ /var/lib/docker/ ï¼Œåœ¨æ ¹ç›®å½•ä¸‹ï¼Œdocker è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œä¼šå¯¼è‡´æ ¹ç›®å½•å­˜å‚¨çˆ†ç‚¸ã€‚æ‰€æœ‰æœ€å¥½å°†å­˜å‚¨ä½ç½®è‡ªå®šä¹‰åˆ°æœåŠ¡å™¨å­˜å‚¨æœ€å¤§çš„ç›®å½•ä¸‹ã€‚</p>
<p>ç„¶ååœ¨ <code>/etc/docker/daemon.json</code> æ–‡ä»¶ä¸­æŒ‡å®šé»˜è®¤å­˜å‚¨è·¯å¾„ï¼ˆæ­¤è·¯å¾„å¯è‡ªå®šä¹‰ï¼‰ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code class="language-PlainText">"data-root": "/vdb/docker_images"
</code></pre>
<p>ä¿®æ”¹å¦‚ä¸‹</p>
<pre><code class="language-json">{
  "registry-mirrors": [
    "https://1nj0zren.mirror.aliyuncs.com",
    "https://docker.mirrors.ustc.edu.cn",
    "http://f1361db2.m.daocloud.io",
    "https://registry.docker-cn.com"
  ],
  "data-root": "/vdb/docker_images"
}
</code></pre>
<h3 id="33-é‡æ–°åŠ è½½é…ç½®ä¸é‡å¯-docker"><a class="header" href="#33-é‡æ–°åŠ è½½é…ç½®ä¸é‡å¯-docker">3.3 é‡æ–°åŠ è½½é…ç½®ä¸é‡å¯ docker</a></h3>
<p>é‡æ–°åŠ è½½é…ç½®</p>
<pre><code class="language-shell">systemctl daemon-reload
</code></pre>
<p>é‡æ–°å¯åŠ¨ docker</p>
<pre><code class="language-shell">systemctl restart docker
</code></pre>
<h4 id="å‚è€ƒæ–‡æ¡£-1"><a class="header" href="#å‚è€ƒæ–‡æ¡£-1">å‚è€ƒæ–‡æ¡£</a></h4>
<p><a href="https://blog.csdn.net/Sara_cloud/article/details/111193087">1.Docker ç³»åˆ—ä¹‹ä¸€ï¼šåœ¨çº¿å®‰è£… docker å’Œä¸‹è½½é•œåƒ</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linux-docker-compose-å®‰è£…"><a class="header" href="#linux-docker-compose-å®‰è£…">linux docker-compose å®‰è£…</a></h1>
<h2 id="å‰æœŸå‡†å¤‡"><a class="header" href="#å‰æœŸå‡†å¤‡">å‰æœŸå‡†å¤‡</a></h2>
<blockquote>
<p>å®‰è£…ä¹‹å‰ï¼Œè¯·å…ˆç¡®ä¿ docker å·²ç»å®‰è£…ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…ï¼Œè¯·å‚è€ƒ<a href="operations/docker/linux_docker_installed.html">linux docker å®‰è£…ä¸é…ç½®</a></p>
<p>docker-compose å„ç‰ˆæœ¬ <a href="https://github.com/docker/compose/releases">ä¸‹è½½åœ°å€</a></p>
</blockquote>
<h2 id="äºŒè¿›åˆ¶å®‰è£…-docker-compose"><a class="header" href="#äºŒè¿›åˆ¶å®‰è£…-docker-compose">äºŒè¿›åˆ¶å®‰è£… docker-compose</a></h2>
<p>1ã€ä¸‹è½½å¯¹åº” linux ç‰ˆæœ¬çš„ docker-compose äºŒè¿›åˆ¶æ–‡ä»¶</p>
<pre><code class="language-shell">yum -y install wget
wget https://github.com/docker/compose/releases/download/v2.21.0/docker-compose-linux-x86_64
</code></pre>
<p>2ã€èµ‹äºˆæ‰§è¡Œæƒé™</p>
<pre><code class="language-shell">chmod +x docker-compose-linux-x86_64
</code></pre>
<p>3ã€ç§»åŠ¨åˆ°<code>/usr/bin/</code> è·¯å¾„ä¸‹ï¼Œå¹¶é‡å‘½åä¸º<code>docker-compose</code></p>
<pre><code class="language-shell">mv docker-compose-linux-x86_64 /usr/bin/docker-compose
</code></pre>
<p>4ã€éªŒè¯å¹¶æŸ¥çœ‹ç‰ˆæœ¬</p>
<pre><code class="language-shell">docker-compose version
</code></pre>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåˆ™å®‰è£…æˆåŠŸ</p>
<p><img src="operations/docker/../../images/operations/docker/docker-compose-version.png" alt="avatar" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="è¿™é‡Œä¸»è¦è®°å½•-docker-ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ä»¥åŠè§£å†³åŠæ³•"><a class="header" href="#è¿™é‡Œä¸»è¦è®°å½•-docker-ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ä»¥åŠè§£å†³åŠæ³•">è¿™é‡Œä¸»è¦è®°å½• docker ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ä»¥åŠè§£å†³åŠæ³•</a></h1>
<h2 id="1pip-install-upgrade-pip-æŠ¥é”™-runtimeerror-cant-start-new-thread"><a class="header" href="#1pip-install-upgrade-pip-æŠ¥é”™-runtimeerror-cant-start-new-thread">1ã€pip install â€“upgrade pip æŠ¥é”™ RuntimeError: canâ€™t start new thread</a></h2>
<p><strong>é—®é¢˜æè¿°</strong></p>
<p>docker ç‰ˆæœ¬ 20.10.8
python é¡¹ç›®æ‰“åŒ…ï¼Œdocker åŸºç¡€é•œåƒç”¨çš„æ˜¯<code>python:3.8</code>,ç„¶åæ„å»ºæŠ¥é”™å¦‚ä¸‹</p>
<p><strong>RuntimeError: canâ€™t start new thread</strong></p>
<p>âœ… <strong>è§£å†³æ–¹æ³•</strong></p>
<blockquote>
<p>åŸºç¡€é•œåƒé—®é¢˜ï¼Œå°†é•œåƒç”±<code>python:3.8</code> æ¢æˆ<code>python3.6</code>å³å¯ï¼Œå‰ææ˜¯å¯¹<code>python</code>è¦æ±‚ç‰ˆæœ¬ä¸é«˜ï¼Œå¦‚æœå¯¹ç‰ˆæœ¬è¦æ±‚è¿‡é«˜ï¼Œéœ€è¦è‡ªå·±å•ç‹¬åšé•œåƒ</p>
<p>docker ç‰ˆæœ¬è¿‡ä½é—®é¢˜ï¼Œéœ€è¦å‡çº§ docker ç‰ˆæœ¬</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mysql-åŸºç¡€è¿ç»´"><a class="header" href="#mysql-åŸºç¡€è¿ç»´">mysql åŸºç¡€è¿ç»´</a></h1>
<p>è¿™é‡Œä¸»è¦æ˜¯ mysql åŸºç¡€è¿ç»´ï¼Œæ¶‰åŠåˆ° mysql åŸºç¡€ç¯å¢ƒæ­å»ºä»¥åŠé…ç½®å’Œç›¸å…³é—®é¢˜çš„å¤„ç†.</p>
<ul>
<li><a href="operations/mysql/mysql_binary_installed.html">mysql äºŒè¿›åˆ¶å®‰è£…ä¸é…ç½®(mysql8 ç‰ˆæœ¬)</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mysql-äºŒè¿›åˆ¶å®‰è£…ä¸é…ç½®"><a class="header" href="#mysql-äºŒè¿›åˆ¶å®‰è£…ä¸é…ç½®">mysql äºŒè¿›åˆ¶å®‰è£…ä¸é…ç½®</a></h1>
<blockquote>
<p>mysql å„ç‰ˆæœ¬<a href="https://downloads.mysql.com/archives/community/">ä¸‹è½½åœ°å€</a></p>
</blockquote>
<h2 id="å‰æœŸå‡†å¤‡-1"><a class="header" href="#å‰æœŸå‡†å¤‡-1">å‰æœŸå‡†å¤‡</a></h2>
<p>1ã€ä¾èµ–<code>c</code>ç¯å¢ƒ</p>
<p>å¦‚æœæ²¡æœ‰å®‰è£…<code>c</code>ç¯å¢ƒï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œéƒ¨ç½²å®‰è£…<code>c</code>ç¯å¢ƒ</p>
<pre><code class="language-shell">yum -y install gcc-c++
</code></pre>
<p>2ã€å®‰è£… <code>libaio</code>åº“</p>
<p>å¦‚æœæœªå®‰è£…ï¼Œåœ¨åˆå§‹åŒ–æ—¶å¯èƒ½é‡åˆ°ä¸‹é¢çš„æŠ¥é”™ï¼š</p>
<pre><code class="language-PlainText">bin/mysqld: error while loading shared libraries: libaio.so.1: cannot open shared object file: No such file or directory
</code></pre>
<pre><code class="language-shell">yum -y install libaio
</code></pre>
<p>3ã€åˆ é™¤ç³»ç»Ÿé»˜è®¤è‡ªå¸¦çš„`mariadb``</p>
<p>æŸ¥è¯¢æœ‰æ²¡æœ‰å®‰è£… `mariadb``</p>
<pre><code class="language-shell">rpm -aq | grep mariadb
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹</p>
<pre><code class="language-PlainText">mariadb-libs-5.5.68-1.el7.x86_64
</code></pre>
<p>å¦‚æœè¾“å‡ºä¸ºç©º,å¿½ç•¥è¿™ä¸€æ­¥</p>
<p>åˆ é™¤ <code>mariadb</code></p>
<pre><code class="language-shell">rpm -e --nodeps mariadb-libs-5.5.68-1.el7.x86_64
</code></pre>
<p>4ã€æ–°å»º<code>mysql</code>ç”¨æˆ·</p>
<pre><code class="language-shell"># åˆ›å»ºmysql ç»„
groupadd mysql
# åˆ›å»ºmysqlç”¨æˆ·
useradd -r -g mysql -s /bin/false mysql
</code></pre>
<h2 id="äºŒè¿›åˆ¶å®‰è£…"><a class="header" href="#äºŒè¿›åˆ¶å®‰è£…">äºŒè¿›åˆ¶å®‰è£…</a></h2>
<p>ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶ ğŸ‘‰ğŸ»<a href="https://cdn.mysql.com/archives/mysql-8.0/mysql-8.0.11-linux-glibc2.12-x86_64.tar.gz">mysql-8.0.11-linux-glibc2.12-x86_64.tar.gz</a></p>
<pre><code class="language-shell">wget https://cdn.mysql.com/archives/mysql-8.0/mysql-8.0.11-linux-glibc2.12-x86_64.tar.gz
</code></pre>
<p><strong>æ³¨:</strong> å¦‚æœä¸Šè¿°æ–¹å¼ä¸‹è½½å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨ä¸‹è½½åä¼ è‡³æœåŠ¡å™¨</p>
<p><strong>è§£å‹</strong></p>
<pre><code class="language-shell"># è§£å‹
tar -zxvf mysql-8.0.11-linux-glibc2.12-x86_64.tar.gz -C /opt/
# é‡å‘½å
mv /opt/mysql-8.0.11-linux-glibc2.12-x86_64 /opt/mysql8.0
</code></pre>
<p>åœ¨<code>myql8.0</code>ç›®å½•ä¸‹æ–°å»ºæ•°æ®ç›®å½•å’ŒåŠ è½½ç›®å½•</p>
<pre><code class="language-shell">cd /opt/mysql8.0
mkdir data            # æ•°æ®ç›®å½•
mkdir mysql-files     # æ•°æ®åŠ è½½ç›®å½•ï¼Œç”±å‚æ•°secure_file_privæŒ‡å®š
chmod 750 mysql-files # ä¿®æ”¹åŠ è½½ç›®å½•æƒé™
mkdir tmp             # ä¸´æ—¶ç›®å½•
chmod 750 tmp         # ä¿®æ”¹æƒé™
</code></pre>
<p>å°†<code>/opt/mysql8.0</code>å±ä¸»ä¿®æ”¹ä¸º<code>mysql</code>ç”¨æˆ·</p>
<pre><code class="language-shell">cd /opt
chown -R mysql:mysql mysql8.0
</code></pre>
<p>åœ¨<code>/var/lib</code>ç›®å½•ä¸‹æ–°å»ºè½¯é“¾æ¥è‡³<code>/opt/mysql8.0</code>ï¼ˆåç»­å¦‚æœå®‰è£…äº†å¤šä¸ªç‰ˆæœ¬çš„ <code>mysql</code>ï¼Œåªéœ€è¦å°†è½¯é“¾æ¥åˆ é™¤ï¼Œé‡æ–°é“¾æ¥è‡³å¯¹åº”ç‰ˆæœ¬ç›®å½•å³å¯ï¼‰</p>
<pre><code class="language-shell">cd /var/lib
ln -s /opt/mysql8.0 mysql
</code></pre>
<p>åˆ›å»º<code>mysqld</code>æ–‡ä»¶ï¼Œç”¨äºå­˜å‚¨<code>pid</code>æ–‡ä»¶</p>
<pre><code class="language-shell">mkdir /var/run/mysqld
chown -R mysql:mysql /var/run/mysqld
</code></pre>
<p><strong>æ³¨:</strong> ä¸Šè¿°æ–‡ä»¶è·¯å¾„ï¼Œéƒ½åœ¨ä¸‹é¢é…ç½®æ–‡ä»¶ä¸­ä½“ç°ï¼Œå¦‚æœ‰ä¿®æ”¹ï¼Œéœ€ä¿®æ”¹é…ç½®æ–‡ä»¶</p>
<p><strong>å‡†å¤‡é…ç½®æ–‡ä»¶</strong></p>
<p>å‡†å¤‡é…ç½®æ–‡ä»¶<code>my.cnf</code>ï¼Œå¹¶æ”¾åˆ°<code>/etc</code>ç›®å½•ä¸‹ï¼ˆ<code>/etc/my.cnf</code>ï¼‰</p>
<pre><code class="language-shell">touch /etc/my.cnf
</code></pre>
<p>å¦‚æœå­˜åœ¨ä¸éœ€è¦æ‰§è¡Œä¸Šè¿°å‘½ä»¤</p>
<p>ä¸‹é¢å‡†å¤‡äº†ä¸€ä»½ç¤ºä¾‹ my.cnf æ–‡ä»¶ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è‡ªè¡Œä¿®æ”¹ï¼Œå‡ ç‚¹è¯´æ˜å¦‚ä¸‹ï¼š</p>
<ul>
<li>default_authentication_pluginï¼Œé»˜è®¤çš„å¯†ç è®¤è¯æ–¹å¼ç‰¹åœ°è®¾ç½®å’Œæ—§ç‰ˆæœ¬ä¸€è‡´ï¼Œé˜²æ­¢æŸäº›æ—§çš„å·¥å…·è¿ä¸ä¸Š mysql.</li>
<li>innodb_buffer_pool_size è®¾ç½®ä¸º 2Gï¼ˆ2 ä¸ªæ± ï¼‰ï¼Œè‡ªè¡Œæ ¹æ®æœºå™¨æƒ…å†µè°ƒæ•´ï¼Œå¦‚æœæ˜¯ä¸“å±æ•°æ®åº“æœåŠ¡å™¨ï¼Œå»ºè®®è®¾ç½®ä¸ºç‰©ç†å†…å­˜çš„ 60%~75%</li>
</ul>
<pre><code class="language-cnf"># MySQL configuration file for MySQL 8.0
# For explanations see
# http://dev.mysql.com/doc/mysql/en/server-system-variables.html

[mysqld]
# Server settings
user = mysql
# set server port
port = 3306
# sock file
socket = /var/lib/mysql/mysql.sock
# pid file
pid-file = /var/run/mysqld/mysqld.pid
# log file
log-error = /var/log/mysqld.log
# tmp dir
tmpdir = /var/lib/mysql/tmp
# tmp table size
tmp_table_size = 64M
# install dir
basedir = /var/lib/mysql
# data dir
datadir = /var/lib/mysql/data
# bind address
bind_address = 0.0.0.0
# max connections
max_connections = 3600
# max connect errors
max_connect_errors = 200
# auto commit
autocommit = ON
# table data not save to disk
symbolic-links = 0
# log time format
log_timestamps = system
# transaction isolation
transaction_isolation = read-committed
# When MySQL is restarted or restored, only the first and last binlog files are scanned
binlog_gtid_simple_recovery = ON
# default server character set
character-set-server = utf8mb4
# default server collation set
collation-server = utf8mb4_general_ci
# table swift cache
table_open_cache = 4096
# open files limit
open_files_limit = 65535
# connect timeout
connect_timeout = 9
# default storage engine is innodb
default-storage-engine = InnoDB
# slow log enable
slow_query_log = ON

# Binary log settings
# set server id
server-id = 1
# binlog enable
log-bin = mysql-bin
# binlog format
binlog_format = row
# binglog file size
max_binlog_size = 100M

# Innodb Settings
# innodb tmp dir
innodb_tmpdir = /var/lib/mysql/tmp/innodb
# innodb cache pool size (This value is 80% of the total memory)
innodb_buffer_pool_size = 2G

# Slow query log settings
# slow query enable
slow_query_log = ON
# slow query log file
slow_query_log_file = /var/log/mysql-slow.log
# slow query time
long_query_time = 1
# slow query admin log enable
log_slow_admin_statements = ON
# slow query slave log enable
log_slow_slave_statements = ON
# slow query not using index
log_queries_not_using_indexes = OFF

# lower case
lower_case_table_names = 1

# mysql config
[mysql]
socket=/usr/local/mysql/mysql.sock

# client set
[client]
port = 3306
# server sock file
socket = /var/lib/mysql/mysql.sock
</code></pre>
<p><strong>åˆå§‹åŒ–æ•°æ®åº“å®ä¾‹ï¼ˆæ³¨æ„è®°å½•åˆå§‹ root å¯†ç </strong></p>
<pre><code class="language-shell">cd /var/lib/mysql
bin/mysqld --initialize --user=mysql --basedir=/var/lib/mysql --datadir=/var/lib/mysql/data --lower-case-table-names=1
</code></pre>
<p>åˆå§‹åŒ–å®ŒæˆåŠŸï¼Œè¾“å‡ºå¦‚ä¸‹
<img src="operations/mysql/../../images/msyql/mysql_init.png" alt="avatar" /></p>
<p>ä¸Šè¿°å›¾ç‰‡ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåˆå§‹åŒ–å¯†ç : dKhsuaSWI3&lt;k</p>
<p><strong>æ³¨</strong> å¦‚æœè¿™é‡Œåˆå§‹åŒ–æ—¶é‡åˆ° <code>could not open /var/log/mysqld.log</code> ç­‰æŠ¥é”™ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ›å»ºæ­¤æ–‡ä»¶å¹¶å°†å±ä¸»æ”¹ä¸º <code>mysql</code></p>
<pre><code class="language-shell">touch /var/log/mysqld.log
chown -R mysql:mysql /var/log/mysqld.log
touch /var/log/mysql-slow.log
chown -R mysql:mysql /var/log/mysql-slow.log
</code></pre>
<p><strong>é…ç½® PATH ç¯å¢ƒå˜é‡</strong></p>
<p>è¿™é‡Œä»¥<code>root</code>ç”¨æˆ·æ¼”ç¤º</p>
<pre><code class="language-shell">vim ~/.bashrc

# é…ç½®mysql ç¯å¢ƒå˜é‡
export MYSQL_HOME="/var/lib/mysql"
export PATH="${PATH}:${MYSQL_HOME}/bin"

# ä¿å­˜åï¼Œåˆ·æ–°ä¸‹ç¯å¢ƒå˜é‡
source ~/.bashrc
</code></pre>
<p><strong>å¯åŠ¨ å¹¶ç™»å½• mysql</strong></p>
<p>ä½¿ç”¨åˆå§‹å¯†ç ç™»å½•ï¼ˆå¦‚æœæ²¡è®°ä½å»<code>/var/log/mysqld.log</code>ä¸­æ‰¾ï¼‰ï¼Œå¹¶ä¿®æ”¹ root å¯†ç </p>
<pre><code class="language-shell"># å¯åŠ¨mysql
nohup mysqld_safe &amp;
# ä½¿ç”¨åˆå§‹å¯†ç ç™»å½•
mysql -uroot -p'dKhsuaSWI3&lt;k'
</code></pre>
<pre><code class="language-sql"># ç™»å½•åä¿®æ”¹rootå¯†ç 
ALTER USER 'root'@localhost identified BY 'passw0rd';
</code></pre>
<p>åˆ›å»ºæ–°ç”¨æˆ·ï¼Œç”¨äºè¿œç¨‹ç™»å½•æ“ä½œ</p>
<pre><code class="language-sql">CREATE USER 'dev'@'%' IDENTIFIED BY 'passw0rd';
GRANT ALL PRIVILEGES ON *.* TO 'dev'@'%' WITH GRANT OPTION;
FLUSH PRIVILEGES;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="redis-åŸºç¡€è¿ç»´"><a class="header" href="#redis-åŸºç¡€è¿ç»´">redis åŸºç¡€è¿ç»´</a></h1>
<p>è¿™é‡Œä¸»è¦æ˜¯ redis åŸºç¡€è¿ç»´ï¼Œæ¶‰åŠåˆ° redis åŸºç¡€ç¯å¢ƒæ­å»ºä»¥åŠé…ç½®å’Œç›¸å…³é—®é¢˜çš„å¤„ç†.</p>
<ul>
<li><a href="operations/redis/redis_binary_installed.html">redis äºŒè¿›åˆ¶å®‰è£…ä¸é…ç½®</a></li>
<li><a href="operations/redis/redis_docker_installed.html">redis docker-compose å®‰è£…ä¸é…ç½®</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="redis-äºŒè¿›åˆ¶å®‰è£…ä¸é…ç½®"><a class="header" href="#redis-äºŒè¿›åˆ¶å®‰è£…ä¸é…ç½®">redis äºŒè¿›åˆ¶å®‰è£…ä¸é…ç½®</a></h1>
<blockquote>
<p>redis å„ç‰ˆæœ¬<a href="http://download.redis.io/releases/">ä¸‹è½½åœ°å€</a></p>
</blockquote>
<h2 id="å‰æœŸå‡†å¤‡-2"><a class="header" href="#å‰æœŸå‡†å¤‡-2">å‰æœŸå‡†å¤‡</a></h2>
<p>ä¾èµ–<code>c</code>ç¯å¢ƒ</p>
<p>å¦‚æœæ²¡æœ‰å®‰è£…<code>c</code>ç¯å¢ƒï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œéƒ¨ç½²å®‰è£…<code>c</code>ç¯å¢ƒ</p>
<pre><code class="language-shell">yum -y install gcc-c++
</code></pre>
<h2 id="äºŒè¿›åˆ¶å®‰è£…-1"><a class="header" href="#äºŒè¿›åˆ¶å®‰è£…-1">äºŒè¿›åˆ¶å®‰è£…</a></h2>
<p>è¿™é‡Œé‡‡ç”¨äº†æºç ç¼–è¯‘å®‰è£…ï¼Œç‰ˆæœ¬æ˜¯ 7.0.8</p>
<pre><code class="language-shell"># ä¸‹è½½æºç åŒ…
yum -y install wget &amp;&amp; wget http://download.redis.io/releases/redis-7.0.8.tar.gz

# è§£å‹
tar -zxvf redis-7.0.8.tar.gz -C /usr/local

# ç¼–è¯‘å®‰è£…
cd /usr/local/redis-7.0.8
make &amp;&amp; make install
</code></pre>
<h2 id="é…ç½®-redis"><a class="header" href="#é…ç½®-redis">é…ç½® redis</a></h2>
<p>redis çš„é»˜è®¤é…ç½®æ–‡ä»¶å°±æ˜¯ä½äº redis å®‰è£…ç›®å½•ä¸‹çš„ redis.conf</p>
<p>å³<code>/usr/local/redis-7.0.8</code> ç›®å½•ä¸‹</p>
<p>å»æ‰ redis æ³¨é‡Šä¿¡æ¯ï¼Œé‡æ–°ç”Ÿæˆæ–°çš„ redis_6379.conf</p>
<pre><code class="language-shell">cat redis.conf | grep -v "#" | grep -v "^$" &gt; redis-6379.conf
</code></pre>
<p>éœ€è¦å°†<code>redis-6379.conf</code>é…ç½®ä¸­<code>dir</code>çš„å€¼åšå¦‚ä¸‹ä¿®æ”¹</p>
<pre><code class="language-PlainText">dir /opt/redis/db
</code></pre>
<p>æ‰“å¼€å®ˆæŠ¤è¿›ç¨‹</p>
<pre><code class="language-PlainText">daemonize yes
</code></pre>
<p>ä¿®æ”¹ redis æ—¥å¿—è·¯å¾„</p>
<pre><code class="language-PlainText">logfile /var/log/redis/redis.log
</code></pre>
<p>ä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼å¯åŠ¨ï¼Œä½¿ç”¨æœ¬å¯åŠ¨æ–¹å¼ï¼Œredis å°†ä»¥æœåŠ¡çš„å½¢å¼å­˜åœ¨ï¼Œæ—¥å¿—å°†ä¸å†æ‰“å°åˆ°å‘½ä»¤çª—å£ä¸­</p>
<p>åœ¨â€™/optâ€™ç›®å½•ä¸‹æ–°å»º<code>redis</code>ç›®å½•ï¼Œç”¨äºå­˜æ”¾<code>conf</code> é…ç½®æ–‡ä»¶, <code>db</code>æ•°æ®å­˜å‚¨ç­‰</p>
<pre><code class="language-shell">mkdir -p /opt/redis/conf /opt/redis/db
mv /usr/local/redis-7.0.8/redis-6379.conf /opt/redis/conf
</code></pre>
<p>åœ¨<code>/var/log/</code>ç›®å½•ä¸‹åˆ›å»º redis æ–‡ä»¶å¤¹ï¼Œç”¨äºè®°å½• redis çš„æ—¥å¿—è¾“å‡º</p>
<pre><code class="language-shell">mkdir /var/log/redis
</code></pre>
<h2 id="å¯åŠ¨-redis"><a class="header" href="#å¯åŠ¨-redis">å¯åŠ¨ redis</a></h2>
<p>å‡†å¤‡<code>redis.service</code>æ–‡ä»¶</p>
<pre><code class="language-shell">cat &gt; redis.service &lt;&lt; EOF
[Unit]
Description=Redis server
After=syslog.target network.target remote-fs.target nss-lookup.target

[Service]
Type=forking
ExecStart=/bin/bash -c '/usr/local/bin/redis-server /opt/redis/conf/redis-6379.conf'
ExecStop=/bin/bash -c '/usr/local/bin/redis-cli shutdown'
Restart=always
PrivateTmp=true

[Install]
WantedBy=multi-user.target
EOF
</code></pre>
<p>é…ç½® redis system å¯åŠ¨</p>
<p>å°†ç”Ÿæˆçš„ redis.service æ–‡ä»¶ç§»åŠ¨åˆ° <code>/usr/lib/systemd/system/</code>ç›®å½•ä¸‹</p>
<pre><code class="language-shell">mv redis.service /usr/lib/systemd/system/
</code></pre>
<p>å¯åŠ¨ redis</p>
<pre><code class="language-shell">systemctl daemon-reload
systemctl enable redis
systemctl start redis
</code></pre>
<p>æŸ¥çœ‹ redis å¯åŠ¨çŠ¶æ€</p>
<pre><code class="language-shell">systemctl status redis
</code></pre>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåˆ™å¯åŠ¨æˆåŠŸ</p>
<p><img src="operations/redis/../../images/operations/redis/redis_status.png" alt="avatar" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="redis-docker-å®‰è£…ä¸é…ç½®"><a class="header" href="#redis-docker-å®‰è£…ä¸é…ç½®">redis docker å®‰è£…ä¸é…ç½®</a></h1>
<h2 id="å‰æœŸå‡†å¤‡-3"><a class="header" href="#å‰æœŸå‡†å¤‡-3">å‰æœŸå‡†å¤‡</a></h2>
<p>ä¾èµ–<code>docker</code>å’Œ <code>docker-composeç¯å¢ƒ</code></p>
<p><strong>æ³¨:</strong> <code>docker</code> ç¯å¢ƒæ­å»ºä¸å»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œä»…ç”¨äºå­¦ä¹ å’Œå¼€å‘ç¯å¢ƒä½¿ç”¨</p>
<p>è¯·å‚è€ƒ</p>
<p>ğŸ‘‰ğŸ» <a href="operations/redis/../docker/linux_docker_installed.html">docker å®‰è£…ä¸é…ç½®</a></p>
<p>ğŸ‘‰ğŸ» <a href="operations/redis/../docker/linux_docker_compose_installed.html">docker-compose å®‰è£…</a></p>
<h2 id="docker-compose-å®‰è£…-redis"><a class="header" href="#docker-compose-å®‰è£…-redis">docker-compose å®‰è£… redis</a></h2>
<p><strong>1ã€åˆ›å»ºä¸“å±çš„è¿ç»´ç½‘ç»œ,ç”¨æˆ·è·Ÿå…¶ä»–å®¹å™¨äº¤äº’</strong></p>
<p><strong>æ³¨:</strong> åˆ›å»ºä¹‹å‰ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹<code>ops_network</code>ç½‘ç»œæ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨å°±æ— éœ€åˆ›å»º</p>
<pre><code class="language-shell">docker network ls |grep ops_network
</code></pre>
<p>å¦‚æœæœ‰å¦‚ä¸‹è¾“å‡ºå°±æ— éœ€åˆ›å»º</p>
<pre><code class="language-PlainText">514e3dd06943   ops_network   bridge    local
</code></pre>
<p>å¦‚æœæ²¡æœ‰<code>ops_network</code>,æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºå³å¯</p>
<pre><code class="language-shell">docker network create ops_network
</code></pre>
<p><strong>2ã€éƒ¨ç½²æ–‡ä»¶å‡†å¤‡</strong></p>
<p>åœ¨<code>/data</code> ç›®å½•ä¸‹ï¼Œæ–°å»º<code>redis</code>ç›®å½•</p>
<pre><code class="language-shell">mkdir /data/redis
</code></pre>
<p><strong>æ³¨:</strong> <code>/data</code> ç›®å½•å¯é€‰çš„ï¼Œå¯ä»¥é€‰æ‹©å…¶ä»–ç›®å½•</p>
<p>åœ¨<code>/data/redis</code>ä¸‹æ–°å»º<code>docker-compose.yaml</code>, <code>run.sh</code> , <code>stop.sh</code> ä¸‰ä¸ªæ–‡ä»¶å’Œ<code>conf</code>æ–‡ä»¶å¤¹</p>
<p><code>conf</code> æ–‡ä»¶å¤¹ä¸‹å­˜æ”¾ redis.conf æ–‡ä»¶</p>
<pre><code class="language-shell">mkdir -p /data/redis/conf
cat &gt; /data/redis/docker-compose.yaml&lt;&lt; EOF
version: '3.1'

services:
  redis:
    image: redis:latest
    container_name: local-redis
    command: redis-server /usr/local/etc/redis/redis.conf
    restart: always
    ports:
      - 9379:6379
    volumes:
      - ./data:/data
      - ./conf/redis.conf:/usr/local/etc/redis/redis.conf
    networks:
      - ops_network

networks:
  ops_network:
    external: true
EOF
</code></pre>
<p>å¯åŠ¨è„šæœ¬</p>
<pre><code class="language-shell">cat &gt; /data/redis/run.sh&lt;&lt; EOF
#!/bin/bash

docker-compose -p redis-server up -d
EOF

chmod +x /data/redis/run.sh
</code></pre>
<p>åœæ­¢è„šæœ¬</p>
<pre><code class="language-shell">cat &gt; /data/redis/stop.sh&lt;&lt; EOF
#!/bin/bash

docker-compose -p redis-server down
EOF

chmod +x /data/redis/stop.sh
</code></pre>
<p>å‡†å¤‡<code>redis.conf</code>é…ç½®æ–‡ä»¶</p>
<p><code>redis.conf</code></p>
<pre><code class="language-conf"># ç»‘å®šåœ°å€
bind 0.0.0.0
protected-mode yes
port 6379
tcp-backlog 511
timeout 0
tcp-keepalive 300
daemonize no
supervised no
pidfile /var/run/redis_6379.pid
loglevel notice
logfile ""
databases 16
always-show-logo yes
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir ./
replica-serve-stale-data yes
replica-read-only yes
repl-diskless-sync no
repl-diskless-sync-delay 5
repl-disable-tcp-nodelay no
replica-priority 100
# å¼€å¯å¯†ç éªŒè¯
requirepass Passw0rd
lazyfree-lazy-eviction no
lazyfree-lazy-expire no
lazyfree-lazy-server-del no
replica-lazy-flush no
appendonly no
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-load-truncated yes
aof-use-rdb-preamble yes
lua-time-limit 5000
slowlog-log-slower-than 10000
slowlog-max-len 128
latency-monitor-threshold 0
notify-keyspace-events ""
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
hll-sparse-max-bytes 3000
stream-node-max-bytes 4096
stream-node-max-entries 100
activerehashing yes
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60
hz 10
dynamic-hz yes
aof-rewrite-incremental-fsync yes
rdb-save-incremental-fsync yes
</code></pre>
<p>**æ³¨:**è¿™æ˜¯ä»å®˜æ–¹è¿‡æ»¤å‡ºæ¥çš„ä¸»è¦é…ç½®ï¼Œå…·ä½“é…ç½®è¿˜è¦ä»¥åº”ç”¨åœºæ™¯ä¸ºå‡†</p>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹</p>
<pre><code class="language-PlainText">.
â”œâ”€â”€ conf
â”‚Â Â  â””â”€â”€ redis.conf
â”œâ”€â”€ data
â”œâ”€â”€ docker-compose.yaml
â”œâ”€â”€ run.sh
â””â”€â”€ stop.sh
</code></pre>
<p><strong>3ã€å¯åŠ¨ä¸å…³é—­</strong></p>
<p>å¯åŠ¨</p>
<pre><code class="language-shell">cd /data/redis/
./run.sh
</code></pre>
<p>å…³é—­</p>
<pre><code class="language-shell">cd /data/redis/
./stop.sh
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mongodb-åŸºç¡€è¿ç»´"><a class="header" href="#mongodb-åŸºç¡€è¿ç»´">mongodb åŸºç¡€è¿ç»´</a></h1>
<p>è¿™é‡Œä¸»è¦æ˜¯ mongodb åŸºç¡€è¿ç»´ï¼Œæ¶‰åŠåˆ° mongodb åŸºç¡€ç¯å¢ƒæ­å»ºä»¥åŠé…ç½®å’Œç›¸å…³é—®é¢˜çš„å¤„ç†.</p>
<ul>
<li><a href="operations/mongodb/mongodb_docker_installed.html">mongodb äºŒè¿›åˆ¶å®‰è£…ä¸é…ç½®</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mongodb-docker-å®‰è£…ä¸é…ç½®"><a class="header" href="#mongodb-docker-å®‰è£…ä¸é…ç½®">mongodb docker å®‰è£…ä¸é…ç½®</a></h1>
<h2 id="å‰æœŸå‡†å¤‡-4"><a class="header" href="#å‰æœŸå‡†å¤‡-4">å‰æœŸå‡†å¤‡</a></h2>
<p>ä¾èµ–<code>docker</code>å’Œ <code>docker-composeç¯å¢ƒ</code></p>
<p><strong>æ³¨:</strong> <code>docker</code> ç¯å¢ƒæ­å»ºä¸å»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œä»…ç”¨äºå­¦ä¹ å’Œå¼€å‘ç¯å¢ƒä½¿ç”¨</p>
<p>è¯·å‚è€ƒ</p>
<p>ğŸ‘‰ğŸ» <a href="operations/mongodb/../docker/linux_docker_installed.html">docker å®‰è£…ä¸é…ç½®</a></p>
<p>ğŸ‘‰ğŸ» <a href="operations/mongodb/../docker/linux_docker_compose_installed.html">docker-compose å®‰è£…</a></p>
<h2 id="docker-compose-å®‰è£…-mongodb"><a class="header" href="#docker-compose-å®‰è£…-mongodb">docker-compose å®‰è£… mongodb</a></h2>
<p><strong>1ã€åˆ›å»ºä¸“å±çš„è¿ç»´ç½‘ç»œ,ç”¨æˆ·è·Ÿå…¶ä»–å®¹å™¨äº¤äº’</strong></p>
<p><strong>æ³¨:</strong> åˆ›å»ºä¹‹å‰ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹<code>ops_network</code>ç½‘ç»œæ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨å°±æ— éœ€åˆ›å»º</p>
<pre><code class="language-shell">docker network ls |grep ops_network
</code></pre>
<p>å¦‚æœæœ‰å¦‚ä¸‹è¾“å‡ºå°±æ— éœ€åˆ›å»º</p>
<pre><code class="language-PlainText">514e3dd06943   ops_network   bridge    local
</code></pre>
<p>å¦‚æœæ²¡æœ‰<code>ops_network</code>,æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºå³å¯</p>
<pre><code class="language-shell">docker network create ops_network
</code></pre>
<p><strong>2ã€éƒ¨ç½²æ–‡ä»¶å‡†å¤‡</strong></p>
<p>åœ¨<code>/data</code> ç›®å½•ä¸‹ï¼Œæ–°å»º<code>mongodb</code>ç›®å½•</p>
<pre><code class="language-shell">mkdir /data/mongodb
</code></pre>
<p><strong>æ³¨:</strong> <code>/data</code> ç›®å½•å¯é€‰çš„ï¼Œå¯ä»¥é€‰æ‹©å…¶ä»–ç›®å½•</p>
<p>åœ¨<code>/data/mongodb</code>ä¸‹æ–°å»º<code>docker-compose.yaml</code>, <code>run.sh</code> , <code>stop.sh</code></p>
<pre><code class="language-shell">mkdir -p /data/mongodb

cat &gt; /data/mongodb/docker-compose.yaml&lt;&lt; EOF
version: "3.1"
services:
  local-mongo:
    image: mongo:7.0.0
    restart: always
    container_name: local-mongo
    hostname: mongo
    environment:
      #ç”¨æˆ·åå¯†ç 
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: Passw0rd
    ports:
      - 33017:27017
    volumes:
      - ./data:/data/db
    networks:
      - ops_network

networks:
  ops_network:
    external: true
EOF
</code></pre>
<p>å¯åŠ¨è„šæœ¬</p>
<pre><code class="language-shell">cat &gt; /data/mongodb/run.sh&lt;&lt; EOF
#!/bin/bash

docker-compose -p mongodb-server up -d
EOF

chmod +x /data/mongodb/run.sh
</code></pre>
<p>åœæ­¢è„šæœ¬</p>
<pre><code class="language-shell">cat &gt; /data/mongodb/stop.sh&lt;&lt; EOF
#!/bin/bash

docker-compose -p mongodb-server down
EOF

chmod +x /data/mongodb/stop.sh
</code></pre>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹</p>
<pre><code class="language-PlainText">â”œâ”€â”€ data
â”œâ”€â”€ docker-compose.yaml
â”œâ”€â”€ run.sh
â””â”€â”€ stop.sh
</code></pre>
<p><strong>3ã€å¯åŠ¨ä¸å…³é—­</strong></p>
<p>å¯åŠ¨</p>
<pre><code class="language-shell">cd /data/mongodb/
./run.sh
</code></pre>
<p>å…³é—­</p>
<pre><code class="language-shell">cd /data/mongodb/
./stop.sh
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="etcd-åŸºç¡€è¿ç»´"><a class="header" href="#etcd-åŸºç¡€è¿ç»´">etcd åŸºç¡€è¿ç»´</a></h1>
<p>è¿™é‡Œä¸»è¦æ˜¯ etcd åŸºç¡€è¿ç»´ï¼Œæ¶‰åŠåˆ° etcd åŸºç¡€ç¯å¢ƒæ­å»ºä»¥åŠé…ç½®å’Œç›¸å…³é—®é¢˜çš„å¤„ç†.</p>
<ul>
<li><a href="operations/etcd/etcd_single_node_nossl.html">etcd docker å®‰è£…(å•èŠ‚ç‚¹æ—  ssl)</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="etcd-docker-å®‰è£…ä¸é…ç½®"><a class="header" href="#etcd-docker-å®‰è£…ä¸é…ç½®">etcd docker å®‰è£…ä¸é…ç½®</a></h1>
<h2 id="å‰æœŸå‡†å¤‡-5"><a class="header" href="#å‰æœŸå‡†å¤‡-5">å‰æœŸå‡†å¤‡</a></h2>
<p>ä¾èµ–<code>docker</code>å’Œ <code>docker-composeç¯å¢ƒ</code></p>
<p><strong>æ³¨:</strong> <code>docker</code> ç¯å¢ƒæ­å»ºä¸å»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œä»…ç”¨äºå­¦ä¹ å’Œå¼€å‘ç¯å¢ƒä½¿ç”¨</p>
<p>è¯·å‚è€ƒ</p>
<p>ğŸ‘‰ğŸ» <a href="operations/etcd/../docker/linux_docker_installed.html">docker å®‰è£…ä¸é…ç½®</a></p>
<p>ğŸ‘‰ğŸ» <a href="operations/etcd/../docker/linux_docker_compose_installed.html">docker-compose å®‰è£…</a></p>
<h2 id="docker-compose-å®‰è£…-etcd"><a class="header" href="#docker-compose-å®‰è£…-etcd">docker-compose å®‰è£… etcd</a></h2>
<p><strong>1ã€åˆ›å»ºä¸“å±çš„è¿ç»´ç½‘ç»œ,ç”¨æˆ·è·Ÿå…¶ä»–å®¹å™¨äº¤äº’</strong></p>
<p><strong>æ³¨:</strong> åˆ›å»ºä¹‹å‰ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹<code>ops_network</code>ç½‘ç»œæ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨å°±æ— éœ€åˆ›å»º</p>
<pre><code class="language-shell">docker network ls |grep ops_network
</code></pre>
<p>å¦‚æœæœ‰å¦‚ä¸‹è¾“å‡ºå°±æ— éœ€åˆ›å»º</p>
<pre><code class="language-PlainText">514e3dd06943   ops_network   bridge    local
</code></pre>
<p>å¦‚æœæ²¡æœ‰<code>ops_network</code>,æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºå³å¯</p>
<pre><code class="language-shell">docker network create ops_network
</code></pre>
<p><strong>2ã€éƒ¨ç½²æ–‡ä»¶å‡†å¤‡</strong></p>
<p>åœ¨<code>/data</code> ç›®å½•ä¸‹ï¼Œæ–°å»º<code>etcd</code>ç›®å½•</p>
<pre><code class="language-shell">mkdir /data/etcd
</code></pre>
<p><strong>æ³¨:</strong> <code>/data</code> ç›®å½•å¯é€‰çš„ï¼Œå¯ä»¥é€‰æ‹©å…¶ä»–ç›®å½•</p>
<p>åœ¨<code>/data/redis</code>ä¸‹æ–°å»º<code>docker-compose.yaml</code>, <code>run.sh</code> , <code>stop.sh</code> ä¸‰ä¸ªæ–‡ä»¶å’Œ<code>etcd_data</code>æ–‡ä»¶å¤¹</p>
<pre><code class="language-shell">mkdir -p /data/etcd/etcd_data

chown -R 1001:1001 /data/etcd/etcd_data # etcd å¯åŠ¨ä¸æ˜¯rootç”¨æˆ·ï¼Œæ‰€ä»¥è¦æ”¹å˜ä¸‹æƒé™

cat &gt; /data/redis/docker-compose.yaml&lt;&lt; EOF
version: '3.1'

services:
  etcd-server:
    image: 'bitnami/etcd:latest'
    container_name: "etcd-server"
    environment:
      - "ETCD_NAME=node1"
      - "ETCD_ROOT_PASSWORD=Passw0rd"
      - "ETCD_CLIENT_CERT_AUTH=true"
      - "ETCD_PEER_CLIENT_CERT_AUTH=true"
      - "ETCD_ADVERTISE_CLIENT_URLS=http://192.168.1.102:42379"
      - "ETCD_INITIAL_ADVERTISE_PEER_URLS=http://192.168.1.102:42380"
      - "ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:2379"
      - "ETCD_LISTEN_PEER_URLS=http://0.0.0.0:2380"
      - "ETCD_INITIAL_CLUSTER_TOKEN=etcd_cluster"
      - "ETCD_INITIAL_CLUSTER=node1=http://192.168.1.102:42380"
      - "ETCD_INITIAL_CLUSTER_STATE=new"
    volumes:
      - ./etcd_data:/bitnami/etcd/data
      - ./etcd_conf:/opt/bitnami/etcd/conf
    ports:
      - 42379:2379
      - 42380:2380
    networks:
      - ops_network

  etcdkeeper:
    image: "deltaprojects/etcdkeeper:202311192256"
    container_name: "etcdkeeper"
    ports:
      - 11080:8080
    depends_on:
      - etcd-server
    networks:
      - ops_network

networks:
  ops_network:
    external: true
EOF
</code></pre>
<p><strong>æ³¨:</strong> <code>etcdkeeper</code> é•œåƒ<code>deltaprojects/etcdkeeper:202311192256</code> ä¸ºè‡ªå·±æ„å»ºçš„é•œåƒï¼Œå®˜æ–¹æä¾›çš„é•œåƒæ— æ³•å¼€å¯éªŒè¯ç™»å½•</p>
<p>å¯åŠ¨è„šæœ¬</p>
<pre><code class="language-shell">cat &gt; /data/etcd/run.sh&lt;&lt; EOF
#!/bin/bash

docker-compose -p etcd-server up -d
EOF

chmod +x /data/etcd/run.sh
</code></pre>
<p>åœæ­¢è„šæœ¬</p>
<pre><code class="language-shell">cat &gt; /data/etcd/stop.sh&lt;&lt; EOF
#!/bin/bash

docker-compose -p etcd-server down
EOF

chmod +x /data/etcd/stop.sh
</code></pre>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹</p>
<pre><code class="language-PlainText">.
â”œâ”€â”€ etcd_conf
â”œâ”€â”€ etcd_data
â”œâ”€â”€ docker-compose.yaml
â”œâ”€â”€ run.sh
â””â”€â”€ stop.sh
</code></pre>
<p><strong>3ã€å¯åŠ¨ä¸å…³é—­</strong></p>
<p>å¯åŠ¨</p>
<pre><code class="language-shell">cd /data/redis/
./run.sh
</code></pre>
<p>å…³é—­</p>
<pre><code class="language-shell">cd /data/redis/
./stop.sh
</code></pre>
<p><strong>é™„ï¼š</strong> etcdkeeper é•œåƒåˆ¶ä½œ</p>
<p>ä¸‹è½½äºŒè¿›åˆ¶åŒ…</p>
<pre><code class="language-shell">wget https://github.com/evildecay/etcdkeeper/releases/download/v0.7.6/etcdkeeper-v0.7.6-linux_x86_64.zip
</code></pre>
<p>åœ¨ <code>/data/</code>ä¸‹é¢æ–°å»º<code>dockerfiles</code>æ–‡ä»¶å¤¹ï¼Œåœ¨<code>å…¶ä¸‹é¢æ–°å»ºetcdkeeper</code>æ–‡ä»¶</p>
<pre><code class="language-shell">mkdir -p /data/dockerfiles/etcdkeeper
</code></pre>
<p>è§£å‹<code>etcdkeeper</code> å¹¶ç§»åŠ¨åˆ° <code>/data/dockerfiles/etcdkeeper</code>ç›®å½•ä¸‹</p>
<pre><code class="language-shell">unzip etcdkeeper-v0.7.6-linux_x86_64.zip
mv etcdkeeper /data/dockerfiles/etcdkeeper
</code></pre>
<p>å‡†å¤‡<code>Dockerfile</code></p>
<p>åŸºäºå®˜æ–¹æ–‡ä»¶æ”¹é€ çš„</p>
<pre><code class="language-shell">cat &gt; /data/dockerfiles/etcdkeeper/Dockerfile&lt;&lt; EOF
FROM deltaprojects/etcdkeeper:latest

RUN rm -rf /etcdkeeper

COPY etcdkeeper /etcdkeeper

WORKDIR /etcdkeeper

ENTRYPOINT ./etcdkeeper -h 0.0.0.0 -p 8080 -auth true # è¿™ä¹ˆåšæ˜¯å¼€å¯äº†è®¤è¯
EOF
</code></pre>
<p>æ„å»ºé•œåƒ</p>
<pre><code class="language-shell">cd /data/dockerfiles/etcdkeeper/

docker build --no-cache -t deltaprojects/etcdkeeper:202311192256
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="elasticsearch-åŸºç¡€è¿ç»´"><a class="header" href="#elasticsearch-åŸºç¡€è¿ç»´">elasticsearch åŸºç¡€è¿ç»´</a></h1>
<p>è¿™é‡Œä¸»è¦æ˜¯ elasticsearch åŸºç¡€è¿ç»´ï¼Œæ¶‰åŠåˆ° elasticsearch åŸºç¡€ç¯å¢ƒæ­å»ºä»¥åŠé…ç½®å’Œç›¸å…³é—®é¢˜çš„å¤„ç†.</p>
<ul>
<li><a href="operations/elasticsearch/es_docker_installed.html">elasticsearch docker-compose å®‰è£…ä¸é…ç½®(7.1.0 ç‰ˆæœ¬)</a></li>
<li><a href="operations/elasticsearch/es_ik_installed.html">elasticsearch ik åˆ†è¯å™¨å®‰è£…(7.1.0 ç‰ˆæœ¬)</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="elasticsearch-docker-å®‰è£…ä¸é…ç½®7100-ç‰ˆæœ¬"><a class="header" href="#elasticsearch-docker-å®‰è£…ä¸é…ç½®7100-ç‰ˆæœ¬">elasticsearch docker å®‰è£…ä¸é…ç½®(7.10.0 ç‰ˆæœ¬)</a></h1>
<h2 id="å‰æœŸå‡†å¤‡-6"><a class="header" href="#å‰æœŸå‡†å¤‡-6">å‰æœŸå‡†å¤‡</a></h2>
<p>ä¾èµ–<code>docker</code>å’Œ <code>docker-composeç¯å¢ƒ</code></p>
<p><strong>æ³¨:</strong> <code>docker</code> ç¯å¢ƒæ­å»ºä¸å»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œä»…ç”¨äºå­¦ä¹ å’Œå¼€å‘ç¯å¢ƒä½¿ç”¨</p>
<p>è¯·å‚è€ƒ</p>
<p>ğŸ‘‰ğŸ» <a href="operations/elasticsearch/../docker/linux_docker_installed.html">docker å®‰è£…ä¸é…ç½®</a></p>
<p>ğŸ‘‰ğŸ» <a href="operations/elasticsearch/../docker/linux_docker_compose_installed.html">docker-compose å®‰è£…</a></p>
<h2 id="docker-compose-å®‰è£…-mongodb-1"><a class="header" href="#docker-compose-å®‰è£…-mongodb-1">docker-compose å®‰è£… mongodb</a></h2>
<p><strong>1ã€åˆ›å»ºä¸“å±çš„è¿ç»´ç½‘ç»œ,ç”¨æˆ·è·Ÿå…¶ä»–å®¹å™¨äº¤äº’</strong></p>
<p><strong>æ³¨:</strong> åˆ›å»ºä¹‹å‰ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹<code>ops_network</code>ç½‘ç»œæ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨å°±æ— éœ€åˆ›å»º</p>
<pre><code class="language-shell">docker network ls |grep ops_network
</code></pre>
<p>å¦‚æœæœ‰å¦‚ä¸‹è¾“å‡ºå°±æ— éœ€åˆ›å»º</p>
<pre><code class="language-PlainText">514e3dd06943   ops_network   bridge    local
</code></pre>
<pre><code class="language-shell">docker network create ops_network
</code></pre>
<p><strong>2ã€éƒ¨ç½²æ–‡ä»¶å‡†å¤‡</strong></p>
<p>åœ¨<code>/data</code> ç›®å½•ä¸‹ï¼Œæ–°å»º<code>elasticsearch</code>ç›®å½•</p>
<pre><code class="language-shell">mkdir /data/elasticsearch
</code></pre>
<p><strong>æ³¨:</strong> <code>/data</code> ç›®å½•å¯é€‰çš„ï¼Œå¯ä»¥é€‰æ‹©å…¶ä»–ç›®å½•</p>
<p>åœ¨<code>/data/elasticsearch</code>ä¸‹æ–°å»º<code>docker-compose.yaml</code>, <code>run.sh</code> , <code>stop.sh</code>, <code>.env</code> å’Œ <code>es_data</code>æ–‡ä»¶å¤¹</p>
<pre><code class="language-shell">mkdir -p /data/elasticsearch/es_data

cat &gt; /data/mongodb/docker-compose.yaml&lt;&lt; EOF
version: '3.1'

services:
  elasticsearch:
    image: "docker.elastic.co/elasticsearch/elasticsearch:${ES_VERSION}"
    container_name: elasticsearch
    environment:
      TZ: Asia/Shanghai
      LANG: en_US.UTF-8
      discovery.type: single-node
      ES_JAVA_OPTS: "-Xmx512m -Xms512m"
      ELASTIC_PASSWORD: "passw0rd" # elasticè´¦å·å¯†ç 
    volumes:
      - /etc/localtime:/etc/localtime
      - ./es_data:/usr/share/elasticsearch/data
    ports:
      - "12200:9200"
      - "12300:9300"
    user: "1000:1000"
    networks:
      - ops_network

  kibana:
    depends_on:
      - elasticsearch
    image: "docker.elastic.co/kibana/kibana:${ES_VERSION}"
    container_name: kibana
    environment:
      - ELASTICSEARCH_URL=http://elasticsearch:9200
    volumes:
      - /etc/localtime:/etc/localtime
    ports:
      - "8601:5601"
    links:
      - elasticsearch
    networks:
      - ops_network

networks:
  ops_network:
    external: true
EOF
</code></pre>
<p>ä¸‹é¢ä¸¤ä¸ªæ“ä½œå¾ˆé‡è¦ï¼Œç»™<code>es</code>æŒä¹…åŒ–æ–‡ä»¶èµ‹äºˆæƒé™ï¼Œä¸ç„¶å¯åŠ¨ä¼šæŠ¥æƒé™é—®é¢˜</p>
<pre><code class="language-shell"># ç»™es_data es_config kibana_configèµ‹äºˆæƒé™ï¼Œä¸ç„¶å¯åŠ¨ä¼šæŠ¥æ–‡ä»¶æƒé™é—®é¢˜ï¼Œè¿™ä¸ªå¾ˆé‡è¦
sudo chown -R 1000:1000 /data/elasticsearch/es_data


# è®¾ç½®esç‰ˆæœ¬
cat &gt; /data/elasticsearch/.env &lt;&lt; EOF
ES_VERSION=7.1.0
EOF
</code></pre>
<p>å¯åŠ¨è„šæœ¬</p>
<pre><code class="language-shell">cat &gt; /data/elasticsearch/run.sh&lt;&lt; EOF
#!/bin/bash

docker-compose -p es-server up -d
EOF

chmod +x /data/elasticsearch/run.sh
</code></pre>
<p>åœæ­¢è„šæœ¬</p>
<pre><code class="language-shell">cat &gt; /data/elasticsearch/stop.sh&lt;&lt; EOF
#!/bin/bash

docker-compose -p es-server down
EOF

chmod +x /data/elasticsearch/stop.sh
</code></pre>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹</p>
<pre><code class="language-PlainText">.
â”œâ”€â”€ .env
â”œâ”€â”€ docker-compose.yaml
â”œâ”€â”€ es_data
â”œâ”€â”€ run.sh
â””â”€â”€ stop.sh
</code></pre>
<p><strong>3ã€å¯åŠ¨ä¸å…³é—­</strong></p>
<p>å¯åŠ¨</p>
<pre><code class="language-shell">cd /data/elsaticsearch/
./run.sh
</code></pre>
<p>å…³é—­</p>
<pre><code class="language-shell">cd /data/elsaticsearch/
./stop.sh
</code></pre>
<p><strong>4ã€æŒ‚è½½å‡ºé…ç½®æ–‡ä»¶</strong></p>
<p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°† elasticsearch å’Œ kibana config æ–‡ä»¶æ‹·è´å‡ºæ¥</p>
<pre><code class="language-shell">cd /data/elasticsearch
# æ‹·è´es config æ–‡ä»¶
docker cp elasticsearch:/usr/share/elasticsearch/config es_config
# æ‹·è´ kibana configæ–‡ä»¶
docker cp kibana:/usr/share/kibana/config kibana_config
# ä¿®æ”¹æ–‡ä»¶æƒé™
chown -R 1000:1000 es_config kibana_config
</code></pre>
<p>å…³é—­æœåŠ¡</p>
<pre><code class="language-shell">cd /data/elsaticsearch/
./stop.sh
</code></pre>
<p>å°†<code>docker-compose.yaml</code>æ–‡ä»¶æŒ‚è½½é…ç½®ä¿®æ”¹
ä¿®æ”¹åçš„å†…å®¹å¦‚ä¸‹</p>
<pre><code class="language-yaml">version: '3.1'

services:
  elasticsearch:
    image: 'docker.elastic.co/elasticsearch/elasticsearch:${ES_VERSION}'
    container_name: elasticsearch
    environment:
      TZ: Asia/Shanghai
      LANG: en_US.UTF-8
      discovery.type: single-node
      ES_JAVA_OPTS: '-Xmx512m -Xms512m'
      ELASTIC_PASSWORD: 'Passw0rd'
    volumes:
      - /etc/localtime:/etc/localtime
      - ./es_config:/usr/share/elasticsearch/config # æ–°å¢
      - ./es_data:/usr/share/elasticsearch/data
    ports:
      - '12200:9200'
      - '12300:9300'
    user: '1000:1000'
    networks:
      - ops_network

  kibana:
    depends_on:
      - elasticsearch
    image: 'docker.elastic.co/kibana/kibana:${ES_VERSION}'
    container_name: kibana
    environment:
      - ELASTICSEARCH_URL=http://elasticsearch:9200
    volumes:
      - /etc/localtime:/etc/localtime
      - ./kibana_config:/usr/share/kibana/config # æ–°å¢
    ports:
      - '8601:5601'
    links:
      - elasticsearch
    networks:
      - ops_network

networks:
  ops_network:
    external: true
</code></pre>
<p>å¯åŠ¨</p>
<pre><code class="language-shell">cd /data/elsaticsearch/
./run.sh
</code></pre>
<p>å®Œæ•´é¡¹ç›®ç›®å½•å¦‚ä¸‹</p>
<pre><code class="language-PlainText">â”œâ”€â”€ .env
â”œâ”€â”€ docker-compose.yaml
â”œâ”€â”€ es_config
â”œâ”€â”€ es_data
â”œâ”€â”€ kibana_config
â”œâ”€â”€ run.sh
â”œâ”€â”€ stop.sh
â””â”€â”€ zips
</code></pre>
<p><strong>5ã€é…ç½®å¯†ç </strong></p>
<p><strong>ä¿®æ”¹é…ç½®</strong></p>
<p>è®¾ç½®å¯†ç éœ€è¦ å¯ç”¨ X-Pack å®‰å…¨åŠŸèƒ½</p>
<p>éœ€è¦ä¿®æ”¹<code>/data/elasticsearch/es_config/elasticsearch.yaml</code>æ–‡ä»¶ å’Œ <code>/data/elasticsearch/kibana_config/kibana.yml</code></p>
<p><code>elasticsearch.yaml</code>ä¿®æ”¹å†…å®¹å¦‚ä¸‹ï¼Œå†…å®¹ä¸ºæ–°å¢å†…å®¹</p>
<pre><code class="language-yaml"># enable xpack
xpack.security.enabled: true
xpack.security.transport.ssl.enabled: true
</code></pre>
<pre><code class="language-yaml">cluster.name: 'docker-cluster'
network.host: 0.0.0.0
# å¼€å¯esè·¨åŸŸ
http.cors.enabled: true
http.cors.allow-origin: '*'
http.cors.allow-headers: Authorization
# çœç•¥å…¶ä»–é…ç½®
# ...

# åœ¨æœ€åæ–°å¢
# enable xpack
xpack.security.enabled: true
xpack.security.transport.ssl.enabled: true
</code></pre>
<p><code>kibana.yml</code> ä¿®æ”¹å†…å®¹å¦‚ä¸‹,å†…å®¹ä¸ºæ–°å¢å†…å®¹</p>
<pre><code class="language-yaml">elasticsearch.username: 'elastic' # esè´¦å·
elasticsearch.password: '123456' # eså¯†ç 
</code></pre>
<p><strong>é‡å¯æœåŠ¡</strong></p>
<p>å‚è€ƒæ­¥éª¤ 3ï¼Œå¯åŠ¨ä¸å…³é—­</p>
<p><strong>é‡ç½®å¯†ç </strong></p>
<p>è¿›å…¥<code>elasticsearch</code> å®¹å™¨</p>
<pre><code class="language-shell">docker exec -it elasticsearch bash
</code></pre>
<p>æ‰‹åŠ¨è®¾ç½®å¯†ç </p>
<pre><code class="language-shell">elasticsearch-setup-passwords interactive
</code></pre>
<p>è¿›å…¥äº¤äº’å¼æ“ä½œ,è®¾ç½®å®Œå¯†ç å³å¯,å¦‚ä¸‹å›¾</p>
<p><img src="operations/elasticsearch/../../images/operations/elasticsearch/es_update_password_1.png" alt="avatar" /></p>
<p><img src="operations/elasticsearch/../../images/operations/elasticsearch/es_update_password_2.png" alt="avatar" /></p>
<p>åœ¨å®¹å™¨é‡Œè®¿é—® es</p>
<pre><code class="language-shell">curl 127.0.0.1:9200 -u elastic:123456
</code></pre>
<p>æœ‰æ­£å¸¸è¿”å›å³å¯</p>
<p>å¦‚ä¸‹å›¾
<img src="operations/elasticsearch/../../images/operations/elasticsearch/es_update_password_3.png" alt="avatar" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="elasticsearch-ik-åˆ†è¯å™¨å®‰è£…7100-ç‰ˆæœ¬"><a class="header" href="#elasticsearch-ik-åˆ†è¯å™¨å®‰è£…7100-ç‰ˆæœ¬">elasticsearch ik åˆ†è¯å™¨å®‰è£…(7.10.0 ç‰ˆæœ¬)</a></h1>
<p>ğŸ‘‰ğŸ» <a href="https://github.com/medcl/elasticsearch-analysis-ik">elasticsearch ik åˆ†è¯å™¨ github</a></p>
<p>ğŸ‘‰ğŸ» <a href="https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.10.0/elasticsearch-analysis-ik-7.10.0.zip">elasticsearch ik åˆ†è¯å™¨ 7.10.0 ä¸‹è½½åœ°å€</a></p>
<h2 id="å‰æœŸå‡†å¤‡-7"><a class="header" href="#å‰æœŸå‡†å¤‡-7">å‰æœŸå‡†å¤‡</a></h2>
<p><code>elasticserach</code> å·²ç»å®‰è£…éƒ¨ç½²å®Œæˆ</p>
<p>å®‰è£…éƒ¨ç½²è¯·å‚è€ƒ ğŸ‘‰ğŸ» <a href="operations/elasticsearch/es_docker_installed.html">elasticsearch docker-compose å®‰è£…ä¸é…ç½®(7.10.0 ç‰ˆæœ¬)</a></p>
<p><strong>1ã€åœæ­¢æœåŠ¡</strong></p>
<pre><code class="language-shell">cd /data/elasticserach/
.stop.sh
</code></pre>
<p><strong>2ã€å‡†å¤‡ plugins æ–‡ä»¶</strong></p>
<pre><code class="language-shell">mkdir /data/elasticsearch/plugins

chown -R 1000:1000 /data/elasticsearch/plugins
</code></pre>
<p><strong>3ã€æ›´æ–° docker-compose.yaml</strong>æ–‡ä»¶</p>
<p>éœ€è¦å°†<code>/data/elasticsearch/docker-compose.yaml</code>æ–‡ä»¶åšå¦‚ä¸‹æ›´æ”¹</p>
<pre><code class="language-yaml">volumes:
  - /etc/localtime:/etc/localtime
  - ./es_config:/usr/share/elasticsearch/config
  - ./es_data:/usr/share/elasticsearch/data
-
+  - ./plugins:/usr/share/elasticsearch/plugins
</code></pre>
<p>å®Œæ•´<code>docker-compose.yaml</code>æ–‡ä»¶å¦‚ä¸‹</p>
<pre><code class="language-yaml">version: '3.1'

services:
  elasticsearch:
    image: 'docker.elastic.co/elasticsearch/elasticsearch:${ES_VERSION}'
    container_name: elasticsearch
    environment:
      TZ: Asia/Shanghai
      LANG: en_US.UTF-8
      discovery.type: single-node
      ES_JAVA_OPTS: '-Xmx512m -Xms512m'
      ELASTIC_PASSWORD: 'Passw0rd'
    volumes:
      - /etc/localtime:/etc/localtime
      - ./es_config:/usr/share/elasticsearch/config
      - ./es_data:/usr/share/elasticsearch/data
      - ./plugins:/usr/share/elasticsearch/plugins # æ–°å¢
    ports:
      - '12200:9200'
      - '12300:9300'
    user: '1000:1000'
    networks:
      - ops_network

  kibana:
    depends_on:
      - elasticsearch
    image: 'docker.elastic.co/kibana/kibana:${ES_VERSION}'
    container_name: kibana
    environment:
      - ELASTICSEARCH_URL=http://elasticsearch:9200
    volumes:
      - /etc/localtime:/etc/localtime
      - ./kibana_config:/usr/share/kibana/config
    ports:
      - '8601:5601'
    links:
      - elasticsearch
    networks:
      - ops_network

networks:
  ops_network:
    external: true
</code></pre>
<p><strong>3ã€å‡†å¤‡ ik æ–‡ä»¶å¹¶é…ç½®</strong></p>
<pre><code class="language-shell"># æ–°å»ºzips æ–‡ä»¶ï¼Œç”¨äºå¤‡ä»½å­˜æ”¾zipæ–‡ä»¶
mkdir -p /data/elasticsearch/zips

# æ–°å»º analysis-ik æ’ä»¶åç§°
mkdir -p /data/elasticsearch/plugins/analysis-ik

# ä¸‹è½½ik åˆ†è¯å™¨æ’ä»¶
cd /data/elasticsearch/plugins/analysis-ik
yum -y install wget &amp;&amp; wget https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.10.0/elasticsearch-analysis-ik-7.10.0.zip
yum -y install unzip &amp;&amp; unzip elasticsearch-analysis-ik-7.10.0.zip


# zip æ–‡ä»¶ç§»åŠ¨åˆ°åˆ›å»ºå¥½çš„zips ç›®å½•ä¸‹
mv /data/elasticsearch/plugins/analysis-ik/elasticsearch-analysis-ik-7.10.0.zip /data/elasticsearch/zips

# å†æ¬¡é‡æ–°èµ‹äºˆä¸‹æƒé™
chown -R 1000:1000 /data/elasticsearch/plugins/
</code></pre>
<p>**æ³¨:**å¦‚æœä¸‹è½½å¤±è´¥ï¼Œè¯·é€šè¿‡å…¶ä»–æ¸ é“ä¸‹è½½åä¸Šä¼ åˆ°<code>/data/elasticsearch/plugins</code>ç›®å½•ä¸‹</p>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹</p>
<pre><code class="language-PlainText">â”œâ”€â”€ .env
â”œâ”€â”€ docker-compose.yaml
â”œâ”€â”€ es_config
â”œâ”€â”€ es_data
â”œâ”€â”€ kibana_config
â”œâ”€â”€ plugins
â”œâ”€â”€ run.sh
â”œâ”€â”€ stop.sh
â””â”€â”€ zips
</code></pre>
<p><strong>4ã€å¯åŠ¨æœåŠ¡</strong></p>
<p>å¯åŠ¨</p>
<pre><code class="language-shell">cd /data/elsaticsearch/
./run.sh
</code></pre>
<p><strong>4ã€é—®é¢˜æ’æŸ¥</strong></p>
<p>å¦‚æœé‡åˆ°äº†ä¸‹é¢çš„é—®é¢˜</p>
<pre><code class="language-PlainText">"Caused by: java.nio.file.FileSystemException: /usr/share/elasticsearch/plugins/httpclient-4.5.2.jar/plugin-descriptor.properties: Not a directory",
</code></pre>
<p>è¯´æ˜ä½ æŠŠ ik åˆ†è¯å™¨çš„æ–‡ä»¶æ”¾åˆ°äº†<code>plugins</code>ç›®å½•ä¸‹ï¼Œå¯¼è‡´çš„æŠ¥é”™</p>
<p>è¯·å‚è€ƒ ğŸ‘‰ğŸ» <a href="https://blog.csdn.net/dxtljly/article/details/127102211">è®°ä¸€æ¬¡ docker å®‰è£… elasticsearch é‡åˆ°çš„å‘</a></p>
<p><strong>5ã€æµ‹è¯• ik åˆ†è¯å™¨</strong></p>
<p>åœ¨<code>kibana</code>ä¸­è¯·æ±‚å¦‚ä¸‹å†…å®¹</p>
<pre><code class="language-elasticsearch">GET _analyze
{
  "analyzer": "ik_max_word",
  "text":"æˆ‘æ˜¯ä¸­å›½äºº"
}
</code></pre>
<p>å“åº”å†…å®¹</p>
<pre><code class="language-json">{
  "tokens": [
    {
      "token": "æˆ‘",
      "start_offset": 0,
      "end_offset": 1,
      "type": "CN_CHAR",
      "position": 0
    },
    {
      "token": "æ˜¯",
      "start_offset": 1,
      "end_offset": 2,
      "type": "CN_CHAR",
      "position": 1
    },
    {
      "token": "ä¸­å›½äºº",
      "start_offset": 2,
      "end_offset": 5,
      "type": "CN_WORD",
      "position": 2
    },
    {
      "token": "ä¸­å›½",
      "start_offset": 2,
      "end_offset": 4,
      "type": "CN_WORD",
      "position": 3
    },
    {
      "token": "å›½äºº",
      "start_offset": 3,
      "end_offset": 5,
      "type": "CN_WORD",
      "position": 4
    }
  ]
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="git-åŸºç¡€æ“ä½œ"><a class="header" href="#git-åŸºç¡€æ“ä½œ">git åŸºç¡€æ“ä½œ</a></h1>
<p>è¿™é‡Œä¸»è¦æ˜¯ git åŸºç¡€æ“ä½œï¼Œæ¶‰åŠåˆ°é¡¹ç›®å¼€å‘ä¸è¿ç»´ä¸­çš„ä»£ç æ¨é€ï¼Œå›æ»šç­‰</p>
<ul>
<li>
<p><a href="operations/git/git_operation.html">git ç‰ˆæœ¬æ§åˆ¶</a></p>
</li>
<li>
<p><a href="operations/git/git_clone_without_pass.html">git http æ–¹å¼å…å¯†å…‹éš†ä»£ç </a></p>
</li>
<li>
<p><a href="operations/git/git_dev_specification.html">git å¼€å‘ç®¡ç†è§„èŒƒ</a></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="git-ç‰ˆæœ¬æ§åˆ¶"><a class="header" href="#git-ç‰ˆæœ¬æ§åˆ¶">Git ç‰ˆæœ¬æ§åˆ¶</a></h1>
<h2 id="ä¸€git-å¸¸ç”¨å‘½ä»¤"><a class="header" href="#ä¸€git-å¸¸ç”¨å‘½ä»¤">ä¸€ã€git å¸¸ç”¨å‘½ä»¤</a></h2>
<h2 id="11-æŸ¥çœ‹å¸®åŠ©"><a class="header" href="#11-æŸ¥çœ‹å¸®åŠ©">1.1 æŸ¥çœ‹å¸®åŠ©</a></h2>
<p>git æˆ–è€… git help å³å¯æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯</p>
<pre><code class="language-bash">git

git help
</code></pre>
<p>åŠ ä¸ŠæŸä¸€å‚æ•°å³å¯æŸ¥çœ‹æŸä¸€å‚æ•°è¯¦ç»†ä¿¡æ¯</p>
<p>å¦‚æŸ¥çœ‹ add ä¿¡æ¯</p>
<pre><code class="language-bash">git help add
</code></pre>
<p>æ–‡æ¡£å†…å®¹æ˜¾ç¤ºè¿‡é•¿ï¼ŒæŒ‰ f é”®å¯ä»¥å‘ä¸‹ç¿»é¡µï¼Œb æƒ³ä¸Šç¿»é¡µï¼ŒæŒ‰ q é€€å‡º</p>
<h2 id="12-git-é…ç½®"><a class="header" href="#12-git-é…ç½®">1.2 git é…ç½®</a></h2>
<p>git é…ç½®æœ‰ä¸‰ä¸ªèŒƒå›´</p>
<ul>
<li>ç³»ç»ŸèŒƒå›´</li>
<li>å…¨å±€èŒƒå›´ global</li>
<li>é¡¹ç›®èŒƒå›´</li>
</ul>
<p>ä¸€èˆ¬ç”¨å…¨å±€èŒƒå›´é…ç½®</p>
<h3 id="121-é…ç½®å…¨å±€ç”¨æˆ·ä¿¡æ¯"><a class="header" href="#121-é…ç½®å…¨å±€ç”¨æˆ·ä¿¡æ¯">1.2.1 é…ç½®å…¨å±€ç”¨æˆ·ä¿¡æ¯</a></h3>
<pre><code class="language-bash">git config --global user.name "einsli"
git config --global user.email "einsli@123.com"
</code></pre>
<h3 id="122-æŸ¥çœ‹é…ç½®ä¿¡æ¯"><a class="header" href="#122-æŸ¥çœ‹é…ç½®ä¿¡æ¯">1.2.2 æŸ¥çœ‹é…ç½®ä¿¡æ¯</a></h3>
<pre><code class="language-bash">git config --list
</code></pre>
<p>output å¦‚ä¸‹</p>
<pre><code>color.ui=true
user.name=einsli
user.email=einsli@123.com
credential.helper=cache  --timeout=200
filter.media.clean=git-media-clean %f
filter.media.smudge-git-media-smudge %f
alias.co=checkout
core.excludesfile=/Users/einsli/.gitignore_global
</code></pre>
<h3 id="123-é‡æ–°é…ç½®ç”¨æˆ·åå¯ä½¿ç”¨-unset-å‘½ä»¤"><a class="header" href="#123-é‡æ–°é…ç½®ç”¨æˆ·åå¯ä½¿ç”¨-unset-å‘½ä»¤">1.2.3 é‡æ–°é…ç½®ç”¨æˆ·åï¼Œå¯ä½¿ç”¨ unset å‘½ä»¤</a></h3>
<pre><code class="language-bash">git config --unset --global user.name

git config --list
</code></pre>
<p>output å¦‚ä¸‹</p>
<pre><code>color.ui=true
user.email=einsli@123.com
credential.helper=cache  --timeout=200
filter.media.clean=git-media-clean %f
filter.media.smudge-git-media-smudge %f
alias.co=checkout
core.excludesfile=/Users/einsli/.gitignore_global
</code></pre>
<p>ç”¨æˆ·åé€‰é¡¹å·²ç»ç§»é™¤</p>
<h3 id="124-git-è¾“å‡ºä¸»é¢˜é¢œè‰²é…ç½®"><a class="header" href="#124-git-è¾“å‡ºä¸»é¢˜é¢œè‰²é…ç½®">1.2.4 git è¾“å‡ºä¸»é¢˜é¢œè‰²é…ç½®</a></h3>
<pre><code class="language-bash">git config --global color.ui true
</code></pre>
<h3 id="125-äº§çœ‹-git-é…ç½®"><a class="header" href="#125-äº§çœ‹-git-é…ç½®">1.2.5 äº§çœ‹ git é…ç½®</a></h3>
<p>git é…ç½®ä¼šä¿å­˜åœ¨å½“å‰ç”¨æˆ·ä¸»ç›®å½•ä¸‹é¢</p>
<pre><code class="language-bash">cat ~/.gitconfig
</code></pre>
<p>output å¦‚ä¸‹</p>
<pre><code>[color]
				ui = true
[user]
				email = einsli@123.com
				name = einsli
[core]
[web]
[credential]
				helper = cache --timeout=200
[filter "media"]
				clean = git-media-clean %f
				smudge = git-media-smudge %f
[alias]
				co = check out
[core]
				excludesfile = /Users/einsli/.gitignore_global
</code></pre>
<h3 id="126-git-åˆ«åè®¾ç½®"><a class="header" href="#126-git-åˆ«åè®¾ç½®">1.2.6 git åˆ«åè®¾ç½®</a></h3>
<p>è®¾ç½®åˆ«åç”¨ aliasï¼Œæ¯”å¦‚ç»™ check out è®¾ç½®åˆ«å</p>
<pre><code class="language-bash">git config ==global alias.co check out
</code></pre>
<p>å¯ä»¥åœ¨ç³»ç»Ÿçº§åˆ«è®¾ç½®åˆ«å, å½“å‰å¹³å° MacOS å¹³å°ï¼Œç”¨æˆ·é…ç½®æ–‡ä»¶åä¸º.bash_profile</p>
<pre><code class="language-bash">vim ~/.bash_profile

# å°† alias goc="git check out" æ·»åŠ åˆ°ç¬¬ä¸€è¡Œå³å¯

# é€€å‡º å¹¶æ›´æ–°
souroce ~/.bash_profile
</code></pre>
<h3 id="127-å¿½ç•¥è·Ÿè¸ªæ–‡ä»¶-å…¨å±€"><a class="header" href="#127-å¿½ç•¥è·Ÿè¸ªæ–‡ä»¶-å…¨å±€">1.2.7 å¿½ç•¥è·Ÿè¸ªæ–‡ä»¶ å…¨å±€</a></h3>
<p>è®¾ç½®å…¨å±€åˆ—è¡¨ä¸­å¿½ç•¥çš„æ–‡ä»¶</p>
<pre><code class="language-bash">git config --global core.excludesfile=~/.gitignore_global
</code></pre>
<h3 id="128-å¿½ç•¥è·Ÿè¸ªæ–‡ä»¶-é¡¹ç›®çº§åˆ«"><a class="header" href="#128-å¿½ç•¥è·Ÿè¸ªæ–‡ä»¶-é¡¹ç›®çº§åˆ«">1.2.8 å¿½ç•¥è·Ÿè¸ªæ–‡ä»¶ é¡¹ç›®çº§åˆ«</a></h3>
<p>åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼Œåˆ›å»º.gitignore</p>
<p>è¾“å…¥éœ€è¦å¿½ç•¥çš„å†…å®¹å³å¯</p>
<p>æ¯”å¦‚å¿½ç•¥æ‰€æœ‰åç¼€åä¸º.log çš„æ–‡ä»¶</p>
<p>.gitngnore</p>
<pre><code>*.log
</code></pre>
<p>å¯å‚è€ƒå¦‚ä¸‹åœ°å€ç»™å‡ºçš„ gitignore çš„æ¨¡æ¿</p>
<p><a href="https://github.com/github/gitignore">https://github.com/github/gitignore</a></p>
<h2 id="13-é¡¹ç›®æ“ä½œ"><a class="header" href="#13-é¡¹ç›®æ“ä½œ">1.3 é¡¹ç›®æ“ä½œ</a></h2>
<h3 id="131-git-init"><a class="header" href="#131-git-init">1.3.1 git init</a></h3>
<p>ä¾‹å¦‚å½“å‰ç›®å½•æœ‰ä¸ª test-serverï¼Œéœ€è¦è¿›è¡Œ git è¿½è¸ª</p>
<pre><code>cd test-server
git init
</code></pre>
<p>output å¦‚ä¸‹</p>
<pre><code>Initialized empty Git repository in /Users/einsli/Desktop/server-test/.git
</code></pre>
<p>ç”Ÿæˆä¹‹åï¼Œgit ä¼šè·Ÿè¸ª server-test ç›®å½•ä¸‹æ‰€æœ‰çš„ç›®å½•å˜åŒ–ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ git æä¾›çš„ç‰ˆæœ¬æ§åˆ¶</p>
<p>æŸ¥çœ‹ç”Ÿæˆçš„.git æ–‡ä»¶</p>
<pre><code class="language-bash">ls .git
</code></pre>
<p>output å¦‚ä¸‹</p>
<pre><code>HEAD        config        hooks    objects
branches    description   info      refs
</code></pre>
<p>å¦‚æœä¸æƒ³ç”¨ git è¿½è¸ªæ­¤é¡¹ç›®ï¼Œåˆ é™¤.git æ–‡ä»¶å³å¯</p>
<h3 id="132-git-commit"><a class="header" href="#132-git-commit">1.3.2 git commit</a></h3>
<p>é¡¹ç›®æäº¤</p>
<p>æ–°åˆ›å»ºä¸€ä¸ª index.html æ–‡ä»¶</p>
<p>æäº¤å‰å¯æŸ¥çœ‹å½“å‰çŠ¶æ€ä¿¡æ¯</p>
<pre><code class="language-bash">git status
</code></pre>
<p>output å¦‚ä¸‹</p>
<pre><code>On branch master

Initial commit

Untracked files:
  (use "git add &lt;file&gt;..." to include in what will be committed)
				index.html

nothing added to commit but untracked files present(use "git add" to track)
</code></pre>
<p>commit ä¹‹å‰å…ˆæ‰§è¡Œ git add</p>
<pre><code class="language-bash">git add index.html
</code></pre>
<p>ç„¶åæŸ¥çœ‹ä¸‹çŠ¶æ€</p>
<pre><code class="language-bash">git status
</code></pre>
<p>output å¦‚ä¸‹</p>
<pre><code>On branch master

Initial commit

Changes to be committed:
  (use "git tm --cached &lt;file&gt;..." to unstage)
		  new files: index.html
</code></pre>
<p>ç¡®è®¤æäº¤</p>
<pre><code class="language-bash">git commit -m 'æ¡ä»¶index.html'
</code></pre>
<p>output å¦‚ä¸‹</p>
<pre><code>1 file changed, 10 insertions(+)
create mode 100644 index.html
</code></pre>
<p>ç„¶åæŸ¥çœ‹ä¸‹çŠ¶æ€</p>
<pre><code class="language-bash">git status
</code></pre>
<p>output å¦‚ä¸‹</p>
<pre><code>On branch master
nothing to commit, working directory clean1.
</code></pre>
<h3 id="133-git-log"><a class="header" href="#133-git-log">1.3.3 git log</a></h3>
<p>æŸ¥çœ‹ç”¨æˆ·æ“ä½œè®°å½•</p>
<pre><code class="language-bash">git log
git log --oneline # æ¯è¡Œæ˜¾ç¤ºä¸€æ¬¡æäº¤
</code></pre>
<p>output å¦‚ä¸‹</p>
<pre><code>commit dagdgakhregjakgjkf7423gdgdjk4334gue61
Author: einsli &lt;einsli@123.com&gt;
Date: Sun Nov 11:07:00 2020 +0800
		æ·»åŠ index.htmlæ–‡ä»¶
</code></pre>
<h3 id="134-git-diff"><a class="header" href="#134-git-diff">1.3.4 git diff</a></h3>
<p>æŸ¥çœ‹æ–‡ä»¶ä¿®æ”¹å‰å’Œä¿®æ”¹åçš„åŒºåˆ«</p>
<p>æ¯”è¾ƒçš„æ–‡ä»¶ä¸ºå·¥ä½œåŒºæš‚ä¸å­˜åŒº(git add åé‡Œé¢çš„å†…å®¹)é‡Œé¢çš„å†…å®¹</p>
<pre><code class="language-bash">git diff index.html
</code></pre>
<p>å¦‚æœæƒ³æ¯”è¾ƒ respository ä¸æš‚å­˜åŒºé‡Œé¢çš„å†…å®¹ï¼Œåˆ™éœ€è¦è¾“å…¥ä¸‹é¢å‘½ä»¤</p>
<pre><code class="language-bash">git diff --staged
</code></pre>
<h3 id="135-git-mv"><a class="header" href="#135-git-mv">1.3.5 git mv</a></h3>
<p>é‡å‘½å git å·²ç»è¿½è¸ªçš„æ–‡ä»¶</p>
<p>æ–¹æ³•ä¸€</p>
<p>ä¾‹å¦‚:</p>
<p>å½“å‰ç›®å½•ä¸‹æ–°å»º style.cssï¼Œæ·»åŠ å†…å®¹åå¹¶æäº¤</p>
<pre><code class="language-bash">git add style.css
git commit -m "æ·»åŠ style.css"
</code></pre>
<p>åœ¨å¯è§†åŒ–ç•Œé¢å°† style.css é‡å‘½åä¸º them.css</p>
<p>æŸ¥çœ‹å½“å‰çŠ¶æ€</p>
<pre><code class="language-bash">git status
</code></pre>
<p>output å¦‚ä¸‹</p>
<pre><code>On branch master
Changes not stages for commit:
		(use "git add/rm &lt;file&gt;..." to update what will be committed)
		(use "git checkout -- &lt;file&gt;..." to discard changes in working directory)
				deleted; sytle.css
Untracked files:
		(use "git add &lt;file&gt;..." to include in what will will be committed)
				theme.css
no changes added to commit (use "git add" and/or "git commit -a")
</code></pre>
<p>ç”±æ­¤çœ‹æ¥ï¼Œgit ä¸çŸ¥é“é€šè¿‡å¯è§†åŒ–ç•Œé¢é‡å‘½åäº†æ­¤æ–‡ä»¶</p>
<p>å¯ä»¥è¿™æ ·æ‰§è¡Œ</p>
<pre><code>git rm style.css
# output
# rm 'style.css'
git add theme.css
</code></pre>
<p>æŸ¥çœ‹çŠ¶æ€</p>
<pre><code class="language-bash">git status
</code></pre>
<pre><code>Changes to be committed:
		(use "git reset HEAD &lt;file&gt;..." to unstage)
					renamed: style.css -&gt;them.css
</code></pre>
<p>ç„¶åæäº¤å³å¯</p>
<pre><code class="language-bash">git commit -m "é‡å‘½åstyle.cssä¸ºthem.css"
</code></pre>
<p>æ–¹æ³•äºŒ</p>
<p>git mv</p>
<pre><code class="language-bash">git mv theme.css einsli-theme.css
</code></pre>
<p>ç„¶åäº§çœ‹çŠ¶æ€</p>
<pre><code class="language-bash">git status
</code></pre>
<p>output å¦‚ä¸‹</p>
<pre><code class="language-bash">Changes to be committed:
		(use "git reset HEAD &lt;file&gt;..." to unstage)
					renamed: theme.css -&gt;einsli-them.css
</code></pre>
<p>ç„¶åæäº¤å³å¯</p>
<p><strong>git ä¸ä¼šè·Ÿè¸ªç©ºç™½çš„ç›®å½•</strong></p>
<p>åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»º css æ–‡ä»¶</p>
<pre><code class="language-bash">mkdir css
</code></pre>
<p>æŸ¥çœ‹çŠ¶æ€</p>
<pre><code class="language-bash">git status
</code></pre>
<p>output å¦‚ä¸‹</p>
<pre><code class="language-bash">On branch master
Nothing to commit, working directory clean
</code></pre>
<h3 id="136-git-rm"><a class="header" href="#136-git-rm">1.3.6 git rm</a></h3>
<p>åˆ é™¤æ–‡ä»¶æœ‰ä¸¤ç§æ–¹æ³•</p>
<p>æ–¹æ³•ä¸€</p>
<p>å°†æ–‡ä»¶é€šè¿‡å¯è§†åŒ–å‘½ä»¤ç›´æ¥åˆ é™¤</p>
<p>æ–¹æ³•äºŒ</p>
<p>git rm æ–‡ä»¶å</p>
<p>åˆ é™¤å•ä¸ªæ–‡ä»¶</p>
<pre><code class="language-bash">git rm einsli-theme.css
</code></pre>
<h3 id="137-æ¢å¤æ”¾æ”¾æˆ–ä¿®æ”¹çš„æ–‡ä»¶"><a class="header" href="#137-æ¢å¤æ”¾æ”¾æˆ–ä¿®æ”¹çš„æ–‡ä»¶">1.3.7 æ¢å¤æ”¾æ”¾æˆ–ä¿®æ”¹çš„æ–‡ä»¶</a></h3>
<p>æ¯”å¦‚åˆ é™¤ index.html</p>
<pre><code class="language-bash">git rm index.html
</code></pre>
<p>åˆ é™¤åæˆ‘ä»¬æƒ³æ¢å¤ï¼Œå¯ä½¿ç”¨ git checkout å‘½ä»¤</p>
<pre><code class="language-bash">git checkout HEAD -- index.html
</code></pre>
<p><strong>æ³¨</strong>: HEAD è¡¨ç¤ºå½“å‰æäº¤ï¼Œâ€” è¡¨ç¤ºå½“å‰åˆ†æ”¯ï¼Œ index.html è¡¨ç¤ºè¦æ¢å¤çš„æ–‡ä»¶</p>
<p>åˆ é™¤ä¹‹åè¿›è¡Œäº†æäº¤æ€ä¹ˆæ¢å¤æ–‡ä»¶ï¼Ÿ</p>
<p>æ¯”å¦‚åˆ é™¤äº† index.htmlï¼Œå¹¶è¿›è¡Œäº†æäº¤ï¼Œè¦æ¢å¤ index.html æ”¹æ€ä¹ˆåš?</p>
<p>éœ€è¦æŠŠ index.html æ¢å¤åˆ°ä¸Šä¸€æ¬¡æäº¤çš„çŠ¶æ€</p>
<pre><code class="language-bash">git checkout HEAD^ -- index.html
</code></pre>
<p><strong>æ³¨</strong>: HEAD^ è¡¨ç¤ºæœ€è¿‘ä¸€æ¬¡æäº¤çš„ä¸Šä¸€æ¬¡æäº¤ï¼ŒHEAD^^è¡¨ç¤ºæœ€è¿‘ä¸€æ¬¡æäº¤çš„ä¸Šä¸¤æ¬¡æäº¤</p>
<h3 id="138-git-revert"><a class="header" href="#138-git-revert">1.3.8 git revert</a></h3>
<p>æ¢å¤æ–‡ä»¶çš„å†å²ç‰ˆæœ¬</p>
<p>æ¯”å¦‚æ–°æ·»åŠ äº† bootstrap æ¡†æ¶ï¼Œå¹¶è¿›è¡Œäº†æäº¤ï¼Œåé¢ä¸æƒ³ç”¨ï¼Œæƒ³æ¢å¤ä¹‹å‰çš„çŠ¶æ€</p>
<pre><code class="language-bash">git log --oneline
</code></pre>
<p>output å¦‚ä¸‹</p>
<pre><code>b6b86f æ·»åŠ äº†JQuery 1.2.1
bb95e87 æ·»åŠ äº†Bootstrapæ¡†æ¶
aa5673a æ¢å¤äº†index.html
</code></pre>
<p>ä¸æƒ³ç”¨ boorstrap æ¡†æ¶ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œ</p>
<pre><code class="language-bash">git revert bb95e87
</code></pre>
<p>ä¼šå¼¹å‡ºç¼–è¾‘å™¨ï¼Œæ·»åŠ æè¿°å†…å®¹æˆ–è€…ç›´æ¥ä¿å­˜åå³å¯</p>
<p>ç„¶ååœ¨æŸ¥çœ‹ä¸‹æäº¤æ—¥å¿—</p>
<pre><code class="language-bash">git log --oneline
</code></pre>
<p>output å¦‚ä¸‹</p>
<pre><code>aaab1c0 Revert "æ·»åŠ äº†Bootstrapæ¡†æ¶"
b6b86f æ·»åŠ äº†JQuery 1.2.1
bb95e87 æ·»åŠ äº†Bootstrapæ¡†æ¶
aa5673a æ¢å¤äº†index.html
</code></pre>
<h3 id="139-git-reset"><a class="header" href="#139-git-reset">1.3.9 git reset</a></h3>
<p>æäº¤æ–¹å¼</p>
<ul>
<li>â€”soft è½¯é‡ç½®ï¼šä¸ä¼šå½±å“å·¥ä½œåŒºä¸æš‚å­˜åŒº</li>
<li>â€”hard ï¼šä»–ä¼šæŠŠå·¥ä½œåŒºä¸æš‚å­˜åŒºæ¢å¤åˆ°æŸä¸ªå·¥ä½œçŠ¶æ€</li>
<li>mixedï¼šä¼šæŠŠæš‚å­˜åŒºé‡Œé¢çš„æ¢å¤åˆ°æŸä¸ªçŠ¶æ€</li>
</ul>
<p>å±•ç¤º:</p>
<p>æŸ¥çœ‹æäº¤è®°å½•</p>
<pre><code class="language-bash">git log --oneline
</code></pre>
<p>output å¦‚ä¸‹</p>
<pre><code>aaab1c0 Revert "æ·»åŠ äº†Bootstrapæ¡†æ¶"
b6b86f æ·»åŠ äº†JQuery 1.2.1
bb95e87 æ·»åŠ äº†Bootstrapæ¡†æ¶
aa5673a æ¢å¤äº†index.html
</code></pre>
<p>ä½¿ç”¨ git reset</p>
<p>â€” soft</p>
<pre><code class="language-bash">git reset --soft b6b86
</code></pre>
<p>æäº¤åä¼šè¦†ç›–æ‰ aaab1c0 è¿™æ¬¡æäº¤</p>
<p>â€” mixed</p>
<p>æ‰§è¡Œåæš‚å­˜åŒºé‡Œé¢çš„å†…å®¹ä¸å­˜åœ¨äº†</p>
<p><strong>æ³¨</strong> ä¸â€”soft é¡¹ç›®ï¼Œå°‘äº†ç±»ä¼¼ git add çš„æ“ä½œ</p>
<p>â€”hard</p>
<p>ç›¸å½“äºç›´æ¥é‡ç½®åˆ° b6b86 æäº¤åçš„çŠ¶æ€</p>
<h3 id="1310-git-stash"><a class="header" href="#1310-git-stash">1.3.10 git stash</a></h3>
<p>å¯ä»¥æŠŠä¿®æ”¹æš‚æ—¶å­˜åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œä¿å­˜å·¥ä½œè¿›åº¦</p>
<p>ä¾‹å¦‚å½“å‰ç›®å½•åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ txt æ–‡æ¡£ï¼Œä½†æ˜¯æäº¤çš„æ—¶å€™ï¼Œä¸æƒ³å°†å½“å‰çŠ¶æ€æäº¤</p>
<pre><code class="language-bash">git stash save "ä¿®æ”¹äº†txtæ–‡æ¡£"
</code></pre>
<p>æŸ¥çœ‹ä¿å­˜çš„å·¥ä½œè¿›åº¦</p>
<pre><code class="language-bash">git stash list
</code></pre>
<p>output å¦‚ä¸‹</p>
<pre><code>stash{0}: On text-server: ä¿®æ”¹äº†txtæ–‡æ¡£
</code></pre>
<p>æŸ¥çœ‹ä¿å­˜å·¥ä½œè¿›åº¦ä¸å½“å‰å·¥ä½œè¿›åº¦æœ‰ä»€ä¹ˆåŒºåˆ«</p>
<pre><code class="language-bash">git stash show -p stash{0}
</code></pre>
<p><strong>æ³¨</strong> -p ä»¥è¡¥ä¸çš„æ–¹å¼æŸ¥çœ‹ stash{0}ä¸º stash å·¥ä½œä»£å·</p>
<p>æ¢å¤å·¥ä½œè¿›åº¦</p>
<pre><code>git stash apply stash{0}
</code></pre>
<p><strong>æ³¨</strong>ï¼šstash{0}ä¸º stash ä»£å·</p>
<p>åˆ é™¤å·¥ä½œè¿›åº¦</p>
<pre><code>git stash drop stash{0}
</code></pre>
<p><strong>æ³¨</strong> stash{0}ä¸ºå·¥ä½œä»£å·</p>
<h3 id="1311-git-log"><a class="header" href="#1311-git-log">1.3.11 git log</a></h3>
<p>æŸ¥çœ‹æäº¤çš„æ—¥å¿—</p>
<p>æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>
<pre><code class="language-bash">git long
</code></pre>
<p>æ˜¾ç¤ºç®€å•çš„æ—¥å¿—åˆ—è¡¨</p>
<pre><code class="language-bash">git log --oneline
</code></pre>
<p>æ§åˆ¶è¾“å‡ºçš„è¡Œæ•°ï¼Œå¦‚æ˜¾ç¤ºæœ€è¿‘çš„ 5 æ¡</p>
<pre><code class="language-bash">git log --oneline -5
</code></pre>
<p>å¯ä»¥æŸ¥çœ‹æŒ‡å®šä½œè€…çš„æäº¤</p>
<pre><code class="language-bash">git log --online --author="einsli"
</code></pre>
<p>git log ä¹Ÿæ”¯æŒ grep è¯­æ³•</p>
<p>æ¯”å¦‚æ˜¾ç¤ºå…³äº index.html çš„æäº¤</p>
<pre><code class="language-bash">git log --oneline --grep="index.html"
</code></pre>
<p>ä¹Ÿå¯ä»¥æŒ‡å®šæ—¥å¿—</p>
<p>æ¯”å¦‚æŒ‡å®šåœ¨ 2020 å¹´ 11 æœˆ 1 å·ä¹‹å‰çš„æäº¤</p>
<pre><code class="language-bash">git log --oneline --before="2020-11-01"
</code></pre>
<p>æ‰¾å‡ºä¸€ä¸ªç¤¼æ‹œä¹‹å‰çš„æäº¤</p>
<pre><code class="language-bash">git log --oneline --before="1 week"
</code></pre>
<p>æ‰¾å‡ºä¸‰å¤©å‰çš„æäº¤</p>
<pre><code class="language-bash">git log --oneline --before="3 days"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="git-http-æ–¹å¼å…å¯†å…‹éš†ä»£ç "><a class="header" href="#git-http-æ–¹å¼å…å¯†å…‹éš†ä»£ç ">git http æ–¹å¼å…å¯†å…‹éš†ä»£ç </a></h1>
<p>å…å¯†æ‹‰å–é…ç½®
æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåœ¨<code>home</code>ç›®å½•ä¸‹ï¼Œåˆ›å»º<code>.git-credentials</code>æ–‡ä»¶ å†™å…¥å¦‚ä¸‹å†…å®¹</p>
<pre><code class="language-shell">cat &gt; $HOME/.git-credentials &lt;&lt; EOF
https://username:password@git.gitxx.com
EOF
</code></pre>
<p>å…¶ä¸­ <code>username</code>æ›¿æ¢ä¸ºè‡ªå·±çš„ç”¨æˆ·åï¼Œ<code>password</code>æ›¿æ¢ä¸ºç™»å½•çš„å¯†ç </p>
<p>æ¯”å¦‚ <a href="https://einsli:passw0rd@git.einsli.com">https://einsli:passw0rd@git.einsli.com</a></p>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ›´æ–°é…ç½®</p>
<pre><code class="language-shell">git config --global credential.helper store
</code></pre>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯</p>
<pre><code class="language-shell">git config --list
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹</p>
<pre><code class="language-PlainText">credential.helper=store
</code></pre>
<p>æˆ–è€…æŸ¥çœ‹ä¸€ä¸‹<code>$HOME/.gitconfig</code> æ–‡ä»¶</p>
<pre><code class="language-shell">cat $HOME/.gitconfig
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹</p>
<pre><code class="language-PlainText">[credential]
	helper = store
</code></pre>
<p>è¿™æ—¶å€™å†ç”¨ git æ‹‰å–ä»“åº“å°±ä¸éœ€è¦è¾“å…¥ç”¨æˆ·åå’Œå¯†ç äº†ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="git-å¼€å‘ç®¡ç†è§„èŒƒ"><a class="header" href="#git-å¼€å‘ç®¡ç†è§„èŒƒ">git å¼€å‘ç®¡ç†è§„èŒƒ</a></h1>
<h2 id="1åˆ›å»º-git-ä»“åº“"><a class="header" href="#1åˆ›å»º-git-ä»“åº“">1ã€åˆ›å»º Git ä»“åº“</a></h2>
<p>1ã€åˆ›å»º README.md</p>
<p>2ã€åˆ›å»º.gitignore æ–‡ä»¶ï¼Œæœ€åŸºæœ¬åŒ…å«å¦‚ä¸‹å†…å®¹</p>
<pre><code class="language-plainText">.idea
log
.DS_Store
__pycache__
</code></pre>
<h2 id="2åˆ†æ”¯ç®¡ç†"><a class="header" href="#2åˆ†æ”¯ç®¡ç†">2ã€åˆ†æ”¯ç®¡ç†</a></h2>
<p><strong>ç¯å¢ƒ</strong></p>
<div class="table-wrapper"><table><thead><tr><th>ç®€ç§°</th><th>å¤‡æ³¨</th></tr></thead><tbody>
<tr><td>dev</td><td>å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒ</td></tr>
<tr><td>prod</td><td>ç”Ÿäº§ç¯å¢ƒ</td></tr>
</tbody></table>
</div>
<p><strong>åˆ†æ”¯åˆ’åˆ†</strong>
master å’Œ dev ä¸å¯ç›´æ¥æäº¤ï¼Œéœ€è¦ pull request, code review å merge</p>
<div class="table-wrapper"><table><thead><tr><th>åˆ†æ”¯</th><th>åç§°</th><th>ç¯å¢ƒ</th><th>å¤‡æ³¨</th></tr></thead><tbody>
<tr><td>master</td><td>ä¸»åˆ†æ”¯</td><td>PROD</td><td>ç”¨äºæ­£å¼ç‰ˆæœ¬éƒ¨ç½²ï¼Œç»“åˆ git tag ä½¿ç”¨</td></tr>
<tr><td>dev</td><td>æµ‹è¯•åˆ†æ”¯</td><td>DEV</td><td>ç”¨äºæµ‹è¯•éƒ¨ç½²ï¼Œå®ç°æŒç»­é›†æˆï¼Œä¾¿äºæµ‹è¯•</td></tr>
<tr><td>feature</td><td>éœ€æ±‚å¼€å‘åˆ†æ”¯</td><td>DEV</td><td>ç”¨äºåŠŸèƒ½å¼€å‘ï¼Œç”±é¡¹ç›®ç®¡ç†äººå‘˜æŒ‡å®šåˆ›å»º</td></tr>
<tr><td>bugfix</td><td>bug ä¿®å¤åˆ†æ”¯</td><td>DEV</td><td>ç”¨äºä¿®å¤ dev åˆ†æ”¯æµ‹è¯•å‡ºçš„ bug</td></tr>
<tr><td>hotfix</td><td>ç´§æ€¥ä¿®å¤åˆ†æ”¯</td><td>PROD</td><td>ç”¨äºä¿®å¤ master åˆ†æ”¯ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°çš„ bug</td></tr>
</tbody></table>
</div>
<p><img src="operations/git/../../images/operations/git/git_dev_process.png" alt="avatar" /></p>
<ol>
<li>éœ€æ±‚æ”¶é›†ã€è®ºè¯å’Œåˆ†è§£åï¼ŒæŒ‡å®šå¼€å‘äººå‘˜ä» dev åˆ†æ”¯æ ¹æ®éœ€æ±‚åˆ›å»º feature åˆ†æ”¯ï¼›</li>
<li>å¼€å‘äººå‘˜åœ¨ feature åˆ†æ”¯å¼€å‘ï¼Œæœ¬åœ°å¼€å‘æµ‹è¯•å®Œæˆåæäº¤åˆ°åˆ†æ”¯ï¼›</li>
<li>å…ˆå°† dev ä¸ feature åˆ†æ”¯åˆå¹¶ï¼Œå¹¶ä¿®å¤åˆå¹¶çš„ bugï¼›</li>
<li>åœ¨ bug ä¿®å¤åå°† feature åˆ†æ”¯æäº¤ pull request åˆ° dev åˆ†æ”¯ï¼Œç”±ä¸»å¼€å‘äººå‘˜å®¡æŸ¥ååˆå¹¶ï¼›</li>
<li>æµ‹è¯•äººå‘˜åœ¨ dev åˆ†æ”¯æ›´æ–°åï¼Œè¿›è¡Œæµ‹è¯•ï¼Œå¹¶è®°å½• bugï¼›</li>
<li>ç›¸å…³äººå‘˜æ–°å»º bug åˆ†æ”¯ï¼Œä¿®å¤ bugï¼Œæäº¤ pull requestï¼Œç”±ä¸»å¼€å‘äººå‘˜å®¡æŸ¥ååˆå¹¶ï¼›</li>
<li>æµ‹è¯•é€šè¿‡åç”±é¡¹ç›®/æŠ€æœ¯è´Ÿè´£äººè¿›è¡Œ code reviewï¼Œæäº¤åˆ° master åˆ†æ”¯ï¼Œä½¿ç”¨ git tag æ ‡è®°ç‰ˆæœ¬ï¼Œå¹¶è¿›è¡Œ release å‘ç‰ˆï¼Œå°†ç›¸å…³æ¨¡å‹å’Œæ•°æ®æ‰“åŒ…å­˜å‚¨ï¼›</li>
<li>çº¿ä¸Šä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå‘ç° bugï¼Œåˆ›å»º hotfix åˆ†æ”¯ï¼Œä¿®å¤åï¼Œç”±é¡¹ç›®/æŠ€æœ¯è´Ÿè´£äººåˆå¹¶åˆ° master åˆ†æ”¯ï¼Œå¹¶åŒæ­¥åˆ° dev åˆ†æ”¯ã€‚</li>
</ol>
<h2 id="3gitlab-çš„-group-ç®¡ç†"><a class="header" href="#3gitlab-çš„-group-ç®¡ç†">3ã€GitLab çš„ group ç®¡ç†</a></h2>
<ol>
<li>åˆ†ä¸ºå‡ å¤§åŸºç¡€ groupï¼šé¢„ç ”é¡¹ç›®ï¼Œå»ºè®¾æ€§é¡¹ç›®ï¼Œäº§å“ï¼Œé€šç”¨ç®—æ³•æœåŠ¡</li>
<li>åŸºç¡€ group ä¸‹é¢æ ¹æ®æ¥æºå•å…ƒã€æ‰¿ç ”å•ä½ç­‰å»º subgroupï¼Œsubgroup ä¸‹é¢å»ºé¡¹ç›®çš„ subgroup</li>
<li>ä¸€ä¸ªé¡¹ç›®æ‰€æœ‰ä»£ç ä»“åº“éƒ½åœ¨ä¸€ä¸ª subgroup é‡Œé¢</li>
<li>ä¸€ä¸ªé¡¹ç›®çš„ä»£ç ä»“åº“å…±ç”¨ä¸€ä¸ªä¸»çš„åç§°ï¼Œæ ¹æ®å‰åç«¯æ¥è¿›è¡Œåç¼€å‘½å</li>
<li>ä¸€ä¸ªé¡¹ç›®å¿…é¡»æœ‰ doc ä»“å‚¨ï¼Œè®°å½•æ‰€æœ‰äº§å“è®¾è®¡æ–‡æ¡£ã€è®¾è®¡å›¾ã€æŠ€æœ¯è®¾è®¡æ–‡æ¡£ã€æ¥å£æ–‡æ¡£ã€æµ‹è¯•æ–‡æ¡£ï¼Œå°½é‡ä½¿ç”¨ Markdown æ ¼å¼ã€‚</li>
</ol>
<p><img src="operations/git/../../images/operations/git/git_proj.png" alt="avatar" /></p>
<h2 id="commit-æ—¥å¿—è§„èŒƒ"><a class="header" href="#commit-æ—¥å¿—è§„èŒƒ">commit æ—¥å¿—è§„èŒƒ</a></h2>
<p>å»ºè®®å‚è€ƒè§„èŒƒï¼š</p>
<p>e.g</p>
<p>fix(é¦–é¡µæ¨¡å—)ï¼šä¿®å¤å¼¹çª— JS Bugã€‚</p>
<p>typeÂ  è¡¨ç¤ºåŠ¨ä½œç±»å‹ï¼Œå¯åˆ†ä¸º:</p>
<p>fixï¼šä¿®å¤ xxx Bug</p>
<p>featï¼šæ–°å¢ xxx åŠŸèƒ½</p>
<p>testï¼šè°ƒè¯• xxx åŠŸèƒ½</p>
<p>styleï¼šå˜æ›´ xxx ä»£ç æ ¼å¼æˆ–æ³¨é‡Š</p>
<p>docsï¼šå˜æ›´ xxx æ–‡æ¡£</p>
<p>refactorï¼šé‡æ„ xxx åŠŸèƒ½æˆ–æ–¹æ³•</p>
<p>scopeÂ  è¡¨ç¤ºå½±å“èŒƒå›´ï¼Œå¯åˆ†ä¸ºï¼šæ¨¡å—ã€ç±»åº“ã€æ–¹æ³•ç­‰ã€‚</p>
<p>subjectÂ  è¡¨ç¤ºç®€çŸ­æè¿°ï¼Œæœ€å¥½ä¸è¦è¶…è¿‡ 60 ä¸ªå­—ï¼Œå¦‚æœæœ‰ç›¸å…³ Bug çš„ç¼–å·ï¼Œå»ºè®®åœ¨æè¿°ä¸­åŠ ä¸Šã€‚<br></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="harbor-åŸºç¡€æ“ä½œ"><a class="header" href="#harbor-åŸºç¡€æ“ä½œ">harbor åŸºç¡€æ“ä½œ</a></h1>
<p>è¿™é‡Œä¸»è¦æ˜¯ harbor å®‰è£…ä»¥åŠåŸºç¡€æ“ä½œ</p>
<ul>
<li><a href="operations/harbor/harbor_install.html">harbor å®‰è£…ä¸é…ç½®</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="harbor-å®‰è£…ä¸é…ç½®"><a class="header" href="#harbor-å®‰è£…ä¸é…ç½®">harbor å®‰è£…ä¸é…ç½®</a></h1>
<h2 id="å‰æœŸå‡†å¤‡-8"><a class="header" href="#å‰æœŸå‡†å¤‡-8">å‰æœŸå‡†å¤‡</a></h2>
<p>ä¾èµ–<code>docker</code>å’Œ <code>docker-composeç¯å¢ƒ</code></p>
<p>è¯·å‚è€ƒ</p>
<p>ğŸ‘‰ğŸ» <a href="operations/harbor/../docker/linux_docker_installed.html">docker å®‰è£…ä¸é…ç½®</a></p>
<p>ğŸ‘‰ğŸ» <a href="operations/harbor/../docker/linux_docker_compose_installed.html">docker-compose å®‰è£…</a></p>
<p>ğŸ‘‰ğŸ» <a href="https://goharbor.io/">harbor å®˜æ–¹æ–‡æ¡£</a></p>
<h2 id="å®‰è£…-harbor"><a class="header" href="#å®‰è£…-harbor">å®‰è£… harbor</a></h2>
<h3 id="1ä¸‹è½½ç¦»çº¿åŒ…"><a class="header" href="#1ä¸‹è½½ç¦»çº¿åŒ…">1ã€ä¸‹è½½ç¦»çº¿åŒ…</a></h3>
<p>harbor ç¦»çº¿åŒ…<a href="https://github.com/goharbor/harbor/releases">ä¸‹è½½åœ°å€</a>
<img src="operations/harbor/../../images/operations/harbor/harbor_pkg.png" alt="avatar" /></p>
<pre><code class="language-shell"># Step 1: ä¸‹è½½é€‰ä¸­çš„ç¦»çº¿ç‰ˆæœ¬
wget https://github.com/goharbor/harbor/releases/download/v2.10.2/harbor-offline-installer-v2.10.2.tgz
</code></pre>
<h3 id="2å‡†å¤‡è¯ä¹¦æ–‡ä»¶"><a class="header" href="#2å‡†å¤‡è¯ä¹¦æ–‡ä»¶">2ã€å‡†å¤‡è¯ä¹¦æ–‡ä»¶</a></h3>
<p><strong>æ³¨:</strong> å¦‚æœä¸ä½¿ç”¨åŸŸåè¿™ä¸€æ­¥å¯ä»¥è·³è¿‡</p>
<p>è¯ä¹¦è´­ä¹°è¯·å‚è€ƒï¼Œé˜¿é‡Œäº‘å®˜æ–¹æ–‡æ¡£ ğŸ‘‰ğŸ» <a href="https://www.alibabacloud.com/help/zh/ssl-certificate/getting-started/get-started-with-ssl-certificates-service">SSL è¯ä¹¦å¿«é€Ÿä¸Šæ‰‹</a></p>
<p>è¿™é‡Œé…ç½®åŸŸåï¼Œä¸‹è½½åçš„ ssl é…ç½®æ–‡ä»¶ä¸º 12808420_harbor.app.love_nginx.zip</p>
<h3 id="3å®‰è£…"><a class="header" href="#3å®‰è£…">3ã€å®‰è£…</a></h3>
<p>è§£å‹ä¸‹è½½çš„æ–‡ä»¶</p>
<pre><code class="language-shell"># Step 1: è§£å‹harbor ç¦»çº¿å®‰è£…åŒ…
tar -zxvf harbor-offline-installer-v2.10.2.tgz -C /usr/local/
# Step 2: è§£å‹ ssl è¯ä¹¦
unzip 12808420_harbor.app.love_nginx.zip -d /usr/local/ssl/
</code></pre>
<h3 id="4é…ç½®"><a class="header" href="#4é…ç½®">4ã€é…ç½®</a></h3>
<p>å¤åˆ¶é…ç½®æ–‡ä»¶</p>
<pre><code class="language-shell"># Step 1: è¿›å…¥harbor ç›®å½•
cd /usr/local/harbor
# Step 2: æ‹·è´é…ç½®æ–‡ä»¶
cp harbor.yml.tmp harbor.yml
</code></pre>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p>
<pre><code class="language-yaml"># Configuration file of Harbor

# The IP address or hostname to access admin UI and registry service.
# DO NOT use localhost or 127.0.0.1, because Harbor needs to be accessed by external clients.
-hostname: reg.mydomain.com
+hostname: harbor.app.love

# http related config
http:
  # port for http, default is 80. If https enabled, this port will redirect to https port
  port: 80

# https related config
https:
  # https port for harbor, default is 443
  port: 443
  # The path of cert and key files for nginx
- certificate: /your/certificate/path
+ certificate: /usr/local/harbor/ssl/harbor.app.love.pem
- private_key: /your/private/key/path
+ private_key: /usr/local/harbor/ssl/harbor.aoo.love.key

# # Uncomment following will enable tls communication between all harbor components
# internal_tls:
#   # set enabled to true means internal tls is enabled
#   enabled: true
#   # put your cert and key files on dir
#   dir: /etc/harbor/tls/internal

# Uncomment external_url if you want to enable external proxy
# And when it enabled the hostname will no longer used
# external_url: https://reg.mydomain.com:8433

# The initial password of Harbor admin
# It only works in first time to install harbor
# Remember Change the admin password from UI after launching Harbor.
- harbor_admin_password: Harbor12345
+ # è¿™é‡Œçš„æ˜¯adminè´¦æˆ·çš„å¯†ç ï¼Œè¦åœ¨å¯åŠ¨å‰æ”¹åŠ¨ï¼Œå¦åˆ™åæœŸæ”¹åŠ¨æ— æ•ˆ
+ harbor_admin_password: YourPassw0rd

# Harbor DB configuration

# The default data volume
data_volume: /data
...

</code></pre>
<h3 id="5å¯åŠ¨-harbor"><a class="header" href="#5å¯åŠ¨-harbor">5ã€å¯åŠ¨ harbor</a></h3>
<pre><code class="language-shell"># Step 1: åˆ›å»ºæ•°æ®ç›®å½•
mkdir /data
# Step 2: è¿›å…¥harborç›®å½•
cd /usr/local/harbor
# Step 3: æ‰§è¡Œprepareå‘½ä»¤ï¼Œè¿›å…¥å‡†å¤‡å¯åŠ¨é˜¶æ®µï¼Œè¿™é‡Œä¼šæ£€æµ‹ä½ çš„ç¯å¢ƒç­‰
./prepare
# Step 4: å‡†å¤‡é˜¶æ®µå®Œæˆåï¼Œå¯åŠ¨ä¸‹è½½harborï¼Œè¿™é‡Œä¼šä¸‹è½½å¹¶è¿è¡Œ7ä¸ªé•œåƒ
./install.sh
</code></pre>
<p>ä½¿ç”¨ docker ps æŸ¥çœ‹æ˜¯å¦å¯åŠ¨(STATUS å‡ä¸º healthy ä¸ºæˆåŠŸï¼Œstarting è¯´æ˜åœ¨å¯åŠ¨ä¸­)</p>
<pre><code class="language-PlainText">CONTAINER ID   IMAGE                                 COMMAND                  CREATED      STATUS                PORTS                                                                            NAMES
f33fa914b17a   goharbor/harbor-jobservice:v2.10.1    "/harbor/entrypoint.â€¦"   4 days ago   Up 4 days (healthy)                                                                                    harbor-jobservice
0056d04b6077   goharbor/nginx-photon:v2.10.1         "nginx -g 'daemon ofâ€¦"   4 days ago   Up 4 days (healthy)   0.0.0.0:80-&gt;8080/tcp, :::80-&gt;8080/tcp, 0.0.0.0:443-&gt;8443/tcp, :::443-&gt;8443/tcp   nginx
94f9f5615503   goharbor/harbor-core:v2.10.1          "/harbor/entrypoint.â€¦"   4 days ago   Up 4 days (healthy)                                                                                    harbor-core
b23a4327987d   goharbor/harbor-registryctl:v2.10.1   "/home/harbor/start.â€¦"   4 days ago   Up 4 days (healthy)                                                                                    registryctl
d1337e58ec54   goharbor/redis-photon:v2.10.1         "redis-server /etc/râ€¦"   4 days ago   Up 4 days (healthy)                                                                                    redis
4f4aeeae61dd   goharbor/harbor-db:v2.10.1            "/docker-entrypoint.â€¦"   4 days ago   Up 4 days (healthy)                                                                                    harbor-db
d4ef619a56d0   goharbor/harbor-portal:v2.10.1        "nginx -g 'daemon ofâ€¦"   4 days ago   Up 4 days (healthy)                                                                                    harbor-portal
d3ef7071fd2a   goharbor/registry-photon:v2.10.1      "/home/harbor/entrypâ€¦"   4 days ago   Up 4 days (healthy)                                                                                    registry
6e10fd5cd5f3   goharbor/harbor-log:v2.10.1           "/bin/sh -c /usr/locâ€¦"   4 days ago   Up 4 days (healthy)   127.0.0.1:1514-&gt;10514/tcp                                                        harbor-log
</code></pre>
<h3 id="5è®¿é—®-harbor"><a class="header" href="#5è®¿é—®-harbor">5ã€è®¿é—® harbor</a></h3>
<p>é€šè¿‡åŸŸåè®¿é—®</p>
<p><a href="https://harbor.app.love">https://harbor.app.love</a></p>
<p><img src="operations/harbor/../../images/operations/harbor/harbor_login.png" alt="avatar" /></p>
<p>ç»ˆç«¯æ“ä½œ</p>
<pre><code class="language-shell"># Step 1: åœ¨è¦ä½¿ç”¨harborçš„ä¸»æœºä¸Šåˆ›å»º /etc/docker/daemon.json æ–‡ä»¶
sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'
{
    "registry-mirrors": [https://harbor.app.love"]
}
EOF
# Step 2: é‡å¯daemon
systemctl daemon-reload
# Step 3: é‡å¯docker
systemctl restart docker
# Step 4: ç™»é™†harborï¼ˆæ³¨æ„ï¼šdocker login harborçš„åœ°å€ï¼‰
docker login harbor.app.love -u admin -p YourPassw0rd
</code></pre>
<p>ç™»å½•è¾“å‡ºå¦‚ä¸‹</p>
<pre><code class="language-PlainText">WARNING! Using --password via the CLI is insecure. Use --password-stdin.
WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded
</code></pre>
<h3 id="6é›†æˆåˆ°-k8s"><a class="header" href="#6é›†æˆåˆ°-k8s">6ã€é›†æˆåˆ° k8s</a></h3>
<p>åœ¨å¯¹åº”å‘½åç©ºé—´ï¼Œåˆ›å»º<code>secret</code>åå¼•ç”¨å³å¯</p>
<pre><code class="language-shell">kubectl create secret docker-registry docker-key \
    --docker-server=harbor.app.love \
    --docker-username='admin' \
    --docker-password='YourPassw0rd' \
    --docker-email='email@email.com' \
    -n app-test
</code></pre>
<p>å¼•ç”¨å¦‚ä¸‹</p>
<pre><code class="language-yaml">---
spec:
  containers: ...
  imagePullSecrets:
    - name: docker-key
</code></pre>
<h4 id="å‚è€ƒæ–‡æ¡£-2"><a class="header" href="#å‚è€ƒæ–‡æ¡£-2">å‚è€ƒæ–‡æ¡£</a></h4>
<ul>
<li><a href="https://juejin.cn/post/7222656390548357177/">Harbor å®‰è£…åŠé…ç½®</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dns-è¿ç»´ç›¸å…³"><a class="header" href="#dns-è¿ç»´ç›¸å…³">dns è¿ç»´ç›¸å…³</a></h1>
<p>è¿™é‡Œä¸»è¦æ˜¯ dns åŸºç¡€è¿ç»´ï¼Œæ¶‰åŠåˆ° dns ç›¸å…³åŸç†ä»¥å’Œç›¸å…³é—®é¢˜çš„å¤„ç†.</p>
<ul>
<li><a href="operations/dns/dns_resolution.html">dns è§£æçš„æµç¨‹</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dns-è§£æçš„æµç¨‹"><a class="header" href="#dns-è§£æçš„æµç¨‹">dns è§£æçš„æµç¨‹</a></h1>
<h2 id="dns-è§£æçš„ç±»å‹"><a class="header" href="#dns-è§£æçš„ç±»å‹">dns è§£æçš„ç±»å‹</a></h2>
<ul>
<li>
<p>A:å°†åŸŸåæŒ‡å‘ä¸€ä¸ª IPv4 åœ°å€ï¼Œå¦‚ 106.55.75.123ã€‚ A è®°å½•å½’å±åœ°æ˜¯åŸƒæ–‡ç§‘æŠ€çš„ä»˜è´¹æ¥å£ï¼Œä¸ºäº†é˜²æ­¢ç›—åˆ·ï¼Œæ¯ä¸ªç”¨æˆ·æœ‰æŸ¥è¯¢é™åˆ¶ï¼Œè¯·èŠ‚çœä½¿ç”¨ã€‚</p>
</li>
<li>
<p>AAAA: å°†åŸŸåæŒ‡å‘ä¸€ä¸ª IPv6 åœ°å€ï¼Œå¦‚ 2402:4e00:1013:e500:0:9671:f018:4947ã€‚åŒä¸€ä¸ªä¸»æœºåå¯ä»¥åŒæ—¶è§£æåˆ° IPv4(A è®°å½•)åœ°å€ å’Œ IPv6(AAAA è®°å½•)åœ°å€ä¸Šï¼Œå½“åªæœ‰ IPv4 åœ°å€çš„ç”¨æˆ·ä¼šè§£æåˆ° IPv4 åœ°å€ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æœ‰ IPv6 åœ°å€çš„ç”¨æˆ·ä¼šä¼˜å…ˆè§£æåˆ° IPv6 åœ°å€ã€‚</p>
</li>
<li>
<p>CNAME: å°†åŸŸåæŒ‡å‘å¦ä¸€ä¸ªåŸŸååœ°å€ï¼Œä¸å…¶ä¿æŒç›¸åŒè§£æï¼Œå¦‚ static.ipw.cn åˆ«ååˆ° static.ipw.cn.cdn.dnsv1.com</p>
</li>
<li>
<p>MX: ç”¨äºé‚®ä»¶æœåŠ¡å™¨ï¼Œä¸€èˆ¬ç”±é‚®ä»¶æ³¨å†Œå•†æä¾›ï¼Œå¦‚ mxbiz1.qq.comã€‚å¦‚æœé‚®ç®±æ ¼å¼ä¸º <a href="mailto:operations/dns/test@ipw.cn">test@ipw.cn</a> åˆ™è¾“å…¥ ipw.cn æŸ¥è¯¢ã€‚å¦‚æœé‚®ç®±æ ¼å¼ä¸º <a href="mailto:operations/dns/test@mail.ipw.cn">test@mail.ipw.cn</a>åˆ™è¾“å…¥ mail.ipw.cn æŸ¥è¯¢ã€‚æ¨è 2 ä¸ªå…è´¹çš„ä¼ä¸šé‚®ç®±ï¼šè…¾è®¯ä¼ä¸šé‚®ã€ç½‘æ˜“&gt; å…è´¹ä¼ä¸šé‚®ã€‚</p>
</li>
<li>
<p>TXT: é™„åŠ æ–‡æœ¬ä¿¡æ¯ï¼Œå¸¸ç”¨äºåŸŸåæ‰€æœ‰æƒéªŒè¯ï¼Œå¦‚åœ¨ç”³è¯· HTTPS è¯ä¹¦æ—¶éœ€è¦å¢åŠ è®°å½•</p>
</li>
<li>
<p>PTR: IP çš„åå‘è§£æè®°å½•ï¼Œä¾‹å¦‚ 159.75.190.197 åè§£æåˆ° ipw.cnï¼Œä¸€èˆ¬ç”¨äºæå‡è‡ªå»ºåŸŸåé‚®ä»¶æœåŠ¡å™¨çš„å¯ä¿¡åº¦ï¼Œå¯æå•æ‰¾äº‘æœåŠ¡å•†æ·»åŠ ã€‚</p>
</li>
<li>
<p>NS: åŸŸåçš„ DNS æœåŠ¡å™¨åœ°å€ï¼Œä¾‹å¦‚ ns3.dnsv2.comï¼Œæ¨è DNSPod.</p>
</li>
</ul>
<br>
<p><strong>DNS ä¸€èˆ¬åˆ†ä¸º<code>æœ¬åœ° DNS</code>ï¼ˆä¸€èˆ¬ç”±ç”µä¿¡è¿è¥å•†æä¾›ï¼‰ å’Œ<code>æƒå¨ DNS</code>ï¼ˆ ç”±æ ¹ DNSã€é¡¶çº§ DNSã€äºŒçº§ DNS ç»„æˆï¼‰</strong></p>
<h2 id="æœ¬åœ°-dns"><a class="header" href="#æœ¬åœ°-dns">æœ¬åœ° DNS</a></h2>
<p>æœ¬åœ° DNS é‡‡ç”¨é€’å½’æŸ¥è¯¢åŸŸåè§£æè®°å½•ï¼Œæ¯”å¦‚æŒ‡å®šä¸€ä¸ªç”µä¿¡ DNSï¼ˆ202.101.224.69ï¼‰æ¥è§£æ ipw.cnï¼Œåœ¨ ANSWER SECTION ä¸­å¯ä»¥çœ‹åˆ°ç›´æ¥è¿”å›äº† ipw.cn çš„ A è®°å½•ã€‚</p>
<p>æœ¬åœ° DNS æœ¬èº«ä¸ä¼šè®°å½•åŸŸåè§£æè®°å½•ï¼Œè€Œæ˜¯æŠŠè¯·æ±‚è½¬å‘åˆ°æƒå¨ DNSï¼Œé€çº§é€’å½’æŸ¥è¯¢ï¼Œå†æŠŠè§£æè®°å½•è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å½“ç„¶å®ƒä¼šç¼“å­˜è§£æè®°å½•ï¼ˆè§£æè®°å½•ä¸­ TTL å±æ€§æ§åˆ¶ç¼“å­˜çš„æ—¶é•¿ã€‚ï¼‰</p>
<p>æœ¬åœ° DNS è§£æç¤ºä¾‹ï¼š</p>
<pre><code class="language-shell">~$ dig @202.101.224.69 ipw.cn
;; QUESTION SECTION:
;ipw.cn.				IN	A

;; ANSWER SECTION:
ipw.cn.			600	IN	A	106.55.75.123
</code></pre>
<h2 id="æƒå¨-dns"><a class="header" href="#æƒå¨-dns">æƒå¨ DNS</a></h2>
<p>ä»¥æŸ¥è¯¢<code>ipw.cn</code> ä¸ºä¾‹ï¼Œäº†è§£ä¸‹è¿™ 3 çº§ DNS çš„ä½œç”¨ã€‚</p>
<ul>
<li>æ ¹ DNSï¼šæ¯”å¦‚ a.root-servers.net. , è´Ÿè´£è¿”å›å¾…æŸ¥è¯¢åŸŸåï¼ˆipw.cn) æ‰€å±é¡¶çº§ DNSï¼ˆå¦‚ a.dns.cn.ï¼‰çš„è§£æè®°å½• 203.119.25.1ï¼›</li>
<li>é¡¶çº§ DNSï¼š æ¯”å¦‚ a.dns.cn. ï¼Œè´Ÿè´£è¿”å›å¾…æŸ¥è¯¢åŸŸåçš„ DNS åœ°å€ï¼ˆå¦‚ ns3.dnsv2.com.ï¼Œç™»è®°åœ¨é¡¶çº§åŸŸåæœåŠ¡å™¨ä¸­ï¼Œé€šè¿‡ whois å‘½ä»¤å¯ä»¥æŸ¥è¯¢ï¼Œåœ¨åŸŸåç®¡ç†å¹³å°ä¸­å¯ä»¥ä¿®æ”¹ï¼‰çš„è§£æè®°å½•</li>
<li>ä¸€çº§ DNSï¼šæ¯”å¦‚ ns3.dnsv2.com.ï¼Œ è´Ÿè´£è¿”å›å…·ä½“åŸŸåçš„è§£æè®°å½•ï¼Œæ¯”å¦‚ ipw.cn çš„ A è®°å½•ä¸º 106.55.75.123</li>
</ul>
<p>ä»¥ä¸‹ä¸ºæŸ¥è¯¢ç¤ºä¾‹ï¼š</p>
<p>æŸ¥çœ‹æ ¹ DNS çš„ A è®°å½•</p>
<pre><code class="language-shell">$ dig a.root-servers.net
;; QUESTION SECTION:
;a.root-servers.net.		IN	A

;; ANSWER SECTION:
a.root-servers.net.	81077	IN	A	198.41.0.4

;; AUTHORITY SECTION:
root-servers.net.	125280	IN	NS	h.root-servers.net.
root-servers.net.	125280	IN	NS	c.root-servers.net.
root-servers.net.	125280	IN	NS	a.root-servers.net.
root-servers.net.	125280	IN	NS	e.root-servers.net.
root-servers.net.	125280	IN	NS	k.root-servers.net.
root-servers.net.	125280	IN	NS	b.root-servers.net.
root-servers.net.	125280	IN	NS	i.root-servers.net.
root-servers.net.	125280	IN	NS	d.root-servers.net.
root-servers.net.	125280	IN	NS	l.root-servers.net.
root-servers.net.	125280	IN	NS	g.root-servers.net.
root-servers.net.	125280	IN	NS	j.root-servers.net.
root-servers.net.	125280	IN	NS	f.root-servers.net.
root-servers.net.	125280	IN	NS	m.root-servers.net.

;; ADDITIONAL SECTION:
h.root-servers.net.	517037	IN	A	198.97.190.53
c.root-servers.net.	563686	IN	A	192.33.4.12
e.root-servers.net.	601355	IN	A	192.203.230.10
g.root-servers.net.	472031	IN	A	192.112.36.4
f.root-servers.net.	553894	IN	A	192.5.5.241
k.root-servers.net.	597325	IN	A	193.0.14.129
i.root-servers.net.	517037	IN	A	192.36.148.17
l.root-servers.net.	565009	IN	A	199.7.83.42
b.root-servers.net.	559683	IN	A	199.9.14.201
d.root-servers.net.	601468	IN	A	199.7.91.13
m.root-servers.net.	603681	IN	A	202.12.27.33
j.root-servers.net.	584819	IN	A	192.58.128.30
h.root-servers.net.	569462	IN	AAAA	2001:500:1::53
c.root-servers.net.	34585	IN	AAAA	2001:500:2::c
</code></pre>
<p>é€šè¿‡æ ¹ DNS æŸ¥è¯¢ ipw.cn ï¼Œè¿”å›äº†é¡¶çº§ DNS a.dns.cn. çš„åœ°å€ä¸º 203.119.25.1</p>
<pre><code class="language-shell">~$ dig @198.41.0.4 ipw.cn
;; QUESTION SECTION:
;ipw.cn.				IN	A

;; AUTHORITY SECTION:
cn.			172800	IN	NS	a.dns.cn.
cn.			172800	IN	NS	b.dns.cn.
cn.			172800	IN	NS	c.dns.cn.
cn.			172800	IN	NS	d.dns.cn.
cn.			172800	IN	NS	e.dns.cn.
cn.			172800	IN	NS	f.dns.cn.
cn.			172800	IN	NS	g.dns.cn.
cn.			172800	IN	NS	ns.cernet.net.

;; ADDITIONAL SECTION:
a.dns.cn.		172800	IN	A	203.119.25.1
b.dns.cn.		172800	IN	A	203.119.26.1
c.dns.cn.		172800	IN	A	203.119.27.1
d.dns.cn.		172800	IN	A	203.119.28.1
e.dns.cn.		172800	IN	A	203.119.29.1
f.dns.cn.		172800	IN	A	195.219.8.90
g.dns.cn.		172800	IN	A	66.198.183.65
ns.cernet.net.		172800	IN	A	202.112.0.44
a.dns.cn.		172800	IN	AAAA	2001:dc7::1
d.dns.cn.		172800	IN	AAAA	2001:dc7:1000::1
</code></pre>
<p>é€šè¿‡ a.dns.cn æŸ¥è¯¢ ipw.cnï¼Œè¿”å› ä¸€çº§ DNS çš„ A è®°å½•</p>
<pre><code class="language-shell">~$ dig @a.dns.cn ipw.cn

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;ipw.cn.				IN	A

;; AUTHORITY SECTION:
ipw.cn.			86400	IN	NS	ns4.dnsv2.com.
ipw.cn.			86400	IN	NS	ns3.dnsv2.com.
</code></pre>
<p>é€šè¿‡ ns4.dnsv2.com è¿”å› ipw.cn çš„ A è®°å½• 106.55.75.123</p>
<pre><code class="language-shell">~$ dig @ns4.dnsv2.com ipw.cn
;; QUESTION SECTION:
;ipw.cn.				IN	A

;; ANSWER SECTION:
ipw.cn.			600	IN	A	106.55.75.123

;; AUTHORITY SECTION:
ipw.cn.			86400	IN	NS	ns4.dnsv2.com.
ipw.cn.			86400	IN	NS	ns3.dnsv2.com.
</code></pre>
<h4 id="å‚è€ƒæ–‡æ¡£-3"><a class="header" href="#å‚è€ƒæ–‡æ¡£-3">å‚è€ƒæ–‡æ¡£</a></h4>
<ul>
<li><a href="https://ipw.cn/dns/">ipw.cn</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="äº‘åŸç”Ÿ"><a class="header" href="#äº‘åŸç”Ÿ">äº‘åŸç”Ÿ</a></h1>
<p>è¿™é‡Œä¸»è¦æ˜¯äº‘åŸç”Ÿè¿ç»´ï¼Œæ¶‰åŠåˆ° docker,k8s,prometheus ç›‘æ§ç­‰ä¸€ç³»åˆ—äº‘åŸç”Ÿç›¸å…³ç»„ä»¶çš„å®‰è£…é…ç½®ä¸ä½¿ç”¨é—®é¢˜.</p>
<ul>
<li><a href="cloud_operations/monitor.html">ç›‘æ§</a></li>
<li><a href="cloud_operations/kubernetes.html">kubernets</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="äº‘åŸç”Ÿç›‘æ§"><a class="header" href="#äº‘åŸç”Ÿç›‘æ§">äº‘åŸç”Ÿç›‘æ§</a></h1>
<p>è¿™é‡Œä¸»è¦æ˜¯ ç›‘æ§ï¼Œæ¶‰åŠåˆ° prometheus alertmanager grafana ç­‰ç›¸å…³ç»„ä»¶çš„å®‰è£…ä½¿ç”¨ä¸ç›‘æ§é…ç½®ç­‰.</p>
<ul>
<li>
<p><a href="cloud_operations/monitor/n9e_install.html">å¤œèºéƒ¨ç½²å®‰è£…</a></p>
</li>
<li>
<p><a href="cloud_operations/monitor/n9e_ldap_config.html">å¤œèºé…ç½® ldap å•ç‚¹ç™»å½•</a></p>
</li>
<li>
<p><a href="cloud_operations/monitor/alert_prom_sql.html">prometheus ç›‘æ§ sql</a></p>
</li>
<li>
<p><a href="cloud_operations/monitor/prometheus_domain_monitor.html">prometheus ç›‘æ§åŸŸå</a></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="å¤œèºå®‰è£…ä¸é…ç½®"><a class="header" href="#å¤œèºå®‰è£…ä¸é…ç½®">å¤œèºå®‰è£…ä¸é…ç½®</a></h1>
<p><a href="https://flashcat.cloud/docs/content/flashcat-monitor/nightingale-v6/install/intro/">å¤œèºå®˜æ–¹éƒ¨ç½²æ–‡æ¡£</a></p>
<p>å¤œèºå®˜æ–¹æ¨èäºŒè¿›åˆ¶å®‰è£…ï¼Œå…·ä½“å®‰è£…æ­¥éª¤å‚è€ƒä¸å®˜ç½‘</p>
<h2 id="ä¸€äºŒè¿›åˆ¶å®‰è£…å¤œèº"><a class="header" href="#ä¸€äºŒè¿›åˆ¶å®‰è£…å¤œèº">ä¸€ã€äºŒè¿›åˆ¶å®‰è£…å¤œèº</a></h2>
<h3 id="11-éƒ¨ç½²å®‰è£…-mysql"><a class="header" href="#11-éƒ¨ç½²å®‰è£…-mysql">1.1 éƒ¨ç½²å®‰è£… mysql</a></h3>
<p>å®‰è£… mysql</p>
<pre><code class="language-shell">yum -y install mariadb*
systemctl enable mariadb
systemctl restart mariadb
</code></pre>
<p>è®¾ç½®ç™»é™†å¯†ç </p>
<pre><code class="language-shell">mysql -e "SET PASSWORD FOR 'root'@'localhost' = PASSWORD('passw0rd');"
</code></pre>
<p>å¼€å¯è¿œç¨‹ç™»å½•</p>
<p>ç™»å½• mysql åï¼Œæ‰§è¡Œä¸€ä¸‹è¯­å¥ï¼Œå¼€å¯è¿œç¨‹ç™»å½•</p>
<pre><code class="language-sql">GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'passw0rd' WITH GRANT OPTION;
</code></pre>
<h3 id="12-éƒ¨ç½²å®‰è£…-redis"><a class="header" href="#12-éƒ¨ç½²å®‰è£…-redis">1.2 éƒ¨ç½²å®‰è£… redis</a></h3>
<p>è¿™é‡Œé‡‡ç”¨äºŒè¿›åˆ¶å®‰è£…ï¼Œè¯·å‚è€ƒ <a href="cloud_operations/monitor/../../operations/redis/redis_binary_installed.html">redis äºŒè¿›åˆ¶å®‰è£…ä¸é…ç½®</a></p>
<h3 id="13-éƒ¨ç½²å¤œèº"><a class="header" href="#13-éƒ¨ç½²å¤œèº">1.3 éƒ¨ç½²å¤œèº</a></h3>
<p><strong>å®‰è£…å¤œèº</strong></p>
<p>å¤œèºæœ€æ–°å®‰è£…åŒ…<a href="https://flashcat.cloud/download/nightingale/">ä¸‹è½½åœ°å€</a>,æˆªæ­¢åˆ°ç›®å‰ï¼Œæœ€è¿‘ç‰ˆæœ¬æ˜¯<code>v6.1.0</code></p>
<p>(1) åˆ›å»ºä¸ª n9e çš„ç›®å½•ï¼Œåé¢æŠŠ n9e ç›¸å…³çš„æ–‡ä»¶è§£å‹åˆ°è¿™é‡Œ</p>
<pre><code class="language-shell">mkdir -p /opt/n9e &amp;&amp; cd /opt/n9e
</code></pre>
<p>(2) ä¸‹è½½ n9e å‘å¸ƒåŒ…ï¼Œamd64 æ˜¯ x84 çš„åŒ…ï¼Œä¸‹è½½ç«™ç‚¹ä¹Ÿæä¾› arm64 çš„åŒ…ï¼Œå¦‚æœéœ€è¦å…¶ä»–å¹³å°çš„åŒ…åˆ™è¦è‡ªè¡Œç¼–è¯‘äº†</p>
<pre><code class="language-shell">tarball=n9e-v6.0.1-linux-amd64.tar.gz
urlpath=https://download.flashcat.cloud/${tarball}
wget -q $urlpath || exit 1
</code></pre>
<p>(3)è§£å‹å®‰è£…åŒ…åˆ°<code>/opt/n9e</code></p>
<pre><code class="language-shell">tar -zxvf n9e-v6.0.1-linux-amd64.tar.gz -C /opt/n9e/
</code></pre>
<p>(4) è§£å‹ç¼©ä¹‹åï¼Œå¯ä»¥çœ‹åˆ° n9e.sql æ˜¯å»ºè¡¨è¯­å¥ï¼Œå¯¼å…¥æ•°æ®åº“</p>
<pre><code class="language-shell">mysql -uroot -ppassw0rd &lt; n9e.sql
</code></pre>
<p><strong>æ³¨:</strong> passw0rd ä¸ºç¬¬ä¸€æ­¥åˆ›å»º mariab æ—¶å€™çš„åˆ›å»ºçš„å¯†ç </p>
<p>(5) ä¿®æ”¹<code>n9e</code>æ•°æ®åº“é…ç½®</p>
<p>é…ç½®æ–‡ä»¶åœ¨å®‰è£…ç›®å½•ä¸‹ <code>etc/config.toml</code></p>
<pre><code class="language-shell">DSN="root:passw0rd@tcp(127.0.0.1:3306)/n9e_v6?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&amp;allowNativePasswords=true"
</code></pre>
<p>(6) å¯åŠ¨æµ‹è¯•</p>
<p>å¯åŠ¨ n9e</p>
<pre><code class="language-shell">nohup ./n9e &amp;&gt; n9e.log &amp;
</code></pre>
<p>æ£€æŸ¥ n9e.log æ˜¯å¦æœ‰å¼‚å¸¸æ—¥å¿—ï¼Œæ£€æŸ¥ç«¯å£æ˜¯å¦åœ¨ç›‘å¬ï¼Œæ­£å¸¸åº”è¯¥ç›‘å¬åœ¨ 17000</p>
<pre><code class="language-shell">ss -tlnp|grep 17000
</code></pre>
<p>å¯åŠ¨æˆåŠŸå¦‚ä¸‹å›¾
<img src="cloud_operations/monitor/../../images/n9e/n9e_check_17000.png" alt="avatar" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="å¤œèºé…ç½®-ldap-å•ç‚¹ç™»å½•"><a class="header" href="#å¤œèºé…ç½®-ldap-å•ç‚¹ç™»å½•">å¤œèºé…ç½® ldap å•ç‚¹ç™»å½•</a></h1>
<p>å¤œèºç‰ˆæœ¬ v6.1.0</p>
<p>è¿›å…¥å¤œèºç•Œé¢åï¼Œåœ¨ç³»ç»Ÿé…ç½®ä¸­ï¼Œæ‰¾åˆ°å•ç‚¹ç™»å½•ï¼Œå¦‚ä¸‹å›¾</p>
<p><img src="cloud_operations/monitor/../../images/n9e/n9e_ldap_config_1.png" alt="avatar" /></p>
<p>é€‰æ‹©<code>ldap</code>åï¼Œè¿›è¡Œç›¸åº”çš„ä¿®æ”¹å³å¯</p>
<p>å‚è€ƒé…ç½®å¦‚ä¸‹</p>
<pre><code class="language-conf">Enable = true # å¼€å¯
Host = 'ldap_host'
Port = 389
BaseDn = 'dc=n9e,dc=com,dc=cn' # ldapç›¸å…³é…ç½® ä»…ä¾›å‚è€ƒ
BindUser = 'cn=Manager,dc=n9e,dc=com,dc=cn' # ldap ç›¸å…³é…ç½®ï¼Œä»…ä¾›å‚è€ƒ
BindPass = 'passw0rd'
# openldap format e.g. (&amp;(uid=%s))
# AD format e.g. (&amp;(sAMAccountName=%s))
AuthFilter = '(&amp;(uid=%s))'
CoverAttributes = true
TLS = false
StartTLS = true
DefaultRoles = ['Standard']

[Attributes]
Nickname = 'cn'
Phone = 'mobile'
Email = 'mail'
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="prometheus-ç›‘æ§å‘Šè­¦-sql"><a class="header" href="#prometheus-ç›‘æ§å‘Šè­¦-sql">prometheus ç›‘æ§å‘Šè­¦ sql</a></h1>
<p>è¿™é‡Œä¸»è¦æ˜¯é’ˆå¯¹æ—¥å¸¸ç”¨åˆ°çš„ç›‘æ§å‘Šè­¦ prom_sql çš„è®°å½•ä¸æè¿°</p>
<p>ç‰ˆæœ¬ä¿¡æ¯</p>
<blockquote>
<p>prometheus, version 2.19.2</p>
<p>(branch: HEAD, revision: c448ada63d83002e9c1d2c9f84e09f55a61f0ff7)</p>
</blockquote>
<h3 id="ä¸€ä¸»æœºç›¸å…³"><a class="header" href="#ä¸€ä¸»æœºç›¸å…³">ä¸€ã€ä¸»æœºç›¸å…³</a></h3>
<p>ä¸»æœºå­˜æ´» sql(node-exporter æœåŠ¡å¼‚å¸¸æˆ–è€…æœåŠ¡å™¨å®•æ‰å°±å‘Šè­¦)</p>
<p><code>sql up{app="node-exporter",instance=~"192.*"} == 0 </code></p>
<p><strong>æ³¨:è¿™é‡Œå¯¹ä¸»æœºçš„ ip è¿›è¡Œäº†ç›¸å…³çš„ç­›é€‰ï¼ŒæŠŠ instance é‡Œé¢çš„åŒ¹é…å€¼æ¢æˆè‡ªå·±å¯¹åº”çš„ ip ç½‘æ®µå³å¯</strong></p>
<p>ä¸»æœºå†…å­˜å‘Šè­¦(å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡ 96 å‘Šè­¦)</p>
<pre><code class="language-sql">((node_memory_MemTotal_bytes - (node_memory_MemFree_bytes + node_memory_Buffers_bytes + node_memory_Cached_bytes)) / node_memory_MemTotal_bytes) * 100 &gt; 96
</code></pre>
<p>ä¸»æœº CPU ç›‘æ§(CPU ä½¿ç”¨ç‡è¶…è¿‡ 90 å‘Šè­¦)</p>
<pre><code class="language-sql">100 - ((avg by(instance, job, env) (irate(node_cpu_seconds_total{mode="idle"}[30s]))) * 100) &gt; 90
</code></pre>
<p>ä¸»æœºç½‘ç»œæµé‡ç›‘æ§(è¶…è¿‡ 200M å°±å‘Šè­¦)</p>
<pre><code class="language-sql">avg by(instance, job, env) (irate(node_network_receive_bytes_total{device!="lo"}[5m]) * 8) / (1000 * 1000) &gt; 200
</code></pre>
<p>ä¸»æœºç£ç›˜ç›‘æ§(è¶…è¿‡ 90 å°±å‘Šè­¦)</p>
<pre><code class="language-sql">100 - (node_filesystem_avail_bytes{instance=~"172.16.*"} * 100) / node_filesystem_size_bytes{instance=~"172.16.*"} &gt; 90
</code></pre>
<h3 id="äºŒk8s-ç›¸å…³"><a class="header" href="#äºŒk8s-ç›¸å…³">äºŒã€k8s ç›¸å…³</a></h3>
<p>çº¿ä¸Š k8s èŠ‚ç‚¹ CPU ç›‘æ§å‘Šè­¦(2 åˆ†é’Ÿå†…ï¼ŒCPU ä½¿ç”¨ç‡è¶…è¿‡ 90 å°±å‘Šè­¦)</p>
<pre><code class="language-sql">100 - avg by(instance) (rate(node_cpu_seconds_total{mode="idle",instance =~ "172.18.*"}[2m])) * 100 &gt; 90
</code></pre>
<p>æ³¨:è·Ÿä¸»æœº CPU ç›‘æ§æ˜¯åŒä¸€ç±»ï¼Œå•ç‹¬åˆ—å‡ºæ¥æ”¾åˆ° k8s é‡Œé¢äº†</p>
<p>çº¿ä¸Š k8s èŠ‚ç‚¹çŠ¶æ€ç›‘æ§</p>
<pre><code class="language-sql">kube_node_status_condition{condition="Ready",status="true", node=~"cn-hangzhou.*"} == 0
</code></pre>
<p>çº¿ä¸Š k8s èŠ‚ç‚¹ç£ç›˜ç›‘æ§(ç£ç›˜ä½¿ç”¨ç‡è¶…è¿‡ 90 å°±å‘Šè­¦)</p>
<pre><code class="language-sql">100 - (node_filesystem_avail_bytes{instance=~"172.18.*"} * 100) / node_filesystem_size_bytes{instance=~"172.18.*"} &gt; 90
</code></pre>
<p>æ³¨:è·Ÿä¸»æœº ç£ç›˜ ç›‘æ§æ˜¯åŒä¸€ç±»ï¼Œå•ç‹¬åˆ—å‡ºæ¥æ”¾åˆ° k8s é‡Œé¢äº†</p>
<p>çº¿ä¸Š k8s èŠ‚ç‚¹å†…å­˜ç›‘æ§å‘Šè­¦(å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡ 95 å°±å‘Šè­¦)</p>
<pre><code class="language-sql">100 - node_memory_MemAvailable_bytes{instance =~ "172.18.*"} / node_memory_MemTotal_bytes{instance =~ "172.18.*"} * 100 &gt; 95
</code></pre>
<h3 id="ä¸‰pod-ç›¸å…³"><a class="header" href="#ä¸‰pod-ç›¸å…³">ä¸‰ã€pod ç›¸å…³</a></h3>
<p>çº¿ä¸Š pod CPU ä½¿ç”¨ç‡ç›‘æ§ (5 åˆ†é’Ÿä¹‹å†…ï¼ŒCPU ä½¿ç”¨ç‡è¶…è¿‡ 80 å°±å‘Šè­¦)</p>
<pre><code class="language-sql">(sum by(name) (rate(container_cpu_usage_seconds_total{image!="",namespace=~"moushi-(prod|pre)"}[5m])) * 100) &gt; 80
</code></pre>
<p>çº¿ä¸Š pod å†…å­˜ä½¿ç”¨ç‡ç›‘æ§(pod å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡ 80 å°±å‘Šè­¦)</p>
<pre><code class="language-sql">(sum(container_memory_working_set_bytes{id!="/",namespace=~"moushi-(prod|pre)"}) BY (instance,name,container,pod_name,namespace) / sum(container_spec_memory_limit_bytes{id!="/",namespace=~"moushi-(prod|pre)"} &gt; 0) BY (instance,name,container,pod_name,namespace) * 100) &gt; 98
</code></pre>
<p>çº¿ä¸Š pod ç½‘ç»œæµé‡ç›‘æ§(pod æµå…¥æµé‡ 1 åˆ†é’Ÿä¹‹å†…è¶…è¿‡ 50M å°±å‘Šè­¦)</p>
<pre><code class="language-sql">sum by(name) (irate(container_network_receive_bytes_total{container_name="POD",namespace=~"moushi-(pre|prod)"}[1m])) &gt; 1024 * 1024 * 50
</code></pre>
<p>pod å¯åŠ¨å¤±è´¥ç›‘æ§(10 åˆ†é’Ÿä¹‹å†…ï¼Œå¯åŠ¨å¤±è´¥ä¸€æ¬¡å°±å‘Šè­¦)</p>
<pre><code class="language-sql">avg_over_time(kube_pod_container_status_waiting_reason{namespace=~"moushi-(pre|prod)",reason!="PodInitializing", reason!="ContainerCreating"}[10m]) == 1
</code></pre>
<p>çº¿ä¸Š pod é‡å¯ç›‘æ§(5 åˆ†é’Ÿä¹‹å†…ï¼Œpod é‡å¯æ¬¡æ•°è¶…è¿‡ä¸€æ¬¡å°±å‘Šè­¦)</p>
<pre><code class="language-sql">increase(kube_pod_container_status_restarts_total{namespace=~"moushi-(prod|pre)"}[5m]) &gt; 0
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="prometheus-åŸŸåçŠ¶æ€ç ç›‘æ§"><a class="header" href="#prometheus-åŸŸåçŠ¶æ€ç ç›‘æ§">prometheus åŸŸåçŠ¶æ€ç ç›‘æ§</a></h1>
<h2 id="ä¸€å®‰è£…-blackbox"><a class="header" href="#ä¸€å®‰è£…-blackbox">ä¸€ã€å®‰è£… blackbox</a></h2>
<h3 id="11-äºŒè¿›åˆ¶å®‰è£…"><a class="header" href="#11-äºŒè¿›åˆ¶å®‰è£…">1.1 äºŒè¿›åˆ¶å®‰è£…</a></h3>
<p>æ˜¯ Prometheus ç¤¾åŒºæä¾›çš„å®˜æ–¹é»‘ç›’ç›‘æ§è§£å†³æ–¹æ¡ˆï¼Œå…¶å…è®¸ç”¨æˆ·é€šè¿‡ï¼šHTTPã€ HTTPSã€ DNSã€ TCP ä»¥åŠ ICMP çš„æ–¹å¼å¯¹ç½‘ç»œè¿›è¡Œæ¢æµ‹</p>
<p>ğŸ‘‰ğŸ» blackbox <a href="https://github.com/prometheus/blackbox_exporter/releases">ä¸‹è½½åœ°å€</a></p>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä¸‹è½½å¹¶å®‰è£…<code>blackbox</code></p>
<pre><code class="language-shell"># ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶
wget https://github.com/prometheus/blackbox_exporter/releases/download/v0.24.0/blackbox_exporter-0.24.0.linux-amd64.tar.gz

# è§£å‹äºŒè¿›åˆ¶æ–‡ä»¶
tar -zxvf blackbox_exporter-0.24.0.linux-amd64.tar.gz -C /opt/

# é‡å‘½å
mv blackbox_exporter-0.24.0.linux-amd64 blackbox_exporter
</code></pre>
<p>è§£å‹åçš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹</p>
<pre><code class="language-PlainText">â”œâ”€â”€ blackbox_exporter # äºŒè¿›åˆ¶æ–‡ä»¶
â”œâ”€â”€ blackbox.yml      # é…ç½®æ–‡ä»¶
â”œâ”€â”€ LICENSE
â””â”€â”€ NOTICE
</code></pre>
<p>é…ç½®æ–‡ä»¶å¯ä½¿ç”¨å¦‚ä¸‹é…ç½®</p>
<pre><code class="language-yaml">modules:
  http_2xx: # http æ£€æµ‹æ¨¡å—  Blockbox-Exporter ä¸­æ‰€æœ‰çš„æ¢é’ˆå‡æ˜¯ä»¥ Module çš„ä¿¡æ¯è¿›è¡Œé…ç½®
    prober: http
    timeout: 10s
    http:
      valid_http_versions: ['HTTP/1.1', 'HTTP/2']
      valid_status_codes: [200] # è¿™é‡Œæœ€å¥½ä½œä¸€ä¸ªè¿”å›çŠ¶æ€ç ï¼Œåœ¨grafanaä½œå›¾æ—¶ï¼Œæœ‰æ˜ç¤º---é™ˆåˆšæ³¨é‡Šã€‚
      method: GET
      preferred_ip_protocol: 'ip4'
  http_post_2xx: # http post ç›‘æµ‹æ¨¡å—
    prober: http
    timeout: 10s
    http:
      valid_http_versions: ['HTTP/1.1', 'HTTP/2']
      method: POST
      preferred_ip_protocol: 'ip4'
  tcp_connect: # TCP æ£€æµ‹æ¨¡å—
    prober: tcp
    timeout: 10s
  dns: # DNS æ£€æµ‹æ¨¡å—
    prober: dns
    dns:
      transport_protocol: 'tcp' # é»˜è®¤æ˜¯ udp
      preferred_ip_protocol: 'ip4' # é»˜è®¤æ˜¯ ip6
      query_name: 'kubernetes.default.svc.cluster.local'
</code></pre>
<p>å¯åŠ¨<code>blackbox_exporter</code></p>
<pre><code class="language-shell">./blackbox_exporter --config=blackbox.yml
</code></pre>
<h3 id="12-k8s-å®‰è£…"><a class="header" href="#12-k8s-å®‰è£…">1.2 k8s å®‰è£…</a></h3>
<p>å‡†å¤‡å®‰è£…æ–‡ä»¶ <code>blackbox_app.yaml</code></p>
<pre><code class="language-yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: blackbox-config
  namespace: kube-prometheus
data:
  blackbox.yml: |-
    modules:
      http_2xx:  # http æ£€æµ‹æ¨¡å—  Blockbox-Exporter ä¸­æ‰€æœ‰çš„æ¢é’ˆå‡æ˜¯ä»¥ Module çš„ä¿¡æ¯è¿›è¡Œé…ç½®
        prober: http
        timeout: 10s
        http:
          valid_http_versions: ["HTTP/1.1", "HTTP/2"]
          valid_status_codes: [200]
          method: GET
          preferred_ip_protocol: "ip4"
      http_post_2xx: # http post ç›‘æµ‹æ¨¡å—
        prober: http
        timeout: 10s
        http:
          valid_http_versions: ["HTTP/1.1", "HTTP/2"]
          method: POST
          preferred_ip_protocol: "ip4"
      tcp_connect:  # TCP æ£€æµ‹æ¨¡å—
        prober: tcp
        timeout: 10s
      dns:  # DNS æ£€æµ‹æ¨¡å—
        prober: dns
        dns:
          transport_protocol: "tcp"  # é»˜è®¤æ˜¯ udp
          preferred_ip_protocol: "ip4"  # é»˜è®¤æ˜¯ ip6
          query_name: "kubernetes.default.svc.cluster.local"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: blackbox
  namespace: kube-prometheus
spec:
  selector:
    matchLabels:
      app: blackbox
  template:
    metadata:
      labels:
        app: blackbox
    spec:
      containers:
        - image: prom/blackbox-exporter:v0.16.0
          name: blackbox
          args:
            - --config.file=/etc/blackbox_exporter/blackbox.yml # ConfigMap ä¸­çš„é…ç½®æ–‡ä»¶
            - --log.level=error # é”™è¯¯çº§åˆ«æ§åˆ¶
          ports:
            - containerPort: 9115
          volumeMounts:
            - name: config
              mountPath: /etc/blackbox_exporter
      volumes:
        - name: config
          configMap:
            name: blackbox-config
---
apiVersion: v1
kind: Service
metadata:
  name: blackbox
  namespace: kube-prometheus
spec:
  selector:
    app: blackbox
  ports:
    - port: 9115
      targetPort: 9115
</code></pre>
<p>æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼Œè¿›è¡Œå®‰è£…</p>
<pre><code class="language-shell">kubectl apply -f blackbox_app.yaml
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹</p>
<pre><code class="language-PlainText">configmap/blackbox-config created
deployment.apps/blackbox created
service/blackbox created
</code></pre>
<h2 id="äºŒé…ç½®-prometheus"><a class="header" href="#äºŒé…ç½®-prometheus">äºŒã€é…ç½® prometheus</a></h2>
<p>åœ¨<code>prometheus</code>ä¸­é…ç½®<code>blackbox</code>æŠ“å–é…ç½®</p>
<pre><code class="language-yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-config
  namespace: kube-prometheus
data:
  prometheus.yml: |
    global:
      scrape_interval: 15s
      scrape_timeout: 15s
    scrape_configs:
    - job_name: 'prometheus'
      static_configs:
      - targets: ['localhost:9090']

    # é…ç½®httpæ¨¡å—,æ²¡æœ‰é‡‡ç”¨å‚è€ƒæ–‡æ¡£ï¼Œå› ä¸ºæ£€æµ‹çš„æ˜¯å¤–éƒ¨åŸŸå
    - job_name: 'kubernetes-http-services'
      metrics_path: /probe
      params:
        module: [http_2xx]  # ä½¿ç”¨å®šä¹‰çš„httpæ¨¡å—
      relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: blackbox:9115  # è¿™é‡Œçš„9115æ˜¯Exporterçš„é»˜è®¤ç«¯å£
</code></pre>
<p>é¦–å…ˆè·å– <code>targets</code> å®ä¾‹çš„ <code>__address__</code>å€¼å†™è¿›<code>__param_target</code>ï¼Œ<code>__param_&lt;name&gt;</code>å½¢å¼çš„æ ‡ç­¾é‡Œçš„ name å’Œå®ƒçš„å€¼ä¼šè¢«æ·»åŠ åˆ°å‘é€åˆ°é»‘ç›’çš„ http çš„ header çš„ params å½“ä½œé”®å€¼ï¼Œä¾‹å¦‚<code>__param_module</code>å¯¹åº” params é‡Œçš„ moduleã€‚
ç„¶åè·å–<code>__param_target</code>çš„å€¼ï¼Œå¹¶è¦†å†™åˆ° <code>instance</code> æ ‡ç­¾ä¸­ï¼Œè¦†å†™ Target å®ä¾‹çš„ <code>__address__</code> æ ‡ç­¾å€¼ä¸º <code>BlockBoxExporter</code> å®ä¾‹çš„è®¿é—®åœ°å€ï¼Œå‘ <code>blackbox:9115</code> å‘é€è¯·æ±‚è·å–å®ä¾‹çš„ <code>metrics</code> ä¿¡æ¯ã€‚</p>
<p>ç„¶åæ›´æ–°é…ç½®ï¼š</p>
<pre><code class="language-shell">kubectl apply -f prometheus-cm.yaml
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹</p>
<pre><code class="language-PlainText">configmap/prometheus-config configured
</code></pre>
<p>é‡æ–°åŠ è½½é…ç½®</p>
<pre><code class="language-shell"># è¿™é‡Œé…ç½®äº†åŸŸåè§£æ
curl -X POST http://prometheus.com/-/reload
</code></pre>
<p>æ‰“å¼€<code>prometheus</code> æ‰¾åˆ°<code>target</code>ï¼Œå°±å¯ä»¥çœ‹åˆ°ä¸Šé¢å®šä¹‰çš„<code>kubernetes-http-services</code>ä»»åŠ¡äº†</p>
<p>service-http
<img src="cloud_operations/monitor/../../images/monitor/blackbox_prometheus_target_http.png" alt="avatar" /></p>
<p>ç›®å‰è¿˜æ²¡æ·»åŠ åŸŸåï¼Œæ‰€ä»¥ä¸ºç©º</p>
<p>è¦æ·»åŠ ç›‘æ§çš„åŸŸåï¼Œå°±åœ¨<code>kubernetes-http-services</code>æ·»åŠ <code>static_configs</code></p>
<p><code>kubernetes-http-services</code>é…ç½®å¦‚ä¸‹</p>
<pre><code class="language-yaml">- job_name: 'kubernetes-http-services'
  metrics_path: /probe
  params:
    module: [http_2xx] # ä½¿ç”¨å®šä¹‰çš„httpæ¨¡å—
  static_configs:
    - targets:
    - https://www.baidu.com
  relabel_configs:
    - source_labels: [__address__]
      target_label: __param_target
    - source_labels: [__param_target]
      target_label: instance
    - target_label: __address__
      replacement: blackbox:9115 # è¿™é‡Œçš„9115æ˜¯Exporterçš„é»˜è®¤ç«¯å£
</code></pre>
<p>ä¿å­˜åï¼Œæ‰§è¡Œä¸Šè¿°æ›´æ–°é…ç½®å‘½ä»¤å’Œ<code>reload</code>å‘½ä»¤</p>
<p>ç„¶åé‡æ–°æ‰“å¼€<code>promehtues</code>çš„<code>target</code>,å·²ç»æ³¨å†Œä¸Šå»äº†</p>
<p><img src="cloud_operations/monitor/../../images/monitor/blackbox_prometheus_target_instance.png" alt="avatar" /></p>
<h2 id="ä¸‰prom-sql"><a class="header" href="#ä¸‰prom-sql">ä¸‰ã€prom sql</a></h2>
<p>é…ç½®<code>prometheus</code>ç›‘æ§å‘Šè­¦ï¼Œæ£€æŸ¥çŠ¶æ€ç é<code>200</code></p>
<pre><code class="language-sql">probe_http_status_code != 200
</code></pre>
<p>å¦‚æœé™¤äº†<code>200</code>è¿˜æœ‰å…¶ä»–çŠ¶æ€ç ï¼Œå¦‚<code>301</code>ã€<code>424</code> ç­‰ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹<code>sql</code></p>
<pre><code class="language-sql">probe_http_status_code != 200 unless probe_http_status_code == 424
</code></pre>
<p>æ­¤<code>prom sql</code>è¡¨ç¤ºï¼ŒæŸ¥æ‰¾çŠ¶æ€ç é<code>200</code>æˆ–è€…é<code>424</code>çš„æ•°æ®</p>
<p>å¦å¤–ä¸€ç§æŸ¥è¯¢æ–¹å¼æ˜¯ï¼ŒæŸ¥è¯¢ 10 åˆ†é’Ÿä¹‹å†…ï¼ŒçŠ¶æ€ç æœ‰å˜åŒ–çš„æ•°æ®</p>
<pre><code class="language-sql">changes(probe_http_status_code[10m])
</code></pre>
<h4 id="å‚è€ƒæ–‡æ¡£-4"><a class="header" href="#å‚è€ƒæ–‡æ¡£-4">å‚è€ƒæ–‡æ¡£</a></h4>
<ul>
<li><a href="https://cloud.tencent.com/developer/article/1782670">ä½¿ç”¨ Prometheus è¿›è¡Œé»‘ç›’(blackbox) ç›‘æ§</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="äº‘åŸç”Ÿ-kubernetes"><a class="header" href="#äº‘åŸç”Ÿ-kubernetes">äº‘åŸç”Ÿ kubernetes</a></h1>
<p>è¿™é‡Œä¸»è¦æ¶‰åŠåˆ°<code>kubernetes</code>ç›¸å…³çŸ¥è¯†å·²ç»è¿ç»´ç›¸å…³çš„é—®é¢˜!</p>
<ul>
<li><a href="cloud_operations/kubernetes/kubernetes_sa.html">kubernetes sa ç›¸å…³é—®é¢˜</a></li>
<li><a href="cloud_operations/kubernetes/kubernetes_issues.html">kubernetes ç›¸å…³é—®é¢˜</a>
<ul>
<li><a href="cloud_operations/kubernetes/kubernetes_issues/k8s_secret_issues.html">kubernetes secret ç›¸å…³é—®é¢˜</a></li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="k8s-sa-ç›¸å…³é—®é¢˜"><a class="header" href="#k8s-sa-ç›¸å…³é—®é¢˜">k8s sa ç›¸å…³é—®é¢˜</a></h1>
<p>è¿™é‡Œä¸»è¦æ˜¯è®°å½•å¯¹ k8s sa çš„é…ç½®ä»¥åŠå…¶ç›¸å…³è¿ç»´çš„é—®é¢˜</p>
<ul>
<li><a href="cloud_operations/kubernetes/kubernetes_sa/k8s_sa_kubeconfig.html">kubernetes åŸºäº sa åˆ›å»º kubeconfig è®¿é—®(é›†ç¾¤ç‰ˆ)</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="k8s-åŸºäº-sa-åˆ›å»º-kubeconfig-è®¿é—®é›†ç¾¤ç‰ˆ"><a class="header" href="#k8s-åŸºäº-sa-åˆ›å»º-kubeconfig-è®¿é—®é›†ç¾¤ç‰ˆ">k8s åŸºäº sa åˆ›å»º kubeconfig è®¿é—®ï¼ˆé›†ç¾¤ç‰ˆï¼‰</a></h1>
<h2 id="1åˆ›å»º-sa"><a class="header" href="#1åˆ›å»º-sa">1ã€åˆ›å»º sa</a></h2>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»º serviceaccount</p>
<pre><code class="language-shell">kubectl create sa devops
</code></pre>
<h2 id="2åˆ›å»º-clusterrole"><a class="header" href="#2åˆ›å»º-clusterrole">2ã€åˆ›å»º clusterrole</a></h2>
<p><code>clusterrole.yaml</code></p>
<pre><code class="language-yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  creationTimestamp: '2022-12-11T07:37:26Z'
  name: devops
  resourceVersion: '2468820'
  selfLink: /apis/rbac.authorization.k8s.io/v1/clusterroles/devops
  uid: 21ba0efa-bca7-4a39-868f-f48858ddb591
rules:
  - apiGroups:
      - '*'
    resources:
      - '*'
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - update
      - patch
</code></pre>
<h2 id="3åˆ›å»º-clusterrolebinding"><a class="header" href="#3åˆ›å»º-clusterrolebinding">3ã€åˆ›å»º clusterrolebinding</a></h2>
<p><code>clusterrolebinding.yaml</code></p>
<pre><code class="language-yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: devops
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: devops
subjects:
  - kind: ServiceAccount
    name: devops
    namespace: default
</code></pre>
<h2 id="4ç”Ÿæˆ-kubeconfig"><a class="header" href="#4ç”Ÿæˆ-kubeconfig">4ã€ç”Ÿæˆ kubeconfig</a></h2>
<p>å‡è®¾ k8s çš„ apiserver åœ°å€ä¸ºï¼š<strong><a href="https://192.168.1.236:16443">https://192.168.1.236:16443</a></strong></p>
<p>å‡è®¾ k8s é›†ç¾¤çš„ ca è¯ä¹¦æ–‡ä»¶ç›®å½•ä¸ºï¼š<strong>/etc/kubernetes/pki/ca.pem</strong></p>
<h3 id="41-è·å–-sa-token"><a class="header" href="#41-è·å–-sa-token">4.1 è·å– sa token</a></h3>
<pre><code class="language-shell">kubectl get secret $(kubectl get secret -A | grep devops | awk '{print $2}') -o=jsonpath='{.data.token}' | base64 -d
</code></pre>
<h3 id="42-ç”Ÿæˆ-kubeconfig-æ­¥éª¤"><a class="header" href="#42-ç”Ÿæˆ-kubeconfig-æ­¥éª¤">4.2 ç”Ÿæˆ kubeconfig æ­¥éª¤</a></h3>
<pre><code class="language-shell">KUBE_APISERVER=https://192.168.1.236:16443
DEVOPS_TOKEN=`kubectl get secret $(kubectl get secret -A | grep devops | awk '{print $2}') -o=jsonpath='{.data.token}' | base64 -d` # è¿™é‡Œä¸ºä¸Šä¸€æ­¥è·å–tokençš„å‘½ä»¤

# è®¾ç½®é›†ç¾¤ä¿¡æ¯
kubectl config set-cluster kubernetes \ # kubernetesæ˜¯é›†ç¾¤åå­—
--certificate-authority=/etc/kubernetes/pki/ca.pem \ # è¿™ä¸ªcaæ˜¯k8sé›†ç¾¤çš„caè¯ä¹¦
--embed-certs=true \
--server=${KUBE_APISERVER} \ # è¿™ä¸ªæ˜¯api-serverçš„è¿æ¥åœ°å€ï¼Œé€šè¿‡kubectl cluster-infoèƒ½çœ‹åˆ°
--kubeconfig=devops.kubeconfig

# è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‡­æ®
kubectl config set-credentials devops-user \ # devops-userè¡¨ç¤ºå‡­æ®çš„ç”¨æˆ·å
--token=${DEVOPS_TOKEN} \ # tokenå¯é€šè¿‡ç¬¬ä¸€ä¸ªæ­¥éª¤ä¸­å¾—åˆ°
--kubeconfig=devops.kubeconfig

# è®¾ç½®é›†ç¾¤ä¿¡æ¯å’Œç”¨æˆ·çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
kubectl config set-context devops@kubernetes \ # è®¾ç½®ä¸Šä¸‹æ–‡åå­—
--cluster=kubernetes \ # kubernetesé›†ç¾¤åå­—ï¼Œè·Ÿè®¾ç½®é›†ç¾¤ä¿¡æ¯ä¸­ä¿æŒä¸€è‡´
--user=devops-user \ # ç¬¬äºŒæ­¥è®¾ç½®å‡­æ®çš„ç”¨æˆ·å
--kubeconfig=devops.kubeconfig

# åˆ‡æ¢å½“å‰ä¸Šä¸‹æ–‡
kubectl config use-context devops@kubernetes \
--kubeconfig=./devops.kubeconfig
</code></pre>
<h2 id="5å‘½ä»¤æµ‹è¯•"><a class="header" href="#5å‘½ä»¤æµ‹è¯•">5ã€å‘½ä»¤æµ‹è¯•</a></h2>
<pre><code class="language-shell">kubectl --kubeconfig=./devops.kubeconfig get pod -A
</code></pre>
<h2 id="6ä½¿ç”¨"><a class="header" href="#6ä½¿ç”¨">6ã€ä½¿ç”¨</a></h2>
<p>å°†ç”Ÿæˆçš„<code>devops.config</code>æ”¾åˆ° ç”¨æˆ·å®¶ç›®å½•ä¸‹çš„<code>.kube</code>æ–‡ä»¶ä¸‹ï¼Œå¹¶é‡å‘½åä¸º<code>config</code>å³å¯ï¼Œä¾‹å¦‚</p>
<pre><code class="language-shell">mkdir ~/.kube

mv devops.config ~/.kube/config
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="k8s-ç›¸å…³é—®é¢˜"><a class="header" href="#k8s-ç›¸å…³é—®é¢˜">k8s ç›¸å…³é—®é¢˜</a></h1>
<p>è¿™é‡Œä¸»è¦æ˜¯è®°å½•å¯¹ k8s ç‰ˆæœ¬ä¹‹é—´çš„é…ç½®ä»¥åŠå…¶ç›¸å…³è¿ç»´çš„é—®é¢˜</p>
<p><a href="cloud_operations/kubernetes/kubernetes_issues/k8s_secret_issues.html">kubernetes secret ç›¸å…³é—®é¢˜</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="k8s-æ–°ç‰ˆæœ¬é—®é¢˜å¤„ç†"><a class="header" href="#k8s-æ–°ç‰ˆæœ¬é—®é¢˜å¤„ç†">k8s æ–°ç‰ˆæœ¬é—®é¢˜å¤„ç†</a></h1>
<h4 id="1åˆ›å»º-sa-ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆç›¸åº”-secret-é—®é¢˜"><a class="header" href="#1åˆ›å»º-sa-ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆç›¸åº”-secret-é—®é¢˜">1ã€åˆ›å»º sa ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆç›¸åº” secret é—®é¢˜</a></h4>
<blockquote>
<p>k8s serviceaccount åˆ›å»ºåæ²¡æœ‰ç”Ÿæˆå¯¹åº”çš„ secret</p>
</blockquote>
<p>æ–¹æ³•å¦‚ä¸‹</p>
<p>æ–¹å¼ 1 ä½¿ç”¨ TokenRequest API æ¥ç”Ÿæˆ tokenï¼Œè·å–æ–¹å¼å¦‚ä¸‹</p>
<ul>
<li>ä½¿ç”¨ client-go æˆ–è€…å…¶ä»– api è°ƒç”¨å·¥å…·æ¥è·å–æŸä¸ª serviceaccount çš„ token</li>
<li>åˆ›å»º yamlï¼Œä½¿ç”¨ kubectl apply -f</li>
<li>ä½¿ç”¨ kubectl create token -n xxx <serviceaccount-name> æ¥è·å–ä¸€ä¸ªä¸´æ—¶çš„ token, é»˜è®¤ 1 å°æ—¶</li>
</ul>
<p>æ–¹å¼ 2 åˆ›å»º secret tokenï¼Œåˆ›å»ºåä» secret çš„ token å­—æ®µæ‹¿å°±å¯ä»¥äº†</p>
<pre><code class="language-yaml">apiVersion: v1
kind: Secret
metadata:
  name: secret-sa-sample
  annotations:
    kubernetes.io/service-account.name: 'sa-name' # è¿™é‡Œå¡«å†™serviceAccountName
type: kubernetes.io/service-account-token
</code></pre>
<h3 id="å‚è€ƒæ–‡ç« "><a class="header" href="#å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </a></h3>
<ul>
<li><a href="https://www.soulchild.cn/post/2945">å‚è€ƒæ–‡ç« : k8s serviceaccount åˆ›å»ºåæ²¡æœ‰ç”Ÿæˆå¯¹åº”çš„ secret</a></li>
<li><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.24.md#urgent-upgrade-notes">changelog</a></li>
<li><a href="https://github.com/kubernetes/kubernetes/pull/108309">ç›¸å…³ pr</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="language.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
